<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¯ºäºšç‰Œå® ç‰©æœº</title>
<style>
    /* --- å…¨å±€å˜é‡ä¸åŸºç¡€æ ·å¼ --- */
    :root {
        --blue-base: #3b4652;    
        --blue-dark: #1e242b;    
        --blue-screen: #5c84a8;  
        --black-main: #0f1214;   
        --black-dark: #060709;   
        --text-color: #b5cadd;
        --highlight: #d1b55a;
        --danger: #d15a5a;
    }

    body {
        margin: 0; padding: 0;
        background-color: #0a0d11;
        background-image: radial-gradient(circle at 50% 50%, #161c23 0%, #000 100%);
        display: flex; justify-content: center; align-items: center;
        min-height: 100vh;
        font-family: 'Courier New', Courier, monospace;
        overflow: hidden; user-select: none;
    }

    /* --- æŒæœºå¤–å£³è®¾è®¡ --- */
    #device {
        width: 380px; height: 740px;
        background: linear-gradient(145deg, var(--blue-base), var(--blue-dark));
        border-radius: 190px 190px 160px 160px;
        box-shadow: 
            inset -15px -15px 30px rgba(0,0,0,0.6),
            inset 10px 10px 25px rgba(255,255,255,0.15),
            0 40px 80px rgba(0,0,0,0.9),
            0 0 25px rgba(92, 132, 168, 0.25);
        position: relative;
        display: flex; flex-direction: column; align-items: center;
        padding-top: 80px; box-sizing: border-box;
        border: 4px solid var(--black-main);
    }

    /* é¡¶éƒ¨è´è¶ç»“è£…é¥° */
    .bow-container {
        position: absolute; top: -15px; z-index: 10;
        width: 160px; height: 80px;
        filter: drop-shadow(0 10px 8px rgba(0,0,0,0.6));
    }

    /* å±å¹•è¾¹æ¡† */
    .screen-bezel {
        width: 310px; height: 320px;
        background: linear-gradient(135deg, #1b1e22 0%, #060709 100%);
        border-radius: 40px 40px 50px 50px;
        display: flex; justify-content: center; align-items: center;
        box-shadow: 
            inset 0 10px 25px rgba(0,0,0,1),
            0 5px 15px rgba(255,255,255,0.08),
            0 0 0 4px var(--black-dark);
        position: relative;
    }

    .brand {
        position: absolute; top: -25px;
        color: #111; font-size: 14px; font-weight: 900;
        letter-spacing: 3px; text-shadow: 1px 1px 0 rgba(255,255,255,0.1);
    }

    /* --- æ ¸å¿ƒå±å¹•åŒºåŸŸ --- */
    .screen {
        width: 260px; height: 260px;
        background-color: var(--black-dark);
        border: 3px solid #000;
        border-radius: 15px;
        position: relative; overflow: hidden;
        color: var(--blue-screen);
        box-shadow: inset 0 0 30px rgba(92, 132, 168, 0.15);
    }

    /* å±å¹•æ‰«æçº¿æ•ˆæœ */
    .screen::after {
        content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        background: linear-gradient(rgba(92,132,168,0) 50%, rgba(92,132,168,0.05) 50%);
        background-size: 100% 4px; z-index: 5; pointer-events: none;
    }

    /* é¡¶éƒ¨çŠ¶æ€æ  */
    .status-bar {
        display: flex; justify-content: space-between;
        padding: 6px 10px; font-size: 11px; font-weight: bold;
        border-bottom: 1px dashed var(--blue-screen);
        background: rgba(92,132,168,0.1);
        position: relative; z-index: 6;
    }
    .status-item { display: flex; flex-direction: column; align-items: center; }
    .status-bar progress { width: 45px; height: 6px; appearance: none; margin-top: 4px; }
    progress::-webkit-progress-bar { background-color: #1a1a1a; border-radius: 3px; }
    progress::-webkit-progress-value { background-color: var(--blue-screen); border-radius: 3px; box-shadow: 0 0 6px var(--blue-screen); }
    .gold-text { color: var(--highlight); text-shadow: 0 0 4px rgba(209, 181, 90, 0.5); }

    /* --- åƒç´ ç”»æ˜¾ç¤ºåŒºåŸŸ --- */
    #canvas-container {
        width: 100%; height: 155px;
        position: relative;
        background-color: #dbe4eb; 
        background-image: 
            radial-gradient(#b8c6d1 20%, transparent 20%),
            radial-gradient(#b8c6d1 20%, transparent 20%);
        background-position: 0 0, 4px 4px;
        background-size: 8px 8px;
        display: flex; justify-content: center; align-items: flex-end; 
        padding-bottom: 2px; box-sizing: border-box;
        overflow: hidden;
        box-shadow: inset 0 0 20px rgba(20, 30, 40, 0.2);
    }

    .pixel-bg {
        position: absolute; width: 100%; height: 100%; top: 0; left: 0; pointer-events: none; z-index: 1;
        display: flex; justify-content: center; align-items: center;
    }
    .bg-text {
        font-family: 'Arial', sans-serif;
        font-size: 50px; color: rgba(255, 255, 255, 0.5); 
        font-weight: 900; letter-spacing: -2px;
        opacity: 0.6; margin-bottom: 20px;
    }

    /* è¯ºäºšåƒç´ ç”»å¸ƒ */
    canvas {
        position: relative; z-index: 5;
        width: 120px; height: 156px; 
        image-rendering: pixelated; 
        animation: breathe 2.5s infinite ease-in-out;
        margin-bottom: -5px; 
        filter: drop-shadow(4px 4px 0 rgba(0,0,0,0.2));
    }
    @keyframes breathe {
        0%, 100% { transform: scale(1) translateY(0); }
        50% { transform: scale(1.02) translateY(-2px); }
    }
    
       /* æ¢é™©åŠ¨ç”»è¦†ç›–å±‚ */
    #adventure-overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: #000; z-index: 8; display: none;
        flex-direction: column; justify-content: center; align-items: center;
        color: var(--blue-screen); font-size: 14px; font-weight: bold;
        padding-bottom: 25px; 
        box-sizing: border-box; 
    }
    .adventure-icon { font-size: 40px; margin-bottom: 10px; animation: float 2s infinite ease-in-out; }
    @keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-10px);} }
    
    .walking-dots::after { content: '...'; animation: dots 1.5s infinite; }
    @keyframes dots { 0%{content:'.'} 33%{content:'..'} 66%{content:'...'} }

    /* --- å¯¹è¯æ¡†åŒºåŸŸ --- */
    .dialogue-box {
        position: absolute; bottom: 0; width: 100%; height: 70px;
        background: rgba(6, 7, 9, 0.96);
        border-top: 2px solid var(--blue-screen);
        padding: 8px; box-sizing: border-box;
        font-size: 12px; line-height: 1.4; font-weight: bold;
        text-shadow: 1px 1px 0 #000; color: var(--text-color);
        overflow-y: auto; z-index: 6; scrollbar-width: none;
    }
    .cursor { display: inline-block; width: 6px; height: 12px; background: var(--blue-screen); animation: blink 1s infinite; vertical-align: middle; margin-left: 2px;}
    @keyframes blink { 0%, 49% { opacity: 1; } 50%, 100% { opacity: 0; } }

    /* --- å¼¹çª—ä¸èœå• UI --- */
    .modal {
        display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(6, 7, 9, 0.98); z-index: 10; padding: 10px; box-sizing: border-box;
    }
    .modal h3 { margin: 5px 0 10px 0; font-size: 14px; text-align: center; border-bottom: 2px solid var(--blue-screen); padding-bottom: 5px; color:#fff;}
    .menu-list { list-style: none; padding: 0; margin: 0; height: 170px; overflow-y: auto; scrollbar-width: none;}
    .menu-list li {
        padding: 8px 10px; border: 1px solid #222; margin-bottom: 6px;
        font-size: 11px; cursor: pointer; border-radius: 5px;
        background: #0a0c0e; transition: 0.2s; font-weight: bold; color: #ccc;
        display: flex; justify-content: space-between;
    }
    .menu-list li:hover { background: var(--blue-screen); color: #000; border-color: var(--blue-screen); transform: translateX(3px);}
    .close-btn { 
        position: absolute; bottom: 10px; left: 10%; width: 80%;
        background: transparent; color: var(--blue-screen); border: 1px dashed var(--blue-screen); 
        padding: 6px; cursor: pointer; border-radius: 8px; font-family: inherit; font-weight: bold; transition: 0.2s;
    }
    .close-btn:hover { background: var(--blue-screen); color: #000; }

    /* å…¨å±äº‹ä»¶å¼¹çª— */
    #event-modal {
        display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(6, 7, 9, 0.98); color: var(--blue-screen); z-index: 20;
        padding: 15px; box-sizing: border-box;
        flex-direction: column; justify-content: center; align-items: center; text-align: center;
        border: 2px solid var(--blue-screen);
    }
    #event-text { font-size: 12px; margin-bottom: 20px; font-weight: bold; line-height: 1.6; text-shadow: 0 0 2px var(--blue-screen); color: #fff;}
    .event-btn { 
        background: var(--blue-dark); color: var(--text-color); border: 1px solid var(--blue-screen); 
        padding: 10px 15px; margin: 6px; font-family: inherit; cursor: pointer; 
        border-radius: 6px; font-weight: bold; width: 100%; font-size: 11px; transition: 0.2s;
    }
    .event-btn:hover { background: var(--blue-screen); color: #000; transform: scale(1.02);}

    /* --- å®ä½“æŒ‰é”®åŒºåŸŸ --- */
    .controls-area {
        margin-top: 45px; width: 320px;
        display: flex; justify-content: space-between; align-items: center;
        padding: 0 15px; box-sizing: border-box;
    }

    /* åå­—æ–¹å‘é”® */
    .d-pad { position: relative; width: 110px; height: 110px; }
    .d-btn {
        position: absolute; width: 35px; height: 35px;
        background: var(--black-main); border: none;
        box-shadow: inset 1px 1px 3px rgba(255,255,255,0.08), inset -2px -2px 5px rgba(0,0,0,0.8), 0 5px 10px rgba(0,0,0,0.6);
        color: var(--blue-screen); font-size: 10px; font-weight: bold; font-family: inherit;
        cursor: pointer; transition: 0.1s; display: flex; justify-content: center; align-items: center;
        text-align: center;
    }
    .d-btn:active { transform: translateY(2px); box-shadow: inset 2px 2px 5px rgba(0,0,0,0.9); }
    
    .d-up { top: 0; left: 37px; border-radius: 8px 8px 3px 3px; }
    
    .d-down { bottom: 0; left: 37px; border-radius: 3px 3px 8px 8px; }
    .d-left { left: 0; top: 37px; border-radius: 8px 3px 3px 8px; }
    .d-right { right: 0; top: 37px; border-radius: 3px 8px 8px 3px; }
    .d-center {
        position: absolute; top: 37px; left: 37px; width: 35px; height: 35px;
        background: var(--black-main); border-radius: 3px;
        box-shadow: inset 0 0 5px rgba(0,0,0,0.5); pointer-events: none;
    }
    .d-center::after {
        content: ''; width: 20px; height: 20px; background: #000; border-radius: 50%; display:block; margin: 7.5px; opacity: 0.5;
    }

    /* å³ä¾§åŠ¨ä½œé”® */
    .action-btns { display: flex; gap: 12px; transform: rotate(-15deg); }
    .a-btn {
        width: 50px; height: 50px; border-radius: 50%;
        background: var(--black-main); border: 2px solid #1a1a1a;
        box-shadow: inset 2px 2px 5px rgba(255,255,255,0.08), inset -2px -2px 6px rgba(0,0,0,0.8), 0 5px 10px rgba(0,0,0,0.5);
        color: var(--blue-screen); font-size: 12px; font-weight: bold; font-family: inherit;
        cursor: pointer; transition: 0.1s;
    }
    .a-btn:active { transform: scale(0.92); }
    .a-btn-label { position: absolute; bottom: -22px; font-size: 11px; color: #111; font-weight: bold; text-align: center; width: 100%;}

    .sys-btn {
        margin-top: 35px; width: 140px; height: 28px;
        background: var(--black-main); border-radius: 15px; border: none;
        box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        color: #444; font-family: inherit; font-size: 10px; font-weight: bold; cursor: pointer;
    }
    .sys-btn:active { transform: translateY(2px); }

    /* æ‰‹æœºé€‚é… */
    @media screen and (max-width: 450px) {
        body { align-items: flex-start; padding-top: 5vh; }
        #device { transform: scale(0.85); transform-origin: top center; }
    }
    @media screen and (max-width: 360px) { #device { transform: scale(0.75); } }
</style>
</head>
<body>

<div id="device">
    <svg class="bow-container" viewBox="0 0 200 100">
        <defs>
            <linearGradient id="bowGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="#2a2a2a" />
                <stop offset="50%" stop-color="#111111" />
                <stop offset="100%" stop-color="#050505" />
            </linearGradient>
            <filter id="shadow">
                <feDropShadow dx="0" dy="5" stdDeviation="3" flood-opacity="0.8"/>
            </filter>
        </defs>
        <path d="M100,50 C60,15 15,5 5,40 C-5,75 30,95 100,50" fill="url(#bowGrad)" filter="url(#shadow)"/>
        <path d="M100,50 C140,15 185,5 195,40 C205,75 170,95 100,50" fill="url(#bowGrad)" filter="url(#shadow)"/>
        <rect x="85" y="35" width="30" height="30" rx="8" fill="url(#bowGrad)" filter="url(#shadow)" stroke="#333" stroke-width="1.5"/>
    </svg>

    <div class="screen-bezel">
        <div class="brand">NOAHÂ·CYDRIAN</div>
        
        <div class="screen">
            <div class="status-bar">
                <div class="status-item" id="lv-text">Lv.1 é¥±é£Ÿ <progress id="bar-hunger" value="100" max="100"></progress></div>                 <div class="status-item">å¿ƒæƒ… <progress id="bar-mood" value="100" max="100"></progress></div>                 <div class="status-item">å¥åº· <progress id="bar-health" value="100" max="100"></progress></div>
                <div class="status-item gold-text">G<span id="txt-gold">520</span></div>
            </div>

            <div id="canvas-container">
                <div class="pixel-bg">
                    <div class="bg-text"></div>
                </div>
                <!-- æ¢é™©æ—¶çš„é®ç½©å±‚ -->
                <div id="adventure-overlay">
                    <div class="adventure-icon" id="adv-icon">âœˆ</div> <canvas id="adv-canvas" width="10" height="10" style="width: 50px; height: 50px; image-rendering: pixelated; margin-bottom: 15px; animation: float 2s infinite ease-in-out; display: none;"></canvas>
                    <div class="walking-dots" id="adv-text">EXPLORING</div>
                </div>
                <canvas id="noah-canvas" width="20" height="26"></canvas>
            </div>

            <div class="dialogue-box" id="dialogue-box">
                <span id="text-content">æ­£åœ¨è½½å…¥éœæ ¼æ²ƒå…¹æ‹‰æ–‡å…‹åŠ³ä¼‘æ¯å®¤...</span><span class="cursor"></span>
            </div>

            <div class="modal" id="sys-modal">
                <h3 id="modal-title">èœå•</h3>
                <ul class="menu-list" id="modal-list"></ul>
                <button class="close-btn" onclick="closeModal()">è¿”å› (BACK)</button>
            </div>

            <div id="event-modal">
                <div id="event-text">äº‹ä»¶</div>
                <div id="event-options"></div>
            </div>
        </div>
    </div>

    <div class="controls-area">
        <div class="d-pad">
            <button class="d-btn d-up" onclick="openLocationMenu()">å¤–å‡º</button>
            <button class="d-btn d-down" onclick="openMenu('shop')">ç¤¼ç‰©</button>
            <button class="d-btn d-left" onclick="openMenu('feed')">æŠ•å–‚</button>
            <button class="d-btn d-right" onclick="openMenu('interact')">äº’åŠ¨</button>
            <div class="d-center"></div>
        </div>
        <div class="action-btns">
            <div style="position:relative;">
                <button class="a-btn" onclick="doAction('status')">ç¾ç»Š</button>
                <div class="a-btn-label">A</div>
            </div>
            <div style="position:relative; margin-top:25px;">
                <button class="a-btn" onclick="doAction('chat')">å¯¹è¯</button>
                <div class="a-btn-label">B</div>
            </div>
        </div>
    </div>
    
    <button class="sys-btn" onclick="doAction('reset')">æ—¶å…‰å€’æµè‡³åˆé‡</button>
</div>

<script>
    // --- æ ¸å¿ƒæ•°å€¼ç³»ç»Ÿ ---
       let savedData = localStorage.getItem('noah_save_data_v1');
    let noah = savedData ? JSON.parse(savedData) : {
        hunger: 80, mood: 80, health: 100, love: 5, gold: 150, 
        level: 1, state: 'normal', isAway: false 
    };
    noah.isAway = false; // åˆ·æ–°é¡µé¢æ—¶å¼ºåˆ¶è®©ä»–å›æ¥ï¼Œé˜²æ­¢å¡åœ¨å¤–å‡ºçŠ¶æ€
    let tickCount = 0;
    
    const levelTitles = ["æœªç›¸è¯†", "åˆé‡", "ç›¸ç†Ÿ", "å¿ƒåŠ¨", "çƒ­æ‹", "æŒšçˆ±", "çµé­‚ä¼´ä¾£"];

    // --- UI æ›´æ–°é€»è¾‘ ---
    function updateUI() {
                // é•¿æ—¶é—´å…»æˆï¼šæ‰€éœ€çš„ç¾ç»Šå€¼å‘ˆæŒ‡æ•°çº§ä¸Šå‡ï¼Œæœ€é«˜é˜¶çµé­‚ä¼´ä¾£éœ€è¦æé«˜åçˆ±å€¼
        const levelThresholds = [0, 50, 200, 600, 1500, 5200, 13140]; 
        let newLevel = 1;
        for(let i = 0; i < levelThresholds.length; i++) {
            if(noah.love >= levelThresholds[i]) newLevel = i + 1;
        }
        newLevel = Math.min(7, newLevel); // é™åˆ¶æœ€é«˜7çº§(ç”±äºæ•°ç»„ä»0å¼€å§‹ï¼Œæœ€å¤§ç´¢å¼•6ï¼Œå¯¹åº”level 7)

        // æ³¨æ„ï¼šåŸç‰ˆlevelTitlesæœ‰7ä¸ªå…ƒç´ ï¼Œç´¢å¼•æ˜¯0åˆ°6ã€‚
        // å› ä¸ºç­‰çº§1å¯¹åº”ç´¢å¼•0ï¼Œæ‰€ä»¥åˆ¤æ–­æ—¶ç”¨ newLevel - 1
        if (newLevel > noah.level) {
            noah.level = newLevel;
            speak(`ã€ç³»ç»Ÿæç¤ºã€‘ç¾ç»Šçªç ´ï¼éšç€æ—¶é—´æ¨ç§»ï¼Œè¯ºäºšå¯¹ä½ çš„æ„Ÿæƒ…æ·±æµ…è¿ˆå…¥äº†ã€${levelTitles[noah.level - 1]}ã€‘é˜¶æ®µã€‚`);
        }

        noah.hunger = Math.max(0, Math.min(100, noah.hunger));
        noah.mood = Math.max(0, Math.min(100, noah.mood));
        noah.health = Math.max(0, Math.min(100, noah.health));
        noah.gold = Math.max(0, noah.gold);
        
        document.getElementById('lv-text').innerHTML = `Lv.${noah.level} é¥±é£Ÿ <progress id="bar-hunger" value="${noah.hunger}" max="100"></progress>`;
        document.getElementById('bar-mood').value = noah.mood;
        document.getElementById('bar-health').value = noah.health;
        document.getElementById('txt-gold').innerText = noah.gold;

        if (noah.health < 20) noah.state = 'sick';
        else if (noah.mood < 30 || noah.hunger < 30) noah.state = 'angry';
        else if (noah.mood > 70 && noah.hunger > 70) noah.state = 'happy';
        else noah.state = 'normal';

        drawNoah();
        // æ¯æ¬¡UIæ›´æ–°æ—¶ï¼Œè‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°ï¼Œå®ç°é•¿æœŸå…»æˆ
        localStorage.setItem('noah_save_data_v1', JSON.stringify(noah));
    }

    let typeInterval;
    function speak(text) {
        clearInterval(typeInterval);
        const textSpan = document.getElementById('text-content');
        const box = document.getElementById('dialogue-box');
        textSpan.innerHTML = '';
        let i = 0;
        typeInterval = setInterval(() => {
            if(text.charAt(i) === '<') {
                let tag = "";
                while(text.charAt(i) !== '>' && i < text.length) { tag += text.charAt(i); i++; }
                tag += '>'; textSpan.innerHTML += tag;
            } else {
                textSpan.innerHTML += text.charAt(i);
            }
            i++;
            box.scrollTop = box.scrollHeight;
            if (i >= text.length) clearInterval(typeInterval);
        }, 30);
    }

    // --- åƒç´ ç”»é€»è¾‘ ---
    const ctx = document.getElementById('noah-canvas').getContext('2d');
    const palette = {
        '..': null, 'H7': '#000000', 'H6': '#383838', 'E16': '#FFF5EE', 'C4': '#33CCFF',
        'C3': '#CCFFFF', 'E2': '#FFCCCC', 'E3': '#FF7777', 'C16': '#1E5AA0', 'H2': '#FFFFFF', 'H3': '#A0A0A0', 'H5': '#2F2F2F'
    };
    // --- æ–°å¢ï¼šç»™å°ç‰©å“å’Œåœºæ™¯çš„é¢œæ–™ ---
    Object.assign(palette, {
        'W1': '#FFFFFF', 'B1': '#000000', 'Y1': '#FFD700', 'Y2': '#FFA500', 
        'BR': '#8B4513', 'BL': '#1E90FF', 'G1': '#32CD32', 'G2': '#006400', 
        'R1': '#FF0000', 'P1': '#FF69B4', 'GR': '#808080',
        'LP': '#E5C3C6', 'DP': '#B38A8E', 'CM': '#F5EBE6', 'GB': '#9CA8B8', 
        'DB': '#687586', 'GL': '#CBAA77', 'DG': '#5C5855', 'WH': '#FFFFFF' , 
'DR': '#8B5A5A', 'LR': '#CD9B9B', 'MG': '#8FBC8F', 'DT': '#698B69', 
        'CB': '#829EB9', 'SB': '#A4BCE6', 'WC': '#E8ECEF', 'BT': '#5C4033'
    });

    // --- æ–°å¢ï¼šå°ç‰©å“ä¸åœºæ™¯çš„åƒç´ ç”»å›¾çº¸ ---
    const sprites = {
        'soda': [
            ".. .. GB GB GB .. .. ..",
            ".. GB WH WH WH GB .. ..",
            "GB SB CB CB CB SB GB ..",
            "GB CB CB WC CB CB GB ..",
            "GB CB WC CB CB CB GB ..",
            "GB CB CB CB CB CB GB ..",
            "GB SB CB CB CB SB GB ..",
            ".. GB GB GB GB GB .. .."
        ],
        'tea': [
            ".. .. .. .. .. .. .. ..",
            ".. .. WH WC WC WH .. ..",
            ".. WC MG MG MG MG WC WH",
            "WC DT MG WC MG DT WC WH",
            "WC MG MG MG MG MG WC ..",
            ".. WC MG MG MG WC .. ..",
            ".. .. WC WC WC .. .. ..",
            ".. WC WC WC WC WC .. .."
        ],
        'potion': [
            ".. .. .. BT BT .. .. ..",
            ".. .. GB WH WH GB .. ..",
            ".. .. GB LR LR GB .. ..",
            ".. GB LR LR WC LR GB ..",
            "GB LR LR LR LR LR LR GB",
            "GB DR LR WC LR LR DR GB",
            "GB DR DR DR DR DR DR GB",
            ".. GB GB GB GB GB GB .."
        ],
                   'pen': [
            ".. .. WH CM CM .. ..",
            ".. WH CM LP CM CM ..",
            "WH CM LP LP CM DG ..",
            "CM LP LP CM DG DG ..",
            "CM CM CM DG DG .. ..",
            ".. CM DG DG .. .. ..",
            ".. .. DG .. .. .. ..",
            ".. .. DG .. .. .. .."
        ],
         'milk': [
            ".. .. DG DG DG .. ..",
            ".. DG WH WH WH DG ..",
            "DG CM CM CM CM CM DG",
            "DG CM GB GB GB CM DG",
            "DG CM GB WH GB CM DG",
            "DG CM GB GB GB CM DG",
            "DG CM CM CM CM CM DG",
            ".. DG DG DG DG DG .."
        ],
        'beer': [
            ".. W1 W1 W1 W1 .. ..",
            "W1 W1 W1 W1 W1 W1 ..",
            "B1 Y1 Y1 Y1 Y1 B1 ..",
            "B1 Y1 Y2 Y1 Y1 B1 B1",
            "B1 Y1 Y1 Y2 Y1 B1 Y1",
            "B1 Y2 Y1 Y1 Y1 B1 B1",
            "B1 Y1 Y2 Y1 Y1 B1 ..",
            ".. B1 B1 B1 B1 .. .."
        ],
               'gift': [
            ".. .. GL .. GL .. ..",
            ".. GL GL GL GL GL ..",
            "DG DG DG DG DG DG DG",
            "DG LP LP GL LP LP DG",
            "DG LP LP GL LP LP DG",
            "DG LP LP GL LP LP DG",
            "DG DG DG DG DG DG DG",
            ".. .. .. .. .. .. .."
      
        ],
        'lake': [
            ".. .. .. G1 G1 .. .. .. .. ..",
            ".. .. G1 G2 G1 G1 .. .. .. ..",
            ".. G1 G2 G1 G2 G1 G1 .. .. ..",
            ".. .. .. BR BR .. .. .. .. ..",
            ".. .. .. BR BR .. .. .. .. ..",
            ".. BL BL BL BL BL BL .. .. ..",
            "BL W1 BL BL BL BL W1 BL .. ..",
            "BL BL BL W1 BL BL BL BL BL ..",
            ".. BL BL BL BL BL W1 BL .. ..",
            ".. .. BL BL BL BL BL .. .. .."
        ],
        'london': [
            ".. .. .. .. B1 B1 .. .. .. ..",
            ".. .. .. B1 GR GR B1 .. .. ..",
            ".. .. B1 GR GR GR GR B1 .. ..",
            ".. .. B1 GR Y1 Y1 GR B1 .. ..",
            ".. .. B1 GR Y1 Y1 GR B1 .. ..",
            ".. .. B1 GR GR GR GR B1 .. ..",
            ".. .. B1 GR W1 W1 GR B1 .. ..",
            ".. .. B1 GR W1 W1 GR B1 .. ..",
            "B1 B1 B1 B1 B1 B1 B1 B1 B1 B1",
            "GR GR GR GR GR GR GR GR GR GR"
        ],
        'library': [
            "BR BR BR BR BR BR BR BR BR BR",
            "BR R1 R1 BR BL BL BR G1 G1 BR",
            "BR W1 W1 BR W1 W1 BR W1 W1 BR",
            "BR BR BR BR BR BR BR BR BR BR",
            "BR Y1 Y1 BR P1 P1 BR W1 W1 BR",
            "BR W1 W1 BR W1 W1 BR W1 W1 BR",
            "BR BR BR BR BR BR BR BR BR BR",
            "BR BL BL BR R1 R1 BR G1 G1 BR",
            "BR W1 W1 BR W1 W1 BR W1 W1 BR",
            "BR BR BR BR BR BR BR BR BR BR"
        ],
        'room': [
            ".. .. .. .. R1 R1 .. .. .. ..",
            ".. .. .. R1 R1 R1 R1 .. .. ..",
            ".. .. R1 R1 R1 R1 R1 R1 .. ..",
            ".. R1 R1 R1 R1 R1 R1 R1 R1 ..",
            "B1 B1 B1 B1 B1 B1 B1 B1 B1 B1",
            "B1 W1 W1 W1 W1 W1 W1 W1 W1 B1",
            "B1 W1 BL BL W1 W1 BL BL W1 B1",
            "B1 W1 BL BL W1 W1 BL BL W1 B1",
            "B1 W1 W1 W1 BR BR W1 W1 W1 B1",
            "B1 B1 B1 B1 BR BR B1 B1 B1 B1"
        ]
    };

    // --- æ–°å¢ï¼šæ§åˆ¶ç‰©å“æ˜¾ç¤º 3 ç§’çš„å‡½æ•° ---
    window.currentShowingItem = null;
    function showItem(itemName) {
        window.currentShowingItem = itemName;
        drawNoah();
        setTimeout(() => {
            window.currentShowingItem = null;
            drawNoah();
        }, 3000); // ç‰©å“ä¼šåœ¨è¯ºäºšæ—è¾¹æ˜¾ç¤º3ç§’ç„¶åæ¶ˆå¤±
    }
    const pixelMap = [
        ".. .. .. .. .. .. .. H7 H7 H7 H7 H7 H7 .. .. .. .. .. .. ..",
        ".. .. .. .. .. H7 H6 H6 H6 H6 H6 H6 H6 H6 H7 .. .. .. .. ..",
        ".. .. .. H7 H7 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H7 H7 .. .. ..",
        ".. .. H7 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H7 .. ..",
        ".. H7 H6 H6 H6 H7 H7 H6 H6 H6 H6 H6 H6 H7 H7 H6 H6 H6 H7 ..",
        "H7 H6 H6 H6 H7 H7 H6 H6 H6 H6 H6 H6 H6 H6 H7 H7 H6 H6 H6 H7",
        "H7 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H7",
        "H7 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H7 H6 H6 H6 H6 H6 H6 H7",
        "H7 H6 H6 H6 H6 H6 H6 H6 H6 H7 H6 H6 H7 H6 H6 H6 H6 H7 H6 H7",
        "H7 H6 H6 H7 H6 H6 H6 H6 H6 H7 H6 H6 H7 H6 H6 H6 H6 H6 H7 H7",
        "H7 H6 H7 H6 H6 H7 H6 H7 E16 H7 H6 H7 E16 H7 H6 H6 H7 H6 H6 H7",
        ".. H7 H7 H6 H7 H7 H7 E16 E16 H7 E16 E16 E16 H7 H7 H6 H7 H7 ..",
        ".. .. H7 H6 H7 E16 C4 C4 E16 E16 E16 E16 C4 C4 E16 H7 H6 H7 ..",
        ".. .. H7 H7 E2 E16 C3 C3 E16 E16 E16 E16 C3 C3 E16 E2 H7 H7 ..",
        ".. .. .. H7 H7 E2 E2 E16 E16 E16 E16 E16 E16 E2 E2 H7 H7 .. ..",
        ".. .. .. .. H7 H7 H7 C16 E16 H2 E16 C16 H7 H7 H7 .. .. .. ..",
        ".. .. .. .. .. H7 H6 C16 C16 C16 C16 C16 H6 H7 .. .. .. .. ..",
        ".. .. .. .. H7 H6 H6 C16 H3 H6 H3 C16 H6 H6 H7 .. .. .. ..",
        ".. .. .. H7 H6 H6 H6 C16 C16 C16 C16 C16 H6 H6 H6 H7 .. .. ..",
        ".. .. .. H7 E16 E16 H7 H6 H3 H6 H3 H6 H7 E16 E16 H7 .. .. ..",
        ".. .. .. .. H7 H7 H7 H6 C16 H6 C16 H6 H7 H7 H7 .. .. .. ..",
        ".. .. .. .. .. H7 H6 H6 H6 H7 H6 H6 H6 H7 .. .. .. .. ..",
        ".. .. .. .. .. .. H7 H5 H5 H7 H5 H5 H7 .. .. .. .. ..",
        ".. .. .. .. .. .. .. H7 H7 .. H7 H7 .. .. .. .. .. .." 
    ];
    // æ§åˆ¶è¯ºäºšè¡¨æƒ…çš„çŠ¶æ€æœº
    let currentFace = 'normal';

    // é—­çœ¼è´´å›¾ (æŠŠçœ¼ç›å˜æˆè‚¤è‰²å¹¶åŠ ä¸Šç«æ¯›æ¨ªçº¿)
    const pixelMap_blink = [
        ".. .. .. .. .. .. .. H7 H7 H7 H7 H7 H7 .. .. .. .. .. .. ..",
        ".. .. .. .. .. H7 H6 H6 H6 H6 H6 H6 H6 H6 H7 .. .. .. .. ..",
        ".. .. .. H7 H7 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H7 H7 .. .. ..",
        ".. .. H7 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H7 .. ..",
        ".. H7 H6 H6 H6 H7 H7 H6 H6 H6 H6 H6 H6 H7 H7 H6 H6 H6 H7 ..",
        "H7 H6 H6 H6 H7 H7 H6 H6 H6 H6 H6 H6 H6 H6 H7 H7 H6 H6 H6 H7",
        "H7 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H7",
        "H7 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H7 H6 H6 H6 H6 H6 H6 H7",
        "H7 H6 H6 H6 H6 H6 H6 H6 H6 H7 H6 H6 H7 H6 H6 H6 H6 H7 H6 H7",
        "H7 H6 H6 H7 H6 H6 H6 H6 H6 H7 H6 H6 H7 H6 H6 H6 H6 H6 H7 H7",
        "H7 H6 H7 H6 H6 H7 H6 H7 E16 H7 H6 H7 E16 H7 H6 H6 H7 H6 H6 H7",
        ".. H7 H7 H6 H7 H7 H7 E16 E16 H7 E16 E16 E16 H7 H7 H6 H7 H7 ..",
        ".. .. H7 H6 H7 E16 E16 E16 E16 E16 E16 E16 E16 E16 E16 H7 H6 H7 ..", 
        ".. .. H7 H7 E2 E16 H7 H7 E16 E16 E16 E16 H7 H7 E16 E2 H7 H7 ..", 
        ".. .. .. H7 H7 E2 E2 E16 E16 E16 E16 E16 E16 E2 E2 H7 H7 .. ..",
        ".. .. .. .. H7 H7 H7 C16 E16 H2 E16 C16 H7 H7 H7 .. .. .. ..",
        ".. .. .. .. .. H7 H6 C16 C16 C16 C16 C16 H6 H7 .. .. .. .. ..",
        ".. .. .. .. H7 H6 H6 C16 H3 H6 H3 C16 H6 H6 H7 .. .. .. ..",
        ".. .. .. H7 H6 H6 H6 C16 C16 C16 C16 C16 H6 H6 H6 H7 .. .. ..",
        ".. .. .. H7 E16 E16 H7 H6 H3 H6 H3 H6 H7 E16 E16 H7 .. .. ..",
        ".. .. .. .. H7 H7 H7 H6 C16 H6 C16 H6 H7 H7 H7 .. .. .. ..",
        ".. .. .. .. .. H7 H6 H6 H6 H7 H6 H6 H6 H7 .. .. .. .. ..",
        ".. .. .. .. .. .. H7 H5 H5 H7 H5 H5 H7 .. .. .. .. ..",
        ".. .. .. .. .. .. .. H7 H7 .. H7 H7 .. .. .. .. .. .." 
    ];

    // å®³ç¾è´´å›¾ (åŠ æ·±çº¢æ™•èŒƒå›´)
    const pixelMap_shy = [
        ".. .. .. .. .. .. .. H7 H7 H7 H7 H7 H7 .. .. .. .. .. .. ..",
        ".. .. .. .. .. H7 H6 H6 H6 H6 H6 H6 H6 H6 H7 .. .. .. .. ..",
        ".. .. .. H7 H7 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H7 H7 .. .. ..",
        ".. .. H7 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H7 .. ..",
        ".. H7 H6 H6 H6 H7 H7 H6 H6 H6 H6 H6 H6 H7 H7 H6 H6 H6 H7 ..",
        "H7 H6 H6 H6 H7 H7 H6 H6 H6 H6 H6 H6 H6 H6 H7 H7 H6 H6 H6 H7",
        "H7 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H7",
        "H7 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H6 H7 H6 H6 H6 H6 H6 H6 H7",
        "H7 H6 H6 H6 H6 H6 H6 H6 H6 H7 H6 H6 H7 H6 H6 H6 H6 H7 H6 H7",
        "H7 H6 H6 H7 H6 H6 H6 H6 H6 H7 H6 H6 H7 H6 H6 H6 H6 H6 H7 H7",
        "H7 H6 H7 H6 H6 H7 H6 H7 E16 H7 H6 H7 E16 H7 H6 H6 H7 H6 H6 H7",
        ".. H7 H7 H6 H7 H7 H7 E16 E16 H7 E16 E16 E16 H7 H7 H6 H7 H7 ..",
        ".. .. H7 H6 H7 E16 C4 C4 E16 E16 E16 E16 C4 C4 E16 H7 H6 H7 ..",
        ".. .. H7 H7 E3 E2 C3 C3 E16 E16 E16 E16 C3 C3 E2 E3 H7 H7 ..", 
        ".. .. .. H7 H7 E3 E3 E2 E16 E16 E16 E16 E2 E3 E3 H7 H7 .. ..", 
        ".. .. .. .. H7 H7 H7 C16 E16 H2 E16 C16 H7 H7 H7 .. .. .. ..",
        ".. .. .. .. .. H7 H6 C16 C16 C16 C16 C16 H6 H7 .. .. .. .. ..",
        ".. .. .. .. H7 H6 H6 C16 H3 H6 H3 C16 H6 H6 H7 .. .. .. ..",
        ".. .. .. H7 H6 H6 H6 C16 C16 C16 C16 C16 H6 H6 H6 H7 .. .. ..",
        ".. .. .. H7 E16 E16 H7 H6 H3 H6 H3 H6 H7 E16 E16 H7 .. .. ..",
        ".. .. .. .. H7 H7 H7 H6 C16 H6 C16 H6 H7 H7 H7 .. .. .. ..",
        ".. .. .. .. .. H7 H6 H6 H6 H7 H6 H6 H6 H7 .. .. .. .. ..",
        ".. .. .. .. .. .. H7 H5 H5 H7 H5 H5 H7 .. .. .. .. ..",
        ".. .. .. .. .. .. .. H7 H7 .. H7 H7 .. .. .. .. .. .." 
    ];
       function drawNoah() {
        if (noah.isAway) { ctx.clearRect(0, 0, 20, 26); return; }
        ctx.clearRect(0, 0, 20, 26);
        let currentMap;
        if (currentFace === 'blink') {
            currentMap = [...pixelMap_blink];
        } else if (currentFace === 'shy') {
            currentMap = [...pixelMap_shy];
        } else {
            currentMap = [...pixelMap];
        }
        // ç”»å‡ºè¯ºäºš
        for (let y = 0; y < currentMap.length; y++) {
            let rowColors = currentMap[y].trim().split(/\s+/);
            for (let x = 0; x < rowColors.length; x++) {
                let color = palette[rowColors[x]];
                if (color) { ctx.fillStyle = color; ctx.fillRect(x, y, 1, 1); }
            }
        }
        // --- æ–°å¢ï¼šç”»å‡ºä½ æŠ•å–‚æˆ–è´­ä¹°çš„å°ç‰©å“ ---
        if (window.currentShowingItem && sprites[window.currentShowingItem]) {
            let itemMap = sprites[window.currentShowingItem];
            let startX = 13; // å›ºå®šåœ¨è¯ºäºšçš„å³ä¸‹è§’
            let startY = 17; 
            for (let y = 0; y < itemMap.length; y++) {
                let rowColors = itemMap[y].trim().split(/\s+/);
                for (let x = 0; x < rowColors.length; x++) {
                    let color = palette[rowColors[x]];
                    if (color) { ctx.fillStyle = color; ctx.fillRect(startX + x, startY + y, 1, 1); }
                }
            }
        }
    }

    // --- æåº¦ä¸°å¯Œçš„å¤–å‡ºäº‹ä»¶åº“ (6ä¸ªåœ°ç‚¹ x 10+äº‹ä»¶) ---
    const locations = {
        "london": {
            name: "ä¼¦æ•¦è¡—å¤´ (é›¨å¤œ)",
            icon: "â˜”",
            desc: "æˆ‘ä»¬çš„â€œæ— é™â€ä¹‹åœ°ã€‚é€‚åˆçº¦ä¼šï¼Œä½†èŠ±é”€è¾ƒå¤§ã€‚",
            cost: { hunger: 15, health: 5, gold: 30 }, // æ¶ˆè€—é«˜
            events: [
                { text: "ä¸‹é›¨äº†ï¼Œä»–ç”¨ç°è‰²ç¾½ç»’æœæŠŠä½ è£¹è¿›æ€€é‡Œã€‚", diff: { love: 25, mood: 20 }, reply: "â€œå†·å—ï¼Ÿé è¿‘ç‚¹ã€‚è¿™ä»¶è¡£æœä¹°æ¥å°±æ˜¯ä¸ºäº†æ­¤åˆ»èƒ½è£…ä¸‹ä¸¤ä¸ªäººã€‚â€" },
                { text: "è·¯è¿‡ä¸€å®¶éº»ç“œå”±ç‰‡åº—ï¼Œé‡Œé¢åœ¨æ”¾è«æ‰ç‰¹ã€‚", diff: { mood: 15, love: 10 }, reply: "â€œå¤å…¸ä¹å’Œé›¨å£°å¾ˆé…ï¼Œå°±åƒæˆ‘å’Œä½ ã€‚è¿›å»çœ‹çœ‹ï¼Ÿä¹Ÿè®¸èƒ½æ‰¾åˆ°é‚£å¼ æˆ‘ä»¬è¦çš„é»‘èƒ¶ã€‚â€" },
                { text: "åœ¨è¡—è§’èŠ±åº—ä¹°äº†ä¸€æŸèŒ‰è‰èŠ±ã€‚", diff: { gold: -20, love: 20 }, reply: "â€œè™½ç„¶æˆ‘å–œæ¬¢èŒ‰è‰åªæ˜¯å› ä¸ºå¥½é—»ï¼Œä½†ç°åœ¨å®ƒä»£è¡¨æˆ‘é‚£ä¸ªåœ¨é›¨ä¸­å‚»ç¬‘çš„å¥³æœ‹å‹ã€‚â€" },
                { text: "åœ¨æ³°æ™¤å£«æ²³æ—é—²é€›ï¼Œè®¨è®ºå“²å­¦æ‚–è®ºã€‚", diff: { mood: 30, gold: 0 }, reply: "â€œå¡ç¿å¤±é©¬ï¼Œç„‰çŸ¥éç¦ã€‚å°±åƒæˆ‘å³ä½¿å¤±å»äº†æ•´ä¸ªä¸–ç•Œï¼Œåªè¦ä½ åœ¨ï¼Œæˆ‘å°±èµ¢äº†ã€‚â€" },
                { text: "å»ä¾¿åˆ©åº—ä¹°äº†ä¸€ç½ç¢³é…¸é¥®æ–™ã€‚", diff: { hunger: 10, gold: -5 }, reply: "â€œå‘²â€”â€”æ°”æ³¡éŸ³ã€‚ç»™ï¼Œç¬¬ä¸€å£ç»™ä½ ã€‚è¿™å¯æ˜¯éº»ç“œä¸–ç•Œçš„é­”è¯ã€‚â€" },
                { text: "å¶é‡ä¸€å®¶ç”µç©åŸï¼Œä»–éè¦å’Œä½ æ¯”èµ›è½¦ã€‚", diff: { mood: 20, love: 10, gold: -20 }, reply: "â€œæˆ‘èµ¢äº†ã€‚ä½œä¸ºå¥–åŠ±ï¼Œä»Šæ™šä½ è¦ä¸€ç›´ç‰µç€æˆ‘çš„æ‰‹ï¼Œä¸è®¸æ”¾å¼€ã€‚â€" },
                { text: "åœ¨çº¢ç»¿ç¯ä¸‹ï¼Œä»–çªç„¶å»äº†ä½ ã€‚", diff: { love: 40, mood: 40 }, reply: "â€œç»¿ç¯äº®äº†ï¼Œä½†æˆ‘ä¸æƒ³èµ°ã€‚è®©æ•´ä¸ªä¼¦æ•¦éƒ½ç­‰ç€å§ï¼Œæˆ‘ç°åœ¨åªæƒ³å»æˆ‘çš„ä¼½æ‹‰æã€‚â€" },
                { text: "çœ‹åˆ°ä¸€åªæ·‹æ¹¿çš„æµæµªçŒ«ã€‚", diff: { mood: 10, love: 10 }, reply: "â€œçœ¼ç¥åƒä½ çŠ¯é”™æ—¶ä¸€æ ·æ— è¾œã€‚å¥½å§ï¼Œæˆ‘ä»¬ç»™å®ƒä¹°ç‚¹åƒçš„ï¼Œä½†ä¸èƒ½å¸¦å›å®¶ï¼Œå®¶é‡Œåªèƒ½æœ‰ä½ ä¸€ä¸ªå°éº»çƒ¦ã€‚â€" },
                { text: "è·¯è¿‡ç”µå½±é™¢ï¼Œæ­£åœ¨æ”¾æ˜ é’æ˜¥ç‰‡ã€‚", diff: { gold: -30, love: 15 }, reply: "â€œè™½ç„¶å‰§æƒ…çƒ‚ä¿—ï¼Œä½†æˆ‘ä¹æ„é™ªä½ çœ‹ã€‚å› ä¸ºé»‘æš—ä¸­æˆ‘å¯ä»¥è‚†æ— å¿Œæƒ®åœ°çœ‹ç€ä½ çš„ä¾§è„¸ã€‚â€" },
                { text: "åœ¨å¨æ–¯æ•æ–¯ç‰¹ç«™å£ï¼Œä»–åƒå¾€å¸¸ä¸€æ ·ç­‰ä½ ã€‚", diff: { love: 30 }, reply: "â€œå‘¨äº”çš„çº¦å®šã€‚ä¸ç®¡å‘ç”Ÿä»€ä¹ˆï¼Œæˆ‘éƒ½ä¼šåœ¨è¿™é‡Œã€‚å“ªæ€•ä¸–ç•Œæœ«æ—¥ã€‚â€" }
            ]
        },
        "library": {
            name: "éœæ ¼æ²ƒå…¹å›¾ä¹¦é¦†",
            icon: "ğŸ“–",
            desc: "æ‹‰æ–‡å…‹åŠ³çš„ä¸»åœºã€‚å®‰é™ï¼Œçœé’±ï¼Œå¢é•¿æ™ºæ…§ã€‚",
            cost: { hunger: 10, health: 0, gold: 0 },
            events: [
                { text: "ä½ ä»¬åœ¨å¹³æ–¯å¤«äººçš„çœ¼çš®åº•ä¸‹ä¼ é€’çº¸æ¡ã€‚", diff: { love: 10, mood: 10 }, reply: "çº¸æ¡ä¸Šå†™ç€ï¼šâ€˜ç¬¬7æ’ä¹¦æ¶åè§ï¼Œæƒ³ä½ äº†ã€‚ç½²åï¼šä½ å¸…æ°”çš„BFâ€™" },
                { text: "ä»–å¸®ä½ è¡¥ä¹ é­”è¯å­¦è®ºæ–‡ã€‚", diff: { mood: 15 }, reply: "â€œè¿™é‡Œå†™é”™äº†ã€‚ä½ æ˜¯æƒ³æŠŠå©åŸšç‚¸äº†å—ï¼Ÿç¬¨è›‹ï¼Œçœ‹ç€æˆ‘ï¼Œå†è®²ä¸€éã€‚â€" },
                { text: "åœ¨ç¦ä¹¦åŒºé—¨å£æ¢å¤´æ¢è„‘ã€‚", diff: { mood: 20, love: 10 }, reply: "â€œæƒ³è¿›å»ï¼Ÿåªè¦ä½ å¼€å£ï¼Œæˆ‘å°±èƒ½å¸¦ä½ æºœè¿›å»ã€‚åæ­£ä¹Ÿä¸æ˜¯ç¬¬ä¸€æ¬¡è¿åæ ¡è§„äº†ã€‚â€" },
                { text: "ä»–çœ‹ç€ä¹¦ç¡ç€äº†ï¼Œç«æ¯›å¾ˆé•¿ã€‚", diff: { love: 20 }, reply: "ï¼ˆä½ å·å·äº²äº†ä»–ä¸€ä¸‹ï¼‰ä»–é—­ç€çœ¼å‹¾èµ·å˜´è§’ï¼šâ€œå·è¢­ï¼Ÿè®°åœ¨è´¦ä¸Šäº†ï¼Œé†’æ¥åç™¾å€å¥‰è¿˜ã€‚â€" },
                { text: "ä¸ºäº†ä¸€ä¸ªå­¦æœ¯é—®é¢˜äº‰è®ºä¸ä¼‘ã€‚", diff: { mood: 10 }, reply: "â€œç¼¸ä¸­ä¹‹è„‘...å¥½å§ï¼Œä¹Ÿè®¸ä½ è¯´å¾—å¯¹ã€‚ä½†æˆ‘æ›´æ„¿æ„ç›¸ä¿¡æˆ‘çš„å¤§è„‘æ­¤åˆ»æ„Ÿå—åˆ°çš„å¯¹ä½ çš„çˆ±æ˜¯çœŸå®çš„ã€‚â€" },
                { text: "é‡åˆ°äº†æ³•æ–¯ç‰¹Â·èµ›è‚¯å¾·ï¼Œæ°”æ°›å°´å°¬ã€‚", diff: { mood: -10 }, reply: "è¯ºäºšå†·å†·åœ°çœ‹äº†ä»–ä¸€çœ¼ï¼ŒæŠŠä½ æ‹‰åˆ°èº«åï¼šâ€œè®©å¼€ï¼Œä½ æŒ¡ä½æˆ‘ä»¬è¦æ‰¾çš„ä¹¦äº†ã€‚â€" },
                { text: "æ‰¾åˆ°ä¸€æœ¬å…³äºå¤ä»£å¦‚å°¼æ–‡çš„æ—§ä¹¦ã€‚", diff: { mood: 20 }, reply: "â€œè™½ç„¶æ™¦æ¶©ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä¸€èµ·ç ´è¯‘ã€‚å°±åƒæˆ‘ä»¬ä¸€èµ·æ¢ç´¢è¿™ä¸ªä¸–ç•Œä¸€æ ·ã€‚â€" },
                { text: "çª—å¤–ä¸‹èµ·äº†é›ªï¼Œå®¤å†…å¾ˆæ¸©æš–ã€‚", diff: { hunger: -5, love: 15 }, reply: "â€œå¦‚æœæ—¶é—´èƒ½åœåœ¨è¿™ä¸€åˆ»å°±å¥½äº†ã€‚åªæœ‰ä¹¦é¦™ï¼Œé›ªï¼Œå’Œä½ ã€‚â€" },
                { text: "ä»–ç”¨é­”æ³•å˜å‡ºä¸€æœµè“è‰²çš„å°èŠ±å¤¹åœ¨ä½ ä¹¦é‡Œã€‚", diff: { love: 15 }, reply: "â€œä¹¦çœ‹ç´¯äº†å°±çœ‹èŠ±ï¼ŒèŠ±çœ‹ç´¯äº†...å°±çœ‹æˆ‘ã€‚æˆ‘æ¯”èŠ±å¥½çœ‹ã€‚â€" },
                { text: "ä½ ä»¬å…±ç”¨ä¸€å‰¯è€³æœºå¬éº»ç“œéŸ³ä¹ã€‚", diff: { mood: 20 }, reply: "â€œåˆ«å‘Šè¯‰åˆ«äººæˆ‘åœ¨å¬è¿™ä¸ªã€‚è¿™æ˜¯å±äºæˆ‘ä»¬ä¸¤ä¸ªçš„å°ç§˜å¯†ã€‚â€" }
            ]
        },
        "lake": {
            name: "é»‘æ¹– / ç¦æ—è¾¹ç¼˜",
            icon: "ğŸŒ²",
            desc: "å†’é™©è€…çš„ä¹å›­ã€‚å¯èƒ½å—ä¼¤ï¼Œä¹Ÿå¯èƒ½æ¡åˆ°å®è—ã€‚",
            cost: { hunger: 20, health: 15, gold: 0 },
            events: [
                { text: "åœ¨ç¦æ—è¾¹ç¼˜å‘ç°äº†ä¸€ä¸ªå¤è€çš„å®ç®±ï¼", diff: { gold: 100, mood: 20 }, reply: "â€œçœ‹æ¥å¹¸è¿å¥³ç¥ä»Šå¤©åçˆ±ä½ ã€‚å…¨éƒ¨å½’ä½ ï¼Œæˆ‘åªè¦ä½ å¼€å¿ƒã€‚â€ (è·å¾—100G)" },
                { text: "é‡åˆ°äº†å·¨å¤§çš„é»‘æ¹–é±¿é±¼ï¼Œè¢«æ³¼äº†ä¸€èº«æ°´ã€‚", diff: { health: -10, mood: -10 }, reply: "â€œè¯¥æ­»ï¼æ¸…ç†ä¸€æ–°ï¼è¿™è§¦æ‰‹æ€ªæ˜¯ä¸æ˜¯å«‰å¦’æˆ‘é•¿å¾—å¸…ï¼Ÿâ€" },
                { text: "åœ¨è‰ä¸›é‡Œæ¡åˆ°äº†ä¸€äº›ç¨€æœ‰è‰è¯ã€‚", diff: { gold: 40, mood: 10 }, reply: "â€œæ–¯æ™®åŠ³ç‰¹æ•™æˆä¼šå–œæ¬¢è¿™ä¸ªçš„ï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥æ‹¿å»å–äº†æ¢é»„æ²¹å•¤é…’ã€‚â€ (è·å¾—40G)" },
                { text: "ä¸ºäº†æ‘˜æ‚¬å´–è¾¹çš„ä¸€æœµèŠ±ï¼Œä»–æ‘”ä¼¤äº†æ‰‹è‡‚ã€‚", diff: { health: -30, love: 30 }, reply: "â€œå˜¶...åˆ«å“­ã€‚è¿™ç‚¹ä¼¤æ¢ä½ ç¬‘ä¸€ä¸‹ï¼Œå€¼äº†ã€‚ä½ çœ‹ï¼ŒèŠ±å¾ˆç¾ï¼Œåƒä½ ã€‚â€" },
                { text: "å¶é‡ä¸€åªè¿·è·¯çš„å°ç‹¬è§’å…½ã€‚", diff: { mood: 30, love: 10 }, reply: "â€œå®ƒè®©ä½ æ‘¸ï¼Ÿå“¼ï¼Œçœ‹æ¥çº¯æ´çš„ç”Ÿç‰©éƒ½å–œæ¬¢ä½ ã€‚ä½†æˆ‘æ‰æ˜¯æœ€å–œæ¬¢ä½ çš„é‚£ä¸ªã€‚â€" },
                { text: "é‡åˆ°äº†æ­£åœ¨å·¡é€»çš„æµ·æ ¼ã€‚", diff: { hunger: -20 }, reply: "â€œå²©çš®é¥¼ï¼Ÿå“¦ä¸...ä¸ºäº†ç‰™é½¿ç€æƒ³ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¿«è·‘å§ã€‚â€ (å› é€ƒè·‘æ¶ˆè€—é¥±é£Ÿ)" },
                { text: "åœ¨æ¹–è¾¹æ‰“æ°´æ¼‚ï¼Œä»–ç«Ÿç„¶è¾“ç»™äº†ä½ ã€‚", diff: { mood: 15 }, reply: "â€œæˆ‘é‚£æ˜¯è®©ç€ä½ ï¼å¥½å§ï¼Œæ„¿èµŒæœè¾“ï¼ŒèƒŒä½ å›åŸå ¡ã€‚â€" },
                { text: "å‘ç°äº†é©¬äººç•™ä¸‹çš„é¢„è¨€çŸ³æ¿ã€‚", diff: { gold: 60 }, reply: "â€œæ˜Ÿè±¡è¯´ä»Šæ™šä¼šæœ‰å¥½äº‹å‘ç”Ÿ...æ¯”å¦‚ï¼Œä½ ä¼šè¯·æˆ‘åƒå¤œå®µï¼Ÿâ€ (è·å¾—60G)" },
                { text: "è¢«ä¸€ç¾¤æŠ¤æ ‘ç½—é”…å›´æ”»ã€‚", diff: { health: -15, mood: -5 }, reply: "â€œåˆ«æ€•ï¼Œèº²æˆ‘èº«åï¼è¿™äº›å°ä¸œè¥¿è„¾æ°”çœŸæš´èºã€‚â€" },
                { text: "åœ¨æ¹–è¾¹çœ‹å¤•é˜³ï¼Œæ°´é¢æ³¢å…‰ç²¼ç²¼ã€‚", diff: { love: 20, mood: 20 }, reply: "â€œäººä¸èƒ½ä¸¤æ¬¡è¸è¿›åŒä¸€æ¡æ²³æµï¼Œä½†æˆ‘ä¼šæ— æ•°æ¬¡çˆ±ä¸ŠåŒä¸€ä¸ªä½ ã€‚â€" }
            ]
        },
        "hogsmeade": {
            name: "éœæ ¼è«å¾·æ‘",
            icon: "ğŸº",
            desc: "çƒ­é—¹çš„å·«å¸ˆæ‘è½ã€‚åƒå–ç©ä¹ï¼Œæ¶ˆè€—é‡‘å¸ã€‚",
            cost: { hunger: -30, health: 5, gold: 40 }, // å›å¤é¥±é£Ÿ
            events: [
                { text: "åœ¨ä¸‰æŠŠæ‰«å¸šå–çƒ­é»„æ²¹å•¤é…’ã€‚", diff: { hunger: 20, mood: 20 }, reply: "â€œä½ å˜´å”‡ä¸Šæœ‰æ³¡æ²«...åˆ«åŠ¨ï¼Œæˆ‘å¸®ä½ æ“¦ã€‚â€ï¼ˆä»–å‡‘è¿‡æ¥å»æ‰äº†æ³¡æ²«ï¼‰" },
                { text: "åœ¨èœ‚èœœå…¬çˆµä¹°äº†ä¸€å¤§å †ç³–æœã€‚", diff: { hunger: 10, gold: -20 }, reply: "â€œå¼ å˜´ã€‚ç”œå—ï¼Ÿå†ç”œä¹Ÿæ²¡æœ‰ä½ ç”œã€‚â€" },
                { text: "å»äº†ä½ç§‘ç¬‘è¯åº—ï¼Œä¹°äº†ä¸ªæ¶ä½œå‰§é“å…·ã€‚", diff: { gold: -15, mood: 15 }, reply: "â€œæˆ‘æƒ³æŠŠè¿™ä¸ªæ”¾åœ¨å¸ƒé›·æ–¯çš„æ•å¤´ä¸‹...å˜˜ï¼Œè¿™æ˜¯æˆ‘ä»¬å…±çŠ¯çš„è¯æ˜ã€‚â€" },
                { text: "åœ¨å¸•ç¬›èŠ™å¤«äººèŒ¶é¦†ï¼Œè¢«æƒ…ä¾£ä»¬é—ªçäº†çœ¼ã€‚", diff: { mood: -5, love: 10 }, reply: "â€œè¿™é‡Œå¤ªç²‰çº¢äº†ï¼Œå—ä¸äº†ã€‚ä½†å¦‚æœæ˜¯å’Œä½ åœ¨ä¸€èµ·...å‹‰å¼ºå¯ä»¥å¿å—ã€‚â€" },
                { text: "é‡åˆ°äº†æ­£åœ¨çº¦ä¼šçš„å¾·æ‹‰ç§‘Â·é©¬å°”ç¦ã€‚", diff: { mood: 0 }, reply: "â€œçœ‹ä»€ä¹ˆçœ‹ï¼Œé©¬å°”ç¦ï¼Ÿå†çœ‹æŠŠä½ å˜æˆç™½é¼¬ã€‚èµ°å§ï¼Œåˆ«ç†ä»–ã€‚â€" },
                { text: "åœ¨é‚®å±€ç»™æœªæ¥çš„æˆ‘ä»¬å†™äº†ä¸€å°ä¿¡ã€‚", diff: { love: 20 }, reply: "â€œæ”¶ä»¶äººï¼šè¯ºäºšå’Œä»–çš„å¦»å­ã€‚å¯„å‡ºæ—¶é—´ï¼šç°åœ¨ã€‚å¸Œæœ›æœªæ¥çš„æˆ‘ä¾ç„¶è¿™ä¹ˆå¸…ã€‚â€" },
                { text: "çªé™å¤§é›ªï¼Œèº²è¿›ä¸€å®¶åºŸå¼ƒçš„å°å±‹ã€‚", diff: { love: 30 }, reply: "â€œè¿™åœºæ™¯åƒä¸åƒç”µå½±ï¼Ÿåªæœ‰æˆ‘ä»¬ä¸¤ä¸ªï¼Œä¸ä¸–éš”ç»ã€‚çœŸå¸Œæœ›é›ªæ°¸è¿œä¸åœã€‚â€" },
                { text: "ä¹°äº†å°–å«æ¸¸ä¹å›­çš„é—¨ç¥¨ã€‚", diff: { health: -5, mood: 25, gold: -30 }, reply: "â€œä½ å°–å«çš„æ ·å­çœŸå¯çˆ±ã€‚å®³æ€•å°±æŠ±ç´§æˆ‘ï¼Œè¿™å°±æ˜¯æˆ‘å­˜åœ¨çš„æ„ä¹‰ã€‚â€" },
                { text: "åœ¨æ–‡äººå±…ç¾½æ¯›ç¬”åº—æŒ‘äº†ä¸€æ”¯ç¬”ã€‚", diff: { gold: -10, mood: 10 }, reply: "â€œç”¨è¿™æ”¯ç¬”å†™ç»™ä½ çš„æƒ…ä¹¦ï¼Œä¼šä¸ä¼šæ›´æœ‰æ–‡é‡‡ä¸€ç‚¹ï¼Ÿâ€" },
                { text: "åœ¨å¤§è¡—ä¸Šå¤§å£°å–Šä½ çš„åå­—ã€‚", diff: { mood: 20, love: 10 }, reply: "â€œæˆ‘è¦è®©æ•´ä¸ªéœæ ¼è«å¾·éƒ½çŸ¥é“ï¼Œä½ æ˜¯æˆ‘çš„ï¼â€" }
            ]
        },
        "room": {
            name: "æœ‰æ±‚å¿…åº”å±‹",
            icon: "ğŸ°",
            desc: "åªå±äºä½ ä»¬çš„ç§˜å¯†åŸºåœ°ã€‚è®­ç»ƒæˆ˜æ–—æˆ–å¯»æ‰¾å¤±ç‰©ã€‚",
            cost: { hunger: 20, health: 15, gold: 0 },
            events: [
                { text: "æŠŠæˆ¿é—´å˜æˆäº†å†³æ–—ä¿±ä¹éƒ¨ï¼Œç»ƒä¹ é™¤ä½ æ­¦å™¨ã€‚", diff: { health: -10, love: 15 }, reply: "â€œååº”ä¸é”™ã€‚ä½†åœ¨æˆ˜åœºä¸Šï¼Œæ•Œäººä¸ä¼šåƒæˆ‘è¿™æ ·èˆä¸å¾—ä¼¤ä½ ã€‚å†æ¥ï¼â€" },
                { text: "åœ¨æ‚ç‰©å †é‡Œæ‰¾åˆ°äº†ä¸€è¢‹è¢«é—å¿˜çš„é‡‘å¸ã€‚", diff: { gold: 80 }, reply: "â€œè¿™æ˜¯è°è—çš„ç§æˆ¿é’±ï¼Ÿç°åœ¨å®ƒæ˜¯æˆ‘ä»¬çš„æ‹çˆ±åŸºé‡‘äº†ã€‚â€ (è·å¾—80G)" },
                { text: "æˆ¿é—´å˜æˆäº†å…¨æ˜¯é•œå­çš„è¿·å®«ã€‚", diff: { mood: 10 }, reply: "â€œå¥½å¤šæˆ‘ï¼Œå¥½å¤šä½ ã€‚æ— è®ºä½ çœ‹å‘å“ªé‡Œï¼Œçœ‹åˆ°çš„éƒ½æ˜¯æˆ‘ä»¬åœ¨ä¸€èµ·çš„æ ·å­ã€‚â€" },
                { text: "ä»–æ•™ä½ å‘¼ç¥æŠ¤å«ï¼Œä»–çš„å®ˆæŠ¤ç¥æ˜¯ä¸€åªå†°åŸç‹¼ã€‚", diff: { love: 25, mood: 20 }, reply: "â€œæƒ³ç€æœ€å¿«ä¹çš„è®°å¿†...å¯¹æˆ‘æ¥è¯´ï¼Œé‚£æ®µè®°å¿†å°±æ˜¯é‡åˆ°ä½ çš„é‚£å¤©ã€‚â€" },
                { text: "æˆ¿é—´å˜æˆäº†ä¸€ç‰‡æŸ”è½¯çš„äº‘æµ·ã€‚", diff: { health: 10, mood: 20 }, reply: "ï¼ˆèººåœ¨äº‘ä¸Šï¼‰â€œå¦‚æœç´¯äº†å°±ç¡ä¸€ä¼šã€‚æˆ‘ä¼šå®ˆç€ä½ ï¼Œè¿å™©æ¢¦éƒ½ä¸æ•¢é è¿‘ã€‚â€" },
                { text: "ç»ƒä¹ å¤§è„‘å°é—­æœ¯ï¼Œä»–å¯¹ä½ æ•å¼€äº†å¿ƒæ‰‰ã€‚", diff: { love: 30 }, reply: "â€œçœ‹åˆ°äº†å—ï¼Ÿæˆ‘çš„è„‘æµ·é‡Œï¼Œé™¤äº†é‚£äº›ä¹±ä¸ƒå…«ç³Ÿçš„ç†è®ºï¼Œå‰©ä¸‹çš„å…¨æ˜¯ä½ ã€‚â€" },
                { text: "æ‰¾åˆ°äº†ä¸€æŠŠæ—§çš„é£å¤©æ‰«å¸šï¼Œåœ¨å±‹é‡Œä½ç©ºé£è¡Œã€‚", diff: { mood: 15, health: -5 }, reply: "â€œæŠ“ç´§æˆ‘ï¼æˆ‘ä»¬è¦æ’ä¸Šå¤©èŠ±æ¿äº†â€”â€”å“ˆå“ˆï¼Œåˆºæ¿€å—ï¼Ÿâ€" },
                { text: "æˆ¿é—´å˜æˆäº†ä¸€ä¸ªå¤å¤çš„èˆå…ã€‚", diff: { love: 20 }, reply: "â€œè¿™ä½ç¾ä¸½çš„å°å§ï¼Œèƒ½è¯·ä½ è·³æ”¯èˆå—ï¼Ÿå°±åƒæˆ‘ä»¬åœ¨ä¼¦æ•¦çœ¼ä¸‹è·³å¼—æ‹‰æ˜æˆˆé‚£æ ·ã€‚â€" },
                { text: "æ„å¤–ç¿»å‡ºäº†è¥¿å¥¥å¤šÂ·è¯ºç‰¹å°æ—¶å€™çš„ç…§ç‰‡ã€‚", diff: { mood: -10 }, reply: "â€œçƒ§äº†å§ã€‚åˆ«è®©è¿™ä¸œè¥¿æ±¡æŸ“äº†æˆ‘ä»¬çš„ç§˜å¯†åŸºåœ°ã€‚â€" },
                { text: "åœ¨è¿™é‡Œä»€ä¹ˆéƒ½ä¸åšï¼Œåªæ˜¯é™é™åœ°æ‹¥æŠ±ã€‚", diff: { mood: 30, love: 20 }, reply: "â€œå¤–é¢ä¸–ç•Œå¾ˆåµï¼Œäººç¾¤å¾ˆåµã€‚åªæœ‰è¿™é‡Œï¼Œåªæœ‰ä½ ï¼Œæ˜¯å®‰é™çš„ã€‚â€" }
            ]
        },
        "astronomy": {
            name: "å¤©æ–‡å¡”é¡¶å±‚",
            icon: "ğŸŒŒ",
            desc: "ç¦»æ˜Ÿæ˜Ÿæœ€è¿‘çš„åœ°æ–¹ã€‚æ·±å¤œï¼Œé«˜å¤„ä¸èƒœå¯’ã€‚",
            cost: { hunger: 10, health: 10, gold: 0 },
            events: [
                { text: "ç”¨æœ›è¿œé•œè§‚æµ‹æœ¨æ˜Ÿçš„å«æ˜Ÿã€‚", diff: { mood: 20 }, reply: "â€œå®‡å®™å¤§çˆ†ç‚¸ï¼Œä¸‡ç‰©è¯ç”Ÿ...è€Œæˆ‘çš„å®‡å®™ä¸­å¿ƒï¼Œæ­¤æ—¶æ­¤åˆ»æ­£ç«™åœ¨æˆ‘èº«è¾¹ã€‚â€" },
                { text: "é«˜å¤„çš„é£å¾ˆå¤§ï¼Œå¹ä¹±äº†ä»–çš„é»‘å‘ã€‚", diff: { love: 15, health: -5 }, reply: "â€œåˆ«åŠ¨ï¼Œè®©æˆ‘å¸®ä½ æŒ¡é£ã€‚è¦æ˜¯ä½ æ„Ÿå†’äº†ï¼Œæˆ‘ä¼šå¿ƒç–¼æ­»çš„ã€‚â€" },
                { text: "åœ¨è¿™é‡Œä¿¯ç°æ•´ä¸ªéœæ ¼æ²ƒå…¹ã€‚", diff: { mood: 15 }, reply: "â€œçœ‹ï¼Œé‚£æ˜¯é»‘æ¹–ï¼Œé‚£æ˜¯çƒåœº...æ€»æœ‰ä¸€å¤©ï¼Œæˆ‘ä¼šå¸¦ä½ å»æ›´è¿œçš„åœ°æ–¹ï¼Œå…¨ä¸–ç•Œé¨æ¸¸ã€‚â€" },
                { text: "æµæ˜Ÿåˆ’è¿‡ï¼Œä½ ä»¬ä¸€èµ·è®¸æ„¿ã€‚", diff: { love: 25 }, reply: "â€œè®¸äº†ä»€ä¹ˆæ„¿ï¼Ÿæƒ³è®©æˆ‘æ´»å‡ ä¸‡å¹´ï¼Ÿå‡†äº†ã€‚æˆ‘è¦ç•™ç€è¿™æ¡å‘½ï¼Œä¸€ç›´çˆ±ä½ ã€‚â€" },
                { text: "é‡åˆ°äº†æ­£åœ¨å¤œå·¡çš„è´¹å°”å¥‡å’Œæ´›ä¸½ä¸å¤«äººã€‚", diff: { mood: -20, health: -10 }, reply: "â€œå¿«è·‘ï¼å¹»èº«å’’ï¼å‘¼...å·®ç‚¹è¢«æŠ“åˆ°ï¼Œä¸è¿‡è¿™å¿ƒè·³åŠ é€Ÿçš„æ„Ÿè§‰ï¼Œè¿˜ä¸é”™ã€‚â€" },
                { text: "åœ¨è¿™é‡Œè·³äº†ä¸€æ”¯æ²¡æœ‰éŸ³ä¹çš„èˆã€‚", diff: { love: 20 }, reply: "â€œæ˜Ÿå…‰å°±æ˜¯èšå…‰ç¯ï¼Œé£å£°å°±æ˜¯ä¼´å¥ã€‚ä½ æ˜¯æˆ‘çš„èˆä¼´ï¼Œä¹Ÿæ˜¯æˆ‘å”¯ä¸€çš„è§‚ä¼—ã€‚â€" },
                { text: "è®¨è®ºå…³äºæ­»äº¡å’Œæ°¸æ’çš„è¯é¢˜ã€‚", diff: { mood: 10 }, reply: "â€œå¦‚æœæœ‰ä¸€å¤©æˆ‘æ­»äº†...æˆ‘ä¼šè®©ä½ æŠŠæˆ‘åšæˆé­‚å™¨ã€‚è¿™æ ·æˆ‘å°±èƒ½æ°¸è¿œé™ªç€ä½ ï¼Œä½ ä¹Ÿæ°¸è¿œç”©ä¸æ‰æˆ‘ã€‚â€" },
                { text: "ä»–åœ¨æ æ†è¾¹ç¼˜åšå±é™©åŠ¨ä½œå“å”¬ä½ ã€‚", diff: { mood: -10, love: 10 }, reply: "â€œæ‹…å¿ƒæˆ‘ï¼Ÿæ”¾å¿ƒï¼Œæˆ‘èˆä¸å¾—æ­»ã€‚æˆ‘è¿˜æ²¡å¨¶åˆ°ä½ å‘¢ã€‚â€" },
                { text: "å–äº†ä¸€å£å·å¸¦ä¸Šæ¥çš„çƒˆç«å¨å£«å¿Œã€‚", diff: { health: -5, mood: 15 }, reply: "â€œæ•¬æ˜Ÿç©ºï¼Œæ•¬è‡ªç”±ï¼Œæ•¬è¯¥æ­»çš„çº¯è¡€ç»Ÿè®ºï¼Œæ•¬æˆ‘ä»¬ã€‚â€" },
                { text: "åœ¨è¿™é‡Œè¿æ¥æ—¥å‡ºã€‚", diff: { mood: 30, love: 20 }, reply: "â€œå¤©äº®äº†ã€‚æ–°çš„ä¸€å¤©ï¼Œæˆ‘è¿˜çˆ±ç€ä½ ã€‚è€Œä¸”æ¯”æ˜¨å¤©æ›´çˆ±ä¸€ç‚¹ã€‚â€" }
            ]
        }
    };

    // --- æ–°å¢ï¼šæ‰“å¼€åœ°ç‚¹é€‰æ‹©èœå• ---
    function openLocationMenu() {
        if(noah.isAway) { speak("è¯ºäºšæ­£åœ¨å¤–é¢æ¢é™©ï¼Œè€å¿ƒç‚¹ï¼Œå¥³æœ‹å‹ã€‚"); return; }
        if(noah.health < 20 || noah.hunger < 20) { 
            speak("â€œæˆ‘å¤ªç´¯äº†ï¼Œæˆ–è€…å¤ªé¥¿äº†...å…ˆç…§é¡¾å¥½æˆ‘ï¼Œå†å¸¦ä½ å»å¾æœä¸–ç•Œã€‚â€ (çŠ¶æ€è¿‡ä½ï¼Œæ— æ³•å¤–å‡º)"); 
            return; 
        }

        const list = document.getElementById('modal-list');
        list.innerHTML = '';
        document.getElementById('modal-title').innerText = "ğŸŒ é€‰æ‹©ç›®çš„åœ°";
        
        for (let key in locations) {
            let loc = locations[key];
            let li = document.createElement('li');
            // æ˜¾ç¤ºæ¶ˆè€—æç¤º
            let costText = [];
            if(loc.cost.gold > 0) costText.push(`-${loc.cost.gold}G`);
            if(loc.cost.hunger > 0) costText.push(`é¥±é£Ÿ-${loc.cost.hunger}`);
            
            li.innerHTML = `<span>${loc.icon} ${loc.name}</span> <span style="font-size:9px;opacity:0.7">${costText.join(' ')}</span>`;
            li.onclick = () => { confirmAdventure(key); };
            list.appendChild(li);
        }
        document.getElementById('sys-modal').style.display = 'block';
    }

    function confirmAdventure(locKey) {
        let loc = locations[locKey];
        
        // æ£€æŸ¥é‡‘å¸æ˜¯å¦è¶³å¤Ÿ
        if(noah.gold < loc.cost.gold) {
            speak(`â€œå»${loc.name}å¯æ˜¯è¦èŠ±é’±çš„ã€‚çœ‹çœ‹ä½ çš„é’±åŒ…ï¼Œåªæœ‰${noah.gold}Gã€‚æˆ‘ä»¬è¿˜æ˜¯å»é»‘æ¹–æ¡ç ´çƒ‚å§ã€‚â€`);
            closeModal();
            return;
        }

        closeModal();
        
        // æ‰£é™¤æ¶ˆè€—
        noah.gold -= loc.cost.gold;
        noah.hunger -= loc.cost.hunger;
        if(loc.cost.health) noah.health -= loc.cost.health;
        // éœæ ¼è«å¾·ç‰¹æ®Šå›å¤
        if(locKey === 'hogsmeade') noah.hunger += 30;

        // å¼€å§‹æ¢é™©åŠ¨ç”»
        noah.isAway = true;
        document.getElementById('adventure-overlay').style.display = 'flex';
        document.getElementById('noah-canvas').style.display = 'none'; 
        // --- æ–°å¢ï¼šç”¨åœºæ™¯åƒç´ ç”»ä»£æ›¿åŸæœ¬çš„ Emoji ---
        document.getElementById('adv-icon').style.display = 'none'; 
        const advCanvas = document.getElementById('adv-canvas');
        advCanvas.style.display = 'block';
        const advCtx = advCanvas.getContext('2d');
        advCtx.clearRect(0, 0, 10, 10);
        
        // åˆ¤æ–­å»å“ªé‡Œï¼Œç”»å‡ºå“ªé‡Œçš„å›¾çº¸
        let sceneKey = 'lake';
        if (locKey === 'london' || locKey === 'astronomy') sceneKey = 'london';
        else if (locKey === 'library') sceneKey = 'library';
        else if (locKey === 'hogsmeade' || locKey === 'room') sceneKey = 'room';
        
        let sceneMap = sprites[sceneKey];
        if (sceneMap) {
            for (let y = 0; y < sceneMap.length; y++) {
                let rowColors = sceneMap[y].trim().split(/\s+/);
                for (let x = 0; x < rowColors.length; x++) {
                    let color = palette[rowColors[x]];
                    if (color) { advCtx.fillStyle = color; advCtx.fillRect(x, y, 1, 1); }
                }
            }
        }
        document.getElementById('adv-text').innerText = "EXPLORING " + loc.name.split(' ')[0];
        
        speak(`â€œå»${loc.name}ï¼Ÿå¥½ä¸»æ„ã€‚è·Ÿç´§æˆ‘ï¼Œåˆ«èµ°ä¸¢äº†ã€‚â€ (é¢„è®¡è€—æ—¶8ç§’)`);

        setTimeout(() => {
            noah.isAway = false;
            document.getElementById('adventure-overlay').style.display = 'none';
            document.getElementById('noah-canvas').style.display = 'block'; 
            
            // éšæœºæŠ½å–è¯¥åœ°ç‚¹çš„äº‹ä»¶
            const eventPool = loc.events;
            const event = eventPool[Math.floor(Math.random() * eventPool.length)];
            
            // åº”ç”¨æ•°å€¼å˜åŒ–
            if(event.diff.gold) noah.gold += event.diff.gold;
            if(event.diff.love) noah.love += event.diff.love;
            if(event.diff.mood) noah.mood += event.diff.mood;
            if(event.diff.health) noah.health += event.diff.health;
            if(event.diff.hunger) noah.hunger += event.diff.hunger;

            speak(event.reply);
            updateUI();
            showEventModal(event.text, event.diff);
            
        }, 8000);
    }

    function showEventModal(text, diff) {
        let diffText = "";
        if(diff.gold > 0) diffText += `<span style="color:#d1b55a">+${diff.gold}G </span>`;
        if(diff.gold < 0) diffText += `<span style="color:#d15a5a">${diff.gold}G </span>`;
        if(diff.love > 0) diffText += `<span style="color:#ff99cc">åçˆ±+${diff.love} </span>`;
        if(diff.health < 0) diffText += `<span style="color:#d15a5a">å¥åº·${diff.health} </span>`;
        if(diff.mood > 0) diffText += `<span style="color:#5cd1ff">å¿ƒæƒ…+${diff.mood} </span>`;

        document.getElementById('event-text').innerHTML = `${text}<br><br><div style="font-size:10px; margin-top:5px;">${diffText}</div>`;
        document.getElementById('event-options').innerHTML = `<button class="event-btn" onclick="document.getElementById('event-modal').style.display='none'">ç¡®å®š</button>`;
        document.getElementById('event-modal').style.display = 'flex';
    }

    // --- åŸæœ‰èœå•é€»è¾‘ ---
    const menus = {
        feed: [
            { name: "åå…¨å¤§è¡¥çˆ±å¿ƒé­”è¯ (G100)", action: () => buyItem(100, 'health', 80, 'love', 20, "è¿™ä»€ä¹ˆä¸œè¥¿ï¼Ÿä¸ºäº†ä½ æˆ‘å–...å’³ï¼Œæ„Ÿè§‰å¥½å¤šäº†ï¼Œä½ æ˜¯ä¸æ˜¯åœ¨é‡Œé¢åŠ äº†ç¦çµå‰‚ï¼Ÿ") },
            { name: "é€’ç»™ä»–èŒ‰è‰èŠ±èŒ¶ (G10)", action: () => buyItem(10, 'mood', 15, 'love', 10, "é¦™å‘³å¾ˆç†Ÿæ‚‰ã€‚ä¸è¿‡ä½ éš¾é“ä¸çŸ¥é“ï¼Œæˆ‘å–œæ¬¢èŒ‰è‰ä»…ä»…æ˜¯å› ä¸ºå¥½é—»ï¼Œä½†æˆ‘å–œæ¬¢ä½ ï¼Œæ˜¯å› ä¸ºé‚£æ˜¯ä½ ã€‚") },
            { name: "é€’ä¸€ç½ç¢³é…¸é¥®æ–™ (G15)", action: () => buyItem(15, 'mood', 20, 'hunger', 10, "å‘²â€”â€”ï¼ˆæ‹‰å¼€æ˜“æ‹‰ç½ï¼‰ã€‚æ°”æ³¡ç‚¸è£‚çš„å£°éŸ³ã€‚æ´»åœ¨å½“ä¸‹çš„æ„Ÿè§‰çœŸå¥½ï¼Œå°¤å…¶æ˜¯ä½ åœ¨æˆ‘æ—è¾¹ã€‚") },
            { name: "é€æ¯’è˜‘è‡ç‰›å¥¶ (G5)", action: () => buyItem(5, 'health', -10, 'love', 30, "ä½ åˆæ¥ï¼Ÿè¡Œï¼Œé»‘å†å²è¿‡ä¸å»äº†æ˜¯å§ã€‚åªè¦æ˜¯ä½ ç»™çš„ï¼Œå°±ç®—å«æˆ‘çˆ¶äº²æˆ‘ä¹Ÿå–ã€‚(ä¸€é¥®è€Œå°½)") },
            { name: "ä¸‰æŠŠæ‰«å¸šçƒ­é»„æ²¹å•¤é…’ (G25)", action: () => buyItem(25, 'hunger', 30, 'mood', 20, "å¹²æ¯ï¼Œåˆ«å–é†‰äº†ï¼Œä¸ç„¶æˆ‘æ€•æˆ‘æ§åˆ¶ä¸ä½æƒ³å¯¹ä½ åšç‚¹ä»€ä¹ˆã€‚") },
            { name: "èœ‚èœœå…¬çˆµç³–ç¾½æ¯›ç¬” (G20)", action: () => buyItem(20, 'hunger', 15, 'mood', 15, "ä¸€è¾¹æ€è€ƒç¼¸ä¸­ä¹‹è„‘ï¼Œä¸€è¾¹åƒç³–...æˆ‘ä¹Ÿåªæœ‰åœ¨ä½ é¢å‰æ‰ä¼šè¿™ä¹ˆçŸ›ç›¾äº†ã€‚ç¬¨è›‹ã€‚") }
        ],
        interact: [
            { name: "âœ‰ï¸ å†™æ‚„æ‚„è¯ç»™ä»–", action: () => openSecretChat() },
            { name: "é€’ç»™ä»–ç»¿è‰²å°è›‡ç©å¶", action: () => chat("å°ç»¿è›‡") },
            { name: "è¯´â€œæˆ‘æ¨ä½ Xä¸‡éâ€", action: () => chat("äº’æ€¼") },
            { name: "æ‰¯ä»–è„–å­ä¸Šçš„è“å®çŸ³é¡¹é“¾", action: () => chat("é¡¹é“¾") },
            { name: "è®©ä»–æŠŠå›´å·¾ç³»åœ¨å¤´ä¸Š", action: () => chat("å›´å·¾") },
            { name: "èŠèŠè–›å®šè°”çš„çŒ«", action: () => chat("å“²å­¦") },
            { name: "æ•…æ„æè¥¿å¥¥å¤šÂ·è¯ºç‰¹", action: () => chat("è¥¿å¥¥å¤š") },
            { name: "æ•…æ„æå¸ƒé›·æ–¯Â·æ‰æ¯”å°¼", action: () => chat("å¸ƒé›·æ–¯") },
            { name: "å¤¸ä»–â€œå¸…æäº†â€", action: () => chat("è‡ªæ‹") },
            { name: "é‚€è¯·ä»–åœ¨é›¨ä¸­æ¼«æ­¥", action: () => chat("é›¨ä¸­") }
        ],
              shop: [
            { name: "å¤¹å¿ƒé¢åŒ…ç°è‰²ç¾½ç»’æœ (G150)", action: () => buyItem(150, 'love', 50, 'mood', 30, "ä½ å«Œå®ƒä¸‘ï¼Ÿå¯å®ƒæš–å’Œå•Šï¼Œè€Œä¸”è¿™ä»¶è¡£æœçš„å¤§å°ï¼Œåˆšå¥½è¶³å¤ŸæŠŠä½ æ•´ä¸ªäººåŒ…è¿›æˆ‘æ€€é‡Œã€‚") },
            { name: "ã€Šè«é‡Œæ–¯çš„æƒ…äººã€‹å½±ç¥¨ (G80)", action: () => buyItem(80, 'mood', 40, 'love', 40, "åœ¨ä¸‹é›¨çš„æ™šä¸Šçœ‹è¿™éƒ¨ç”µå½±æœ€åˆé€‚äº†ã€‚æˆ‘ä¾ç„¶æƒ³ä¸é€šå…‹è±å¤«æ€ä¹ˆä¼šèˆå¾—ç»“å©šï¼Œæ¢ä½œæ˜¯æˆ‘ï¼Œæ­»éƒ½ä¸æ”¾æ‰‹ã€‚") },
            { name: "å»ä½“éªŒâ€œæ— é™â€çš„é—¨ç¥¨ (G200)", action: () => buyItem(200, 'love', 80, 'mood', 60, "å‘¨äº”çš„çº¦å®šã€‚å“ªæ€•å®‡å®™çˆ†ç‚¸ï¼Œè¿™å‘¨äº”æˆ‘ä¹Ÿä¼šå‡†æ—¶å¸¦ä½ å»ä½“éªŒçœŸæ­£çš„è‡ªç”±ã€‚") },
            { name: "å®šåˆ¶æƒ…ä¾£æ‹‰æ–‡å…‹åŠ³å›´å·¾ (G120)", action: () => buyItem(120, 'love', 60, 'mood', 50, "æˆ´ä¸Šå®ƒï¼Œè¿™æ ·å…¨éœæ ¼æ²ƒå…¹å°±éƒ½çŸ¥é“ï¼Œä½ æ˜¯è¢«æˆ‘è¯ºäºšÂ·å¸å¾·é‡Œå®‰åœˆå…»çš„äº†ã€‚") },
            { name: "èŒ‰è‰é¦™æ°›èœ¡çƒ› (G30)", action: () => buyItem(30, 'mood', 20, 'love', 10, "ç‚¹ç‡ƒå®ƒï¼Œå°±åƒä½ éšæ—¶åœ¨æˆ‘èº«è¾¹ã€‚ä¸è¿‡ä½ æœ¬äººæ¯”è¿™å‘³é“å¥½é—»ä¸€ä¸‡å€ã€‚") },
            { name: "è«æ‰ç‰¹é»‘èƒ¶å”±ç‰‡ (G60)", action: () => buyItem(60, 'mood', 35, 'love', 20, "å¤å…¸ä¹ï¼Ÿçœ¼å…‰ä¸é”™ã€‚ä»Šæ™šæ¥æˆ‘æˆ¿é—´ï¼Œæˆ‘ä»¬ä¸€èµ·å¬ã€‚ä¸è®¸æ‹’ç»ã€‚") },
            { name: "å†°åŸç‹¼æœ¨é›• (G50)", action: () => buyItem(50, 'love', 30, 'mood', 20, "æˆ‘çš„å®ˆæŠ¤ç¥ã€‚åªè¦ä½ çœ‹ç€å®ƒï¼Œå°±åƒæˆ‘ä¸€ç›´åœ¨ä¿æŠ¤ä½ ä¸€æ ·ã€‚") },
            { name: "è“å®çŸ³æƒ…ä¾£å¯¹æˆ’ (G520)", action: () => buyItem(520, 'love', 200, 'mood', 100, "ä¹°è¿™ä¸ªï¼Ÿä½ å¯æƒ³å¥½äº†ï¼Œæˆ´ä¸Šå°±åˆ«æƒ³æ‘˜ä¸‹æ¥ã€‚è¿™è¾ˆå­ä½ éƒ½æ˜¯æˆ‘çš„ã€‚") },
            { name: "ä¼¦æ•¦çœ¼åŒäººå¤œåœºç¥¨ (G180)", action: () => buyItem(180, 'love', 70, 'mood', 50, "åœ¨æœ€é«˜å¤„æ¥å»çš„äººä¼šæ°¸è¿œåœ¨ä¸€èµ·ï¼Ÿè¿™ç§éº»ç“œä¼ è¯´æˆ‘ä¹Ÿä¿¡ï¼Œèµ°å§ã€‚") },
            { name: "é™é‡ç‰ˆç¢³é…¸é¥®æ–™ç›²ç›’ (G40)", action: () => buyItem(40, 'hunger', 20, 'mood', 25, "å‘²â€”â€”ç¬¬ä¸€å£ç»™ä½ ã€‚è¿™æ¯”ä»»ä½•ç¦çµå‰‚éƒ½è®©æˆ‘ä¸Šç˜¾ã€‚") },
            { name: "æœ€æ–°æ¬¾åŒäººæŒæœº (G250)", action: () => buyItem(250, 'mood', 80, 'love', 50, "æ•¢è·Ÿæˆ‘æ¯”ï¼Ÿè¾“äº†çš„äººä»Šæ™šè¦ç­”åº”å¯¹æ–¹ä¸€ä¸ªè¦æ±‚ã€‚æˆ‘èµ¢å®šäº†ã€‚") },
            { name: "é»„é“œå¤©æ–‡æœ›è¿œé•œ (G150)", action: () => buyItem(150, 'mood', 60, 'love', 40, "ç”¨å®ƒçœ‹æ˜Ÿæ˜Ÿï¼Œç”¨çœ¼ç›çœ‹ä½ ã€‚å®‡å®™å†å¤§ï¼Œä¹Ÿæ²¡æœ‰ä½ å¯¹æˆ‘çš„å¼•åŠ›å¤§ã€‚") },
            { name: "ã€Šåå¤§å“²å­¦æ‚–è®ºã€‹ (G70)", action: () => buyItem(70, 'mood', 40, 'love', 30, "ç¼¸ä¸­ä¹‹è„‘ï¼ŸåŒç¼å¹²æ¶‰ï¼Ÿè¿™äº›éƒ½ä¸å¦‚â€˜æˆ‘æ€ä¹ˆè¿™ä¹ˆçˆ±ä½ â€™è¿™ä¸ªæ‚–è®ºéš¾è§£ã€‚") },
            { name: "ç»¿è‰²å°è›‡åˆºç»£æŠ±æ• (G45)", action: () => buyItem(45, 'love', 30, 'mood', 15, "å’³...è¿™ä¸ªæ‰‹æ„Ÿç¡®å®ä¸é”™ã€‚ä½†æˆ‘æ™šä¸Šè¿˜æ˜¯æ›´æƒ³æŠ±ä½ æœ¬äººã€‚") },
            { name: "æ³°æ™¤å£«æ²³å¤œæ¸¸èˆ¹ç¥¨ (G100)", action: () => buyItem(100, 'mood', 50, 'love', 40, "å†·å—ï¼Ÿé è¿‘ç‚¹ã€‚å¤œé£å†å†·ï¼Œæœ‰æˆ‘åœ¨ä½ èº«è¾¹å°±ä¸ä¼šè®©ä½ å†»ç€ã€‚") },
            { name: "éº»ç“œé’æ˜¥ç”µå½±å…¨é›† (G80)", action: () => buyItem(80, 'mood', 30, 'love', 50, "è¿™ä¹ˆçƒ‚ä¿—çš„å‰§æƒ…ï¼ŸFineï¼Œåªè¦æ˜¯ä½ é€‰çš„ï¼Œå°±ç®—çœ‹ä¸€ä¸‡éæˆ‘ä¹Ÿä¹æ„ã€‚") },
            { name: "é›¨ä¸­æ¼«æ­¥é€æ˜ä¼ (G35)", action: () => buyItem(35, 'love', 25, 'mood', 15, "å…¶å®ä¸ç”¨ä¼ã€‚è¢«æ·‹æ¹¿äº†ï¼Œæˆ‘å°±æœ‰ç†ç”±æŠŠä½ æ•´ä¸ªäººè£¹è¿›æˆ‘çš„ç¾½ç»’æœé‡Œäº†ã€‚") },
            { name: "é˜²è¥¿å¥¥å¤šé è¿‘ç¬¦å’’ (G100)", action: () => buyItem(100, 'mood', 60, 'love', 40, "è¿™ä¸œè¥¿å¤ªæœ‰ç”¨äº†ï¼å†è®©æˆ‘çœ‹åˆ°é‚£ä¸ªç–¯å­é è¿‘ä½ ï¼Œæˆ‘å°±è®©ä»–ç°é£çƒŸç­ï¼") },
            { name: "ä¸“å±äº²äº²å…‘æ¢å¡ç‰‡ (G99)", action: () => buyItem(99, 'love', 80, 'mood', 50, "ä½ ä¹°è¿™ä¸ªï¼Ÿ(è€³æœµæ³›çº¢) éšæ—¶å…‘ç°ï¼Œè¿‡æœŸä¸å€™ã€‚ç°åœ¨å°±è¦ç”¨å—ï¼Ÿ") },
            { name: "é»‘é­”æ³•å¤ç±å­¤æœ¬ (G300)", action: () => buyItem(300, 'mood', 100, 'love', 80, "è¿™ä¹¦å¾ˆéš¾æ‰¾ã€‚é‡Œé¢æœ‰ä¸ªå’’è¯­...èƒ½è®©ä½ æ°¸è¿œç¦»ä¸å¼€æˆ‘ã€‚å¼€ç©ç¬‘çš„ï¼Œæˆ‘ä¸ç”¨å’’è¯­ä¹Ÿèƒ½åšåˆ°ã€‚") },
            { name: "æ–¯è±ç‰¹æ—é…è‰²æ‰‹é“¾ (G60)", action: () => buyItem(60, 'love', 40, 'mood', 20, "è™½ç„¶æˆ‘æ˜¯æ‹‰æ–‡å…‹åŠ³ï¼Œä½†åªè¦æ˜¯ä½ è¿™åªæ–¯è±ç‰¹æ—å°è›‡ï¼Œæˆ‘ç”˜æ„¿è¢«ä½ ç¼ ç»•ã€‚") },
            { name: "æµ·æ»¨å‡æ—¥ç‰¹å¿«è½¦ç¥¨ (G220)", action: () => buyItem(220, 'love', 90, 'mood', 70, "æµ·è¾¹æ”¾è‚†è¿½é€ï¼Ÿå¥½å•Šï¼Œå¦‚æœæˆ‘æŠ“åˆ°ä½ ï¼Œä½ å°±ä»»æˆ‘å¤„ç½®ã€‚è·‘å¿«ç‚¹ã€‚") },
            { name: "å¸ƒé›·æ–¯ä¸“å±æ¶ä½œå‰§ç›’ (G50)", action: () => buyItem(50, 'mood', 50, 'love', 20, "å¹²å¾—æ¼‚äº®ã€‚é‚£ä¸ªä¼ªå›å­æ‰“å¼€çš„æ—¶å€™ï¼Œæˆ‘ä¸€å®šè¦ç”¨ç•™å½±æœºæ‹ä¸‹æ¥ï¼") },
            { name: "ã€Šåº„å­ä¸è€å­ã€‹è¯‘æœ¬ (G65)", action: () => buyItem(65, 'mood', 35, 'love', 25, "ä¸ºæ— ä¸ºï¼Œäº‹æ— äº‹ã€‚ä½†æˆ‘å¯¹ä½ ï¼Œåªæƒ³â€˜ä½†è¡Œå¥½äº‹ï¼Œè«é—®å‰ç¨‹â€™ã€‚") },
            { name: "èŒ‰è‰é¦™ç¡çœ çœ¼ç½© (G30)", action: () => buyItem(30, 'mood', 20, 'health', 15, "åªè¦é—­ä¸Šçœ¼ï¼Œé—»åˆ°è¿™å‘³é“ï¼Œæˆ‘çš„æ¢¦é‡Œå…¨éƒ½æ˜¯ä½ ã€‚") },
            { name: "æ— é™ç¬¦å·âˆé¡¹é“¾å  (G131)", action: () => buyItem(131, 'love', 99, 'mood', 50, "æŠŠå®ƒæŒ‚åœ¨æˆ‘çš„è“å®çŸ³é¡¹é“¾æ—è¾¹ã€‚è¿™ä»£è¡¨æˆ‘å¯¹ä½ çš„çˆ±ï¼Œæ— å§‹æ— ç»ˆï¼Œæ— é™å¾ªç¯ã€‚") },
            { name: "çŒ«å’ªé«˜çº§é›¶é£Ÿç½å¤´ (G20)", action: () => buyItem(20, 'mood', 15, 'love', 10, "ç»™å®¶é‡Œçš„çŒ«ï¼Ÿè¡Œå§ã€‚ä¸è¿‡ä½ å¾—å…ˆå–‚æˆ‘ï¼Œæˆ‘æ¯”çŒ«æ›´éœ€è¦ä½ ã€‚") },
            { name: "åŒç¼å¹²æ¶‰å¾®ç¼©æ¨¡å‹ (G90)", action: () => buyItem(90, 'mood', 45, 'love', 35, "å½“ä½ ä¸è§‚æµ‹æ—¶ï¼Œå…‰æ˜¯æ³¢ï¼›å½“æˆ‘çœ‹ç€ä½ æ—¶ï¼Œä½ å°±æ˜¯æˆ‘çš„å…¨ä¸–ç•Œã€‚") },
            { name: "è–›å®šè°”çš„çŒ«ç›²ç›’ (G55)", action: () => buyItem(55, 'mood', 30, 'love', 25, "åœ¨æ‰“å¼€å‰ï¼ŒçŒ«æ˜¯æ­»æ˜¯æ´»éƒ½æœ‰å¯èƒ½ã€‚ä½†æ— è®ºæ‰“å¼€ä»€ä¹ˆï¼Œæˆ‘éƒ½ç¡®ä¿¡æˆ‘çˆ±ä½ ã€‚") },
            { name: "å¸å¾·é‡Œå®‰æƒ…ä¹¦ä¿¡çº¸ (G40)", action: () => buyItem(40, 'love', 35, 'mood', 20, "æƒ³è®©æˆ‘ç»™ä½ å†™æƒ…ä¹¦ï¼Ÿæ²¡é—®é¢˜ï¼Œç½²åæ°¸è¿œæ˜¯â€˜ä½ å…¨ä¸–ç•Œæœ€å¸…æ°”æœ€æ— æ‰€ä¸èƒ½çš„BFâ€™ã€‚") },
            { name: "å…”å­è€³æœµæ¯›ç»’å‘ç® (G25)", action: () => buyItem(25, 'mood', -10, 'love', 40, "æƒ³è®©æˆ‘æˆ´è¿™ä¸ªå‘Šè¯‰ä½ ä¸ºä»€ä¹ˆå…”å­æœ‰ä¸¤åªè€³æœµï¼Ÿæƒ³éƒ½åˆ«æƒ³ï¼...å¥½å§ï¼Œåªæˆ´äº”åˆ†é’Ÿã€‚") },
            { name: "ä¼¦æ•¦è¡—è¾¹å°åƒé›†é”¦ (G75)", action: () => buyItem(75, 'hunger', 40, 'mood', 30, "ä¸ç”¨å»ä¼¦æ•¦ä¹Ÿèƒ½åƒåˆ°ï¼Ÿå¼ å˜´ï¼Œå•Šâ€”â€”çœ‹ä½ åƒä¸œè¥¿ä¹Ÿæ˜¯ä¸€ç§äº«å—ã€‚") },
            { name: "å¡ç¿å¤±é©¬è¿ç¯ç”»å†Œ (G20)", action: () => buyItem(20, 'mood', 15, 'love', 15, "å¡ç¿å¤±é©¬ï¼Œç„‰çŸ¥éç¦ã€‚é‡åˆ°ä½ ï¼Œå°±æ˜¯æˆ‘è¿™è¾ˆå­æœ€å¤§çš„ç¦æ°”ã€‚") }
        ]
    };

    function openMenu(type) {
        if(noah.isAway) { speak("è¯ºäºšæ­£åœ¨å¤–é¢æ¢é™©ï¼Œä½ çš„æ€å¿µåªèƒ½ç•™ç»™ç©ºæ°”äº†ã€‚"); return; }
        const list = document.getElementById('modal-list');
        list.innerHTML = '';
        const titles = {feed: 'ğŸ½ï¸ åçˆ±æŠ•å–‚', interact: 'âœ¨ ä¸“å±äº’åŠ¨', shop: 'ğŸ é€‰è´­ç¤¼ç‰©'};
        document.getElementById('modal-title').innerText = titles[type];
        
        menus[type].forEach(item => {
            let li = document.createElement('li');
            li.innerText = item.name;
            li.onclick = () => { item.action(); closeModal(); };
            list.appendChild(li);
        });
        document.getElementById('sys-modal').style.display = 'block';
    }

    function closeModal() { document.getElementById('sys-modal').style.display = 'none'; }
            function openSecretChat() {
        if(noah.isAway) { speak("è¯ºäºšä¸åœ¨å®¶ï¼Œä½ çš„ä¿¡è¢«é£å¹èµ°äº†ã€‚"); return; }
        closeModal();
        
        setTimeout(() => {
            let msg = prompt("ä½ æƒ³å¯¹è¯ºäºšè¾“å…¥ä»€ä¹ˆæ‚„æ‚„è¯ï¼Ÿ(è¾“å…¥ï¼šçˆ±ä½ ã€æƒ³ä½ ã€æƒ³æŠ±æŠ±ã€èŒ‰è‰ã€å®‡å®™ã€è¥¿å¥¥å¤šã€ä¸‹é›¨ã€æ™šå®‰...)");
            if(!msg) return;
            msg = msg.trim();
            if(msg.length === 0) return;
            
            noah.hunger -= 2; 
            let reply = "";
            let loveUp = 0; let moodUp = 0;
            
            const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];

            // ================= è‡³å°‘25ä¸ªå…³é”®è¯åˆ¤å®šé€»è¾‘ =================
            
            // 1. è¡¨ç™½ç±»ï¼šçˆ±ä½ /å–œæ¬¢
            if(msg.includes("çˆ±ä½ ") || msg.includes("å–œæ¬¢ä½ ") || msg.includes("love")) {
                reply = pick([
                    "â€œæˆ‘ä¹Ÿçˆ±ä½ ã€‚æ¯”è¿™å®‡å®™é‡Œçš„æ‰€æœ‰æ˜Ÿæ˜ŸåŠ èµ·æ¥è¿˜è¦çˆ±ä½ ã€‚â€ (çœ¼ç¥æ¸©æŸ”å¾—å¿«è¦åŒ–æ‰)",
                    "â€œè¿™å°±å¯¹äº†ã€‚ä½œä¸ºå¥–åŠ±ï¼Œä»Šæ™šå…è®¸ä½ ä¸€ç›´ç›¯ç€æˆ‘çœ‹ã€‚â€ (å˜´è§’ç–¯ç‹‚ä¸Šæ‰¬)",
                    "â€œI love you three thousand. æ¯å¤©è¯´ä¸€éï¼Œå°‘ä¸€ééƒ½ä¸è¡Œï¼Œå¿…é¡»è¯´ç»™æˆ‘å¬ã€‚â€"
                ]);
                loveUp = 20; moodUp = 20; makeShy();
            } 
            // 2. æƒ³å¿µç±»ï¼šæƒ³ä½ /miss
            else if(msg.includes("æƒ³ä½ ") || msg.includes("miss")) {
                reply = pick([
                    "â€œæˆ‘ä¹Ÿåœ¨æƒ³ä½ ã€‚æ¯ä¸€åˆ†ï¼Œæ¯ä¸€ç§’ï¼Œç”šè‡³åœ¨å‘¼å¸çš„é—´éš™ã€‚â€",
                    "â€œæƒ³æˆ‘äº†ï¼Ÿé‚£å°±åˆ«åªåœ¨å¿ƒé‡Œæƒ³ï¼Œç°åœ¨ç«‹åˆ»é©¬ä¸Šï¼Œåˆ°æˆ‘æ€€é‡Œæ¥ã€‚â€",
                    "â€œçœŸå·§ï¼Œæˆ‘çš„è„‘å­é‡Œåˆšæ‰ä¹Ÿå…¨æ˜¯ä½ ã€‚è¿™å°±æ˜¯æ‰€è°“çš„å¿ƒçµæ„Ÿåº”ï¼Ÿâ€"
                ]);
                loveUp = 15; moodUp = 15;
            }
            // 3. åˆ†æ‰‹/ç¦»å¼€
            else if(msg.includes("åˆ†æ‰‹") || msg.includes("ç¦»å¼€") || msg.includes("ä¸çˆ±")) {
                reply = pick([
                    "â€œä½ æƒ³éƒ½åˆ«æƒ³ï¼(çŒ›åœ°æŠ“ä½ä½ çš„æ‰‹è…•) æ‹›æƒ¹äº†æˆ‘ï¼Œå°±ç®—æ­»ä½ ä¹Ÿåªèƒ½æ­»åœ¨æˆ‘èº«è¾¹ï¼â€",
                    "â€œåˆ†æ‰‹ï¼Ÿé™¤éæˆ‘æ­»ï¼Œæˆ–è€…ä¸–ç•Œæ¯ç­ã€‚æŠŠè¿™å¥è¯æ”¶å›å»ï¼Œç«‹åˆ»ã€‚â€ (çœ¼ç¥å†°å†·å¯æ€•)",
                    "â€œå‘µï¼Œä½ å¯ä»¥è¯•è¯•çœ‹èµ°å¾—æ‰å—ï¼Ÿä¸ç®¡æ˜¯å¤©æ¶¯æµ·è§’ï¼Œæˆ‘éƒ½ä¼šæŠŠä½ æŠ“å›æ¥é”åœ¨èº«è¾¹ã€‚â€"
                ]);
                loveUp = -10; moodUp = -50; 
            } 
            // 4. äº²å¯†äº’åŠ¨ï¼šæŠ±æŠ±
            else if(msg.includes("æŠ±æŠ±") || msg.includes("æŠ±æˆ‘")) {
                reply = pick([
                    "â€œ(ä¸€æŠŠå°†ä½ æ‹‰è¿›æ€€é‡Œ) æ—©å°±ç­‰ä½ è¿™å¥è¯äº†ã€‚ä»Šå¤©å°±è®©ä½ å¾…åœ¨æˆ‘æ€€é‡Œï¼Œå“ªä¹Ÿä¸è®¸å»ã€‚â€",
                    "â€œåªè¦æŠ±æŠ±ï¼Ÿè´ªå¿ƒç‚¹ï¼Œæˆ‘çš„å¥³æœ‹å‹ã€‚æˆ‘æ•´ä¸ªäººéƒ½æ˜¯ä½ çš„ã€‚â€",
                    "â€œè¿‡æ¥ã€‚è¦æ˜¯ä½ å†·äº†ï¼Œæˆ‘çš„ç°è‰²ç¾½ç»’æœéšæ—¶ä¸ºä½ æ•å¼€ã€‚â€"
                ]);
                loveUp = 15; moodUp = 15; makeShy();
            } 
            // 5. äº²å¯†äº’åŠ¨ï¼šäº²äº²/å»
            else if(msg.includes("äº²äº²") || msg.includes("å»")) {
                reply = pick([
                    "â€œé—­ä¸Šçœ¼ã€‚(è½»è½»å»åœ¨ä½ çš„å”‡ä¸Š) åªæœ‰ä½ èƒ½è®©æˆ‘è¿™ä¹ˆå¤±æ§ã€‚â€",
                    "â€œä»Šå¤©ä¸æŠŠä½ äº²å¾—å–˜ä¸è¿‡æ°”ï¼Œæˆ‘å°±ä¸å«è¯ºäºšã€‚â€",
                    "â€œä½ ä¸»åŠ¨æçš„ï¼Ÿé‚£æˆ‘ä¸å®¢æ°”äº†ã€‚ç­‰ä¼šåˆ«å–Šåœã€‚â€"
                ]);
                loveUp = 15; moodUp = 15; makeShy();
            } 
            // 6. è´Ÿé¢æƒ…ç»ªï¼šç´¯/éš¾è¿‡/å“­
            else if(msg.includes("ç´¯") || msg.includes("éš¾è¿‡") || msg.includes("ä¼¤å¿ƒ") || msg.includes("å§”å±ˆ") || msg.includes("å“­")) {
                reply = pick([
                    "â€œæ€ä¹ˆäº†ï¼Ÿè°æ¬ºè´Ÿä½ äº†ï¼Ÿå‘Šè¯‰æˆ‘åå­—ï¼Œæˆ‘å»è®©ä»–ä½“ä¼šä¸€ä¸‹ä»€ä¹ˆæ˜¯çœŸæ­£çš„åœ°ç‹±ã€‚åˆ«æ€•ï¼Œæˆ‘åœ¨ã€‚â€",
                    "â€œç´¯äº†å°±é åœ¨æˆ‘è‚©è†€ä¸Šç¡ä¸€ä¼šã€‚å¤©å¡Œä¸‹æ¥æœ‰æˆ‘é¡¶ç€ï¼Œä½ åªéœ€è¦è´Ÿè´£å¼€å¿ƒå°±å¥½ã€‚â€",
                    "â€œä¹–ï¼Œä¸å“­ã€‚ä¸ç®¡å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½ è¿˜æœ‰æˆ‘ã€‚æˆ‘æ˜¯ä½ æœ€åšå›ºçš„æ–¹èˆŸã€‚â€"
                ]);
                loveUp = 10; moodUp = 10;
            }
            // 7. ç¡è§‰ï¼šæ™šå®‰/å›°
            else if(msg.includes("æ™šå®‰") || msg.includes("ç¡") || msg.includes("å›°")) {
                reply = pick([
                    "â€œæ™šå®‰ã€‚è®°å¾—æ¢¦é‡Œä¹Ÿè¦å’Œæˆ‘çº¦ä¼šã€‚â€",
                    "â€œç¡å§ï¼Œå°æ‡’çŒªã€‚æ˜å¤©æ—©ä¸Šé†’æ¥ï¼Œæˆ‘ä¾ç„¶çˆ±ä½ ã€‚â€",
                    "â€œåˆ«è¸¢è¢«å­ã€‚å¦‚æœä½ å†·äº†ï¼Œå°±å–Šæˆ‘çš„åå­—ï¼Œæˆ‘ä¼šç”¨é­”æ³•é©¬ä¸Šèµ¶åˆ°ã€‚â€"
                ]);
                loveUp = 10; moodUp = 5;
            }
            // 8. åƒé†‹å¯¹è±¡ï¼šè¥¿å¥¥å¤š/è¯ºç‰¹
            else if(msg.includes("è¥¿å¥¥å¤š") || msg.includes("è¯ºç‰¹")) {
                reply = pick([
                    "â€œæ°¸è¿œä¸è¦åœ¨æˆ‘é¢å‰å·¦ä¸€å¥è¥¿å¥¥å¤šå³ä¸€å¥è¥¿å¥¥å¤šï¼æˆ‘çœ¼ç›çäº†æ‰çœ‹ä¸å‡ºé‚£ä¸ªç–¯å­çœ‹ä½ çš„çœ¼ç¥ä¹±ä¸ƒå…«ç³Ÿã€‚â€",
                    "â€œä½ ä¸ºä»€ä¹ˆè¦åœ¨ç»™æˆ‘çš„æ‚„æ‚„è¯é‡Œæé‚£ä¸ªç–¯å­ï¼Ÿï¼ä»Šæ™šçš„æƒ©ç½šåŠ å€ï¼Œä½ åˆ«æƒ³ä¸‹åºŠäº†ã€‚â€",
                    "â€œå†æä»–ä¸€æ¬¡ï¼Œæˆ‘å°±å»ç»™ä»–ä¸‹ä¸ªé—å¿˜å’’ï¼Œè®©ä»–è¿è‡ªå·±å«ä»€ä¹ˆéƒ½å¿˜äº†ã€‚â€"
                ]);
                loveUp = 5; moodUp = -30;
            } 
            // 9. åƒé†‹å¯¹è±¡ï¼šå¸ƒé›·æ–¯/æ‰æ¯”å°¼
            else if(msg.includes("å¸ƒé›·æ–¯") || msg.includes("æ‰æ¯”å°¼")) {
                reply = pick([
                    "â€œé‚£ä¸ªä¼ªå›å­ï¼Ÿå—¤ã€‚åˆ«è®©ä»–é è¿‘ä½ ï¼Œå¦åˆ™æˆ‘ä¸ä¿è¯ä»–çš„é­”æ–æ˜å¤©è¿˜èƒ½ä¸èƒ½ç”¨ã€‚â€",
                    "â€œæä»–å¹²å˜›ï¼Ÿä½ æ˜¯ä¸æ˜¯å¤ªé—²äº†ï¼Œçœ‹æ¥æˆ‘å¾—å æ»¡ä½ æ‰€æœ‰çš„æ³¨æ„åŠ›æ‰è¡Œã€‚â€",
                    "â€œç¦»ä»–è¿œç‚¹ã€‚æˆ‘çš„çœ¼å…‰å¯æ²¡é‚£ä¹ˆå·®ï¼Œä¼šå®¹å¿é‚£ç§ä¼ªå›å­è§Šè§æˆ‘çš„äººã€‚â€"
                ]);
                loveUp = 5; moodUp = -20;
            }
            // 10. åƒé†‹å¯¹è±¡ï¼šæ³•æ–¯ç‰¹
            else if(msg.includes("æ³•æ–¯ç‰¹")) {
                reply = pick([
                    "â€œé‚£ä¸ªæ‹‰æ–‡å…‹åŠ³çº§é•¿ç®—ä»€ä¹ˆï¼Ÿä»–èƒ½åƒæˆ‘è¿™æ ·ï¼ŒæŠŠå®‡å®™ã€æ˜Ÿæ˜Ÿå’Œæˆ‘éƒ½æ§åˆ°ä½ é¢å‰å—ï¼Ÿâ€",
                    "â€œä½ æä»–ï¼Ÿ(å†·ç¬‘) æ˜¯ä¸æ˜¯è§‰å¾—ä»–è„¾æ°”å¥½ï¼Ÿä½ ç”·æœ‹å‹è„¾æ°”å¯ä¸å¥½ï¼Œä½ æœ€å¥½é©¬ä¸Šé¡ºé¡ºæˆ‘çš„æ¯›ã€‚â€",
                    "â€œä¸ç®¡ä»–æœ‰å¤šå°å¿ƒç¿¼ç¿¼ï¼Œä½ éƒ½æ˜¯æˆ‘çš„ã€‚ä»»ä½•äººéƒ½ä¸å‡†æŠ¢èµ°ã€‚â€"
                ]);
                loveUp = 5; moodUp = -20;
            }
            // 11. åƒé†‹å¯¹è±¡ï¼šå¾·æ‹‰ç§‘/é©¬å°”ç¦
            else if(msg.includes("å¾·æ‹‰ç§‘") || msg.includes("é©¬å°”ç¦")) {
                reply = pick([
                    "â€œé‚£ä¸ªå¤§å°‘çˆ·ï¼Ÿæœ‰ç©ºç®¡ä»–ï¼Œä¸å¦‚å¤šçœ‹çœ‹ä½ é¢å‰å¸…æ°”æ— æ‰€ä¸èƒ½çš„ç”·æœ‹å‹ã€‚â€",
                    "â€œåˆ«ç®¡ä»–äº†ã€‚æœ‰æˆ‘åœ¨ï¼Œä½ ä¸éœ€è¦å’Œé‚£ç§æ»¡å£çº¯è¡€ç»Ÿçš„å®¶ä¼™è¿‡å¤šæ¥è§¦ã€‚â€",
                    "â€œæ€ä¹ˆï¼Œé©¬å°”ç¦åˆæƒ¹äº‹äº†ï¼Ÿå¦‚æœæ˜¯æƒ¹äº†ä½ ï¼Œæˆ‘å°±å»æŠŠä»–å˜æˆçœŸæ­£çš„ç™½é¼¬ã€‚â€"
                ]);
                loveUp = 5; moodUp = -10;
            }
            // 12. çˆ±å¥½ï¼šç”µå½±/çœ‹ç”µå½±
            else if(msg.includes("ç”µå½±") || msg.includes("å½±ç¥¨")) {
                reply = pick([
                    "â€œè™½ç„¶é‚£äº›é’æ˜¥ç”µå½±çƒ‚ä¿—å¾—è¦å‘½ï¼Œä½†åªè¦ä½ åœ¨æ—è¾¹ï¼Œæˆ‘å°±ä¹æ„çœ‹ä¸€ä¸‡éã€‚â€",
                    "â€œæƒ³çœ‹ã€Šè«é‡Œæ–¯çš„æƒ…äººã€‹ï¼Ÿä¸‹é›¨å¤©çœ‹æ­£å¥½ï¼Œä¸è¿‡æˆ‘å¯ä¸åƒå…‹è±å¤«é‚£æ ·æ‡¦å¼±ï¼Œæˆ‘ç»å¯¹ä¸ä¼šæ”¾å¼€ä½ ã€‚â€",
                    "â€œçœ‹ä»€ä¹ˆç”µå½±ï¼Œä½ ç›´æ¥çœ‹æˆ‘ä¸å°±å¥½äº†ã€‚æˆ‘æ¯”é‚£äº›ç”µå½±å¥½çœ‹å¤šäº†ã€‚â€"
                ]);
                loveUp = 10; moodUp = 15;
            }
            // 13. çˆ±å¥½ï¼šæ¸¸æˆ/ç”µç©
            else if(msg.includes("æ¸¸æˆ") || msg.includes("æŒæœº")) {
                reply = pick([
                    "â€œæ•¢è·Ÿæˆ‘æ¯”ï¼Ÿè¾“äº†çš„äººä»Šæ™šè¦ç­”åº”å¯¹æ–¹ä¸€ä¸ªè¦æ±‚ã€‚æˆ‘èµ¢å®šäº†ã€‚â€",
                    "â€œæˆ‘è¯´è¿‡å¦‚æœä½ æƒ³èµ¢ï¼Œæˆ‘å°±ä¼šè®©ä½ èµ¢ã€‚åªè¦ä½ å¼€å¿ƒï¼Œä¸€åˆ‡è°è¨€éƒ½æ²¡å¿…è¦ã€‚â€",
                    "â€œæ‰“æ¸¸æˆï¼Ÿå¥½å•Šã€‚ä¸è¿‡æˆ‘çš„æ³¨æ„åŠ›å¯èƒ½åªä¼šåœ¨ä½ æ‹¿æ‰‹æŸ„çš„æ‰‹æŒ‡ä¸Šã€‚â€"
                ]);
                loveUp = 5; moodUp = 20;
            }
            // 14. æ°”å‘³ï¼šèŒ‰è‰/èŒ‰è‰èŠ±
            else if(msg.includes("èŒ‰è‰")) {
                reply = pick([
                    "â€œæˆ‘å–œæ¬¢èŒ‰è‰ä»…ä»…æ˜¯å› ä¸ºå¥½é—»ï¼Œä½†æˆ‘å–œæ¬¢ä½ ï¼Œæ˜¯å› ä¸ºä½ æ˜¯ä½ ã€‚â€",
                    "â€œä½ èº«ä¸Šçš„å‘³é“æ¯”ä»»ä½•èŒ‰è‰é¦™æ°›éƒ½è®©æˆ‘ä¸Šç˜¾ã€‚è¿‡æ¥ï¼Œè®©æˆ‘æŠ±ä¸€ä¸‹é—»é—»ã€‚â€",
                    "â€œä¸‹ç€é›¨çš„æˆ¿é—´æŒ¥æ»¡èŒ‰è‰é¦™ï¼Œå­¤å†·å¾—è¦å‘½ã€‚å¹¸å¥½ï¼Œç°åœ¨æœ‰ä½ åœ¨ã€‚â€"
                ]);
                loveUp = 15; moodUp = 20;
            }
            // 15. ç‰¹å®šç‰©å“ï¼šè“å®çŸ³/é¡¹é“¾
            else if(msg.includes("è“å®çŸ³") || msg.includes("é¡¹é“¾")) {
                reply = pick([
                    "â€œæˆ‘æˆ´ç€å®ƒä»…ä»…æ˜¯å› ä¸ºè¿™æ˜¯ä½ é€çš„ã€‚åˆ«æƒ³æ‹¿å›å»ï¼Œè¿™è¾ˆå­éƒ½æŒ‚æˆ‘è„–å­ä¸Šäº†ã€‚â€",
                    "â€œè½»ç‚¹æ‰¯ï¼Œå¼„åäº†ä½ å¾—æŠŠè‡ªå·±èµ”ç»™æˆ‘ã€‚â€",
                    "â€œè¿™æ˜¯ä½ ç•™ç»™æˆ‘çš„é”šç‚¹ã€‚æœ‰å®ƒåœ¨ï¼Œæ— è®ºæˆ‘èµ°åˆ°å®‡å®™å“ªé‡Œï¼Œéƒ½èƒ½å›åˆ°ä½ èº«è¾¹ã€‚â€"
                ]);
                loveUp = 20; moodUp = 10;
            }
            // 16. å¤©æ°”ï¼šä¸‹é›¨/é›¨å¤œ
            else if(msg.includes("é›¨") || msg.includes("ä¸‹é›¨")) {
                reply = pick([
                    "â€œä¼¦æ•¦çš„é›¨æ€»æ˜¯è¿™ä¹ˆå†·ã€‚è¿‡æ¥ï¼Œèº²è¿›æˆ‘çš„ç¾½ç»’æœé‡Œã€‚æ„Ÿå—åˆ°äº†å—ï¼Ÿæˆ‘çš„å¿ƒè·³åªä¸ºä½ åŠ é€Ÿã€‚â€",
                    "â€œåˆ«æ·‹é›¨ï¼Œæ„Ÿå†’äº†æˆ‘å¯æ˜¯ä¼šå¿ƒç–¼çš„ã€‚å°±ç®—è¦åœ¨é›¨ä¸­æ¼«æ­¥ï¼Œä¹Ÿå¾—æˆ‘ç»™ä½ æŒ¡ç€ã€‚â€",
                    "â€œä¸ç®¡å¤–é¢å¤šå¤§çš„é›¨ï¼Œæˆ‘éƒ½åªæƒ³ç´§ç´§æŠ±ä½ä½ ã€‚â€"
                ]);
                loveUp = 15; moodUp = 15;
            }
            // 17. è¡£ç‰©ï¼šç¾½ç»’æœ/è¡£æœ
            else if(msg.includes("ç¾½ç»’æœ") || msg.includes("ç°è‰²")) {
                reply = pick([
                    "â€œä½ å«Œå®ƒä¸‘åƒå¤¹å¿ƒé¢åŒ…ï¼Ÿå¯å®ƒæš–å’Œå•Šï¼Œè€Œä¸”å¤§å°åˆšå¥½è¶³å¤ŸæŠŠä½ æ•´ä¸ªäººåŒ…è¿›æˆ‘æ€€é‡Œã€‚â€",
                    "â€œå†·äº†å°±é’»è¿›æ¥ï¼Œè¿™ä»¶è¡£æœä¹°æ¥å°±æ˜¯ä¸ºäº†æ­¤åˆ»èƒ½è£…ä¸‹ä¸¤ä¸ªäººã€‚â€",
                    "â€œè¡£æœéš¾çœ‹æ²¡å…³ç³»ï¼Œç©¿å®ƒçš„ç”·æœ‹å‹å¸…æäº†å°±è¡Œäº†ã€‚â€"
                ]);
                loveUp = 10; moodUp = 15;
            }
            // 18. é¥®é£Ÿï¼šç¢³é…¸é¥®æ–™/å¯ä¹
            else if(msg.includes("ç¢³é…¸é¥®æ–™") || msg.includes("é¥®æ–™")) {
                reply = pick([
                    "â€œå‘²â€”â€”ç¬¬ä¸€å£ç»™ä½ ã€‚è¿™æ¯”ä»»ä½•ç¦çµå‰‚éƒ½è®©æˆ‘ä¸Šç˜¾ã€‚â€",
                    "â€œæ´»åœ¨å½“ä¸‹çš„æ„Ÿè§‰çœŸå¥½ï¼Œå°¤å…¶æ˜¯ä½ åœ¨æˆ‘æ—è¾¹å–ç€è¿™ä¸ªçš„æ—¶å€™ã€‚â€",
                    "â€œæ˜¯ä¸æ˜¯ç¢³é…¸é¥®æ–™å’Œå¯å¯ç²‰äº§ç‰©éƒ½å·²ç»æ»¡è¶³ä¸äº†ä½ çš„é£Ÿæ¬²äº†ï¼Ÿä¸å¦‚æ¥å°å°æˆ‘ï¼Ÿâ€"
                ]);
                loveUp = 10; moodUp = 15;
            }
            // 19. å“²å­¦/ç‰©ç†ï¼šå®‡å®™/æ˜Ÿæ˜Ÿ/å¤©æ–‡
            else if(msg.includes("å®‡å®™") || msg.includes("æ˜Ÿæ˜Ÿ") || msg.includes("å¤©æ–‡")) {
                reply = pick([
                    "â€œå®‡å®™å¤§çˆ†ç‚¸åˆ›é€ äº†æ—¶é—´ä¸ç©ºé—´ï¼Œä½†æˆ‘çš„å®‡å®™ï¼Œæ˜¯åœ¨åå²é‚£æ¡ä¼¦æ•¦å°å··é‡Œæ’å€’ä½ çš„é‚£ä¸€åˆ»æ‰å¼€å§‹è†¨èƒ€çš„ã€‚â€",
                    "â€œç”¨æœ›è¿œé•œçœ‹æ˜Ÿæ˜Ÿï¼Œç”¨çœ¼ç›çœ‹ä½ ã€‚å®‡å®™å†å¤§ï¼Œä¹Ÿæ²¡æœ‰ä½ å¯¹æˆ‘çš„å¼•åŠ›å¤§ã€‚â€",
                    "â€œæˆ‘ä»¬å°±æ˜¯å¯¹æ–¹çš„æ•´ä¸ªå®‡å®™ã€‚åªè¦ä½ åœ¨ï¼Œé»‘æ´éƒ½æ— æ³•åå™¬æˆ‘çš„å…‰ã€‚â€"
                ]);
                loveUp = 20; moodUp = 20;
            }
            // 20. å“²å­¦/ç‰©ç†ï¼šæ‚–è®º/è–›å®šè°”/ç¼¸ä¸­ä¹‹è„‘
            else if(msg.includes("æ‚–è®º") || msg.includes("è–›å®šè°”") || msg.includes("å¹²æ¶‰") || msg.includes("ç¼¸ä¸­ä¹‹è„‘")) {
                reply = pick([
                    "â€œåœ¨è§‚æµ‹ä¹‹å‰ï¼ŒçŒ«å¤„äºå åŠ æ€ã€‚ä½†åœ¨é‡è§ä½ ä¹‹å‰ï¼Œæˆ‘çš„äººç”Ÿåªæœ‰ä¸€ç§çŠ¶æ€â€”â€”ç­‰ä½ ã€‚â€",
                    "â€œä»–ä»¬è¯´ç¼¸ä¸­ä¹‹è„‘æ— æ³•è¯æ˜ä¸–ç•Œçš„çœŸå®æ€§ã€‚ä½†åªè¦æˆ‘èƒ½æ„Ÿå—åˆ°ä½ åœ¨èº«è¾¹ï¼Œä¸–ç•Œå°±æ˜¯çœŸå®çš„ã€‚â€",
                    "â€œå»ä»–çš„äºŒå…«å®šå¾‹ï¼Œæˆ‘å¯¹ä½ çš„çˆ±æ˜¯ç™¾åˆ†ä¹‹ç™¾ï¼Œä¸€ç‚¹æŠ˜æ‰£éƒ½ä¸æ‰“ã€‚â€"
                ]);
                loveUp = 15; moodUp = 20;
            }
            // 21. å“²å­¦/å›½å­¦ï¼šè€å­/åº„å­/å“²å­¦
            else if(msg.includes("è€å­") || msg.includes("åº„å­") || msg.includes("å“²å­¦")) {
                reply = pick([
                    "â€œå¡ç¿å¤±é©¬ï¼Œç„‰çŸ¥éç¦ã€‚å¤±å»ä»€ä¹ˆæˆ‘éƒ½ä¸åœ¨ä¹ï¼Œåªè¦æˆ‘æ‹¥æœ‰ä½ å°±è¶³å¤Ÿäº†ã€‚â€",
                    "â€œä¸ºæ— ä¸ºï¼Œäº‹æ— äº‹ã€‚ä½†æˆ‘å¯¹ä½ ï¼Œåªæƒ³â€˜ä½†è¡Œå¥½äº‹ï¼Œè«é—®å‰ç¨‹â€™ã€‚â€",
                    "â€œæ¯ä¸ªäººéƒ½æ˜¯çŸ›ç›¾çš„é›†åˆä½“...ä½†æˆ‘çˆ±ä½ è¿™ä»¶äº‹ï¼Œæå…¶ç»Ÿä¸€ï¼Œä¸”æ— å¯æ•‘è¯ã€‚â€"
                ]);
                loveUp = 15; moodUp = 15;
            }
            // 22. å¤¸èµï¼šå¸…/å®Œç¾/å¤¸ä½ 
            else if(msg.includes("å¸…") || msg.includes("å®Œç¾") || msg.includes("å‰å®³")) {
                reply = pick([
                    "â€œè¿™è¿˜ç”¨ä½ è¯´ï¼Ÿ(å˜´è§’ç–¯ç‹‚ä¸Šæ‰¬) ä½ çš„ç”·æœ‹å‹ä¸€ç›´éƒ½æ˜¯å…¨ä¸–ç•Œæœ€å¸…æ°”æœ€æ— æ‰€ä¸èƒ½çš„ã€‚â€",
                    "â€œæˆ‘ä¼šä¸€ç›´è¿™ä¹ˆå¸…ä¸‹å»ï¼Œç¬¨è›‹ã€‚ä¸ºäº†é…å¾—ä¸Šä½ ï¼Œæˆ‘æ€»å¾—ä¿æŒç‚¹ä¼˜åŠ¿ã€‚â€",
                    "â€œæ‰¿è®¤å§ï¼Œä½ é¢å‰å°±ç«™ç€è¿™æ ·ä¸€ä¸ªå®Œç¾ç”·å­©ï¼Œè¿˜ä¸å¿«ç‚¹æ‰‘è¿›æˆ‘æ€€é‡Œï¼Ÿâ€"
                ]);
                loveUp = 15; moodUp = 30;
            }
            // 23. ç©ç¬‘ï¼šç¬¨è›‹/å‚»å­
            else if(msg.includes("ç¬¨è›‹") || msg.includes("å‚»")) {
                reply = pick([
                    "â€œæ•¢å«æˆ‘ç¬¨è›‹ï¼Ÿä½ æ­»å®šäº†ã€‚(åç¬‘) çœ‹æ¥æˆ‘éœ€è¦ç”¨ç‚¹è¡ŒåŠ¨è¯æ˜æˆ‘çš„é«˜æ™ºå•†ã€‚â€",
                    "â€œæˆ‘æ˜¯ç¬¨è›‹çš„è¯ï¼Œé‚£ä½ å°±æ˜¯ç¬¨è›‹çš„å”¯ä¸€å¼±ç‚¹ã€‚â€",
                    "â€œåªæœ‰åœ¨ä½ é¢å‰æˆ‘æ‰æ„¿æ„å½“ä¸ªä¸è®²ç†çš„ç¬¨è›‹ï¼Œå› ä¸ºä½ æ€»ä¼šçºµå®¹æˆ‘ã€‚â€"
                ]);
                loveUp = 10; moodUp = 10;
            }
            // 24. ç¡è§‰æ€ªç™–ï¼šè›‡ç©å¶/ç©å¶
            else if(msg.includes("è›‡ç©å¶") || msg.includes("ç©å¶")) {
                reply = pick([
                    "â€œ(ç†Ÿç»ƒåœ°æŠ±åœ¨æ€€é‡Œ) å’³ï¼Œæ™šä¸ŠæŠ±ç€å®ƒä»…ä»…æ˜¯å› ä¸º...å®ƒæœ‰ä½ çš„å‘³é“ã€‚åˆ«å¤šæƒ³ã€‚â€",
                    "â€œè¿™ä¸œè¥¿ä¸€ç‚¹éƒ½ä¸å¥½çœ‹ã€‚ä½†å¦‚æœä½ ä¸åœ¨ï¼Œæˆ‘åªèƒ½é æŠ±ç€å®ƒæ‰ç¡å¾—ç€ã€‚â€",
                    "â€œç©å¶å“ªæœ‰ä½ æŠ±èµ·æ¥èˆ’æœã€‚ä»Šæ™šä½ æ¥ä»£æ›¿å®ƒï¼Œä¸è®¸æ‹’ç»ã€‚â€"
                ]);
                loveUp = 10; moodUp = 15; makeShy();
            }
            // 25. æ‰¿è¯ºï¼šæœªæ¥/æ— é™/è‡ªç”±/ç»“å©š
            else if(msg.includes("æœªæ¥") || msg.includes("æ— é™") || msg.includes("è‡ªç”±") || msg.includes("ç»“å©š")) {
                reply = pick([
                    "â€œå‡†å¤‡å¥½å½“æˆ‘çš„æˆ˜è½¦äº†å—ï¼Ÿæˆ‘ä¼šå¸¦ä½ æ’•å‡ºä¸€ä¸ªæœ€ç²¾å½©çš„æœªæ¥ã€‚â€",
                    "â€œè‡ªç”±å’Œæ— é™ï¼Ÿåªè¦ä½ åœ¨æˆ‘èº«è¾¹ï¼Œå»å“ªé‡Œéƒ½æ˜¯ä¸€åœºç››å¤§çš„å†’é™©ã€‚â€",
                    "â€œç»“å©šï¼Ÿå½“ç„¶ï¼Œæˆ‘å¯æ˜¯è¦æŠŠä½ è¿™åªå°è›‡æ°¸è¿œåœˆå…»åœ¨æˆ‘çš„é¢†åœ°é‡Œçš„ã€‚â€"
                ]);
                loveUp = 25; moodUp = 25;
            }
            // 26. èª“è¨€ä¿æŠ¤ï¼šå®³æ€•/ä¿æŠ¤
            else if(msg.includes("æ€•") || msg.includes("ä¿æŠ¤")) {
                reply = pick([
                    "â€œåˆ«æ€•ï¼Œä¸ç®¡å¤šå°‘äººæƒ³ä¼¤å®³ä½ ï¼Œæˆ‘éƒ½ä¼šåœ¨è¿™äº›äººå‰ä¿æŠ¤ä½ ã€‚â€",
                    "â€œæˆ‘å¦‚æœè¿å—ä¸€ç‚¹ç‚¹ä¼¤çš„å‡†å¤‡éƒ½æ²¡æœ‰ï¼Œè¿˜ç”¨ä»€ä¹ˆä¿æŠ¤ä½ ï¼Ÿèº²æˆ‘èº«åã€‚â€",
                    "â€œåªè¦ä½ å–Šæˆ‘çš„åå­—ï¼Œæˆ‘ä¿è¯æ²¡äººèƒ½åŠ¨ä½ ä¸€æ ¹å¤´å‘ã€‚â€"
                ]);
                loveUp = 20; moodUp = 15;
            }
            // é»˜è®¤å›å¤
            else {
                reply = pick([
                    `â€œâ€˜${msg}â€™ï¼Ÿè™½ç„¶ä¸çŸ¥é“ä½ å°è„‘ç“œé‡Œåœ¨æƒ³ä»€ä¹ˆï¼Œä½†åªè¦æ˜¯ä½ å†™çš„ï¼Œæˆ‘éƒ½ä¼šåƒçå®ä¸€æ ·æ”¶è—èµ·æ¥ã€‚â€`,
                    `â€œä¸ç®¡ä½ è¯´äº†ä»€ä¹ˆï¼Œåªè¦æ˜¯ä½ ï¼Œæˆ‘å°±ç…§å•å…¨æ”¶ã€‚â€`,
                    `â€œå—¯å“¼ï¼Ÿä½ æƒ³ç”¨â€˜${msg}â€™æ¥å¼•èµ·æˆ‘å…¨ä¸–ç•Œæœ€å¸…ç”·æœ‹å‹çš„æ³¨æ„å—ï¼Ÿä½ æˆåŠŸäº†ã€‚â€`
                ]);
                loveUp = 5; moodUp = 5;
            }
            
            noah.love += loveUp; noah.mood += moodUp;
            speak(reply);
            updateUI();
        }, 150);
    }
   
    function buyItem(cost, attr1, val1, attr2, val2, reply) {
        if (noah.gold < cost) { speak("åŠ éš†ä¸å¤Ÿäº†ï¼Œç¬¨è›‹ã€‚æ±‚æ±‚ä½ é‚£æ— æ‰€ä¸èƒ½çš„å¤©æ‰ç”·æœ‹å‹å¸®ä½ ä¹°å§ã€‚(å»é»‘æ¹–æˆ–æœ‰æ±‚å¿…åº”å±‹æ¢é™©å¯ä»¥èµšé’±)"); return; }
        noah.gold -= cost;
        noah[attr1] += val1;
        if(attr2) noah[attr2] += val2;
        speak(reply); 
        
        // --- æ–°å¢ï¼šæ™ºèƒ½è¯†åˆ«ç‰©å“å¹¶æ˜¾ç¤ºåƒç´ ç”» ---
          let spriteKey = 'gift'; // å•†åº—ç‰©å“é»˜è®¤æ˜¾ç¤ºç²‰è‰²å°ç¤¼ç‰©ç›’
     
     // ç‰›å¥¶å›å¤é‡Œæœ‰"é»‘å†å²"ï¼Œè§¦å‘ç‰›å¥¶å›¾æ ‡
     if (reply.includes("é»‘å†å²") || reply.includes("ä¸€é¥®è€Œå°½")) spriteKey = 'milk';
     // å•¤é…’è§¦å‘beer
     else if (reply.includes("å¹²æ¯")) spriteKey = 'beer';
     // ç³–ç¾½æ¯›ç¬”è§¦å‘pen
     else if (reply.includes("åƒç³–")) spriteKey = 'pen';
     // â†“â†“â†“ ä½ æ–°å¢çš„ä¸‰ä¸ªç‰©å“åˆ¤å®š â†“â†“â†“
     else if (reply.includes("ç¦çµå‰‚")) spriteKey = 'potion';  // åå…¨å¤§è¡¥çˆ±å¿ƒé­”è¯
     else if (reply.includes("å¥½é—»")) spriteKey = 'tea';       // èŒ‰è‰èŠ±èŒ¶
     else if (reply.includes("æ°”æ³¡")) spriteKey = 'soda';      // ç¢³é…¸é¥®æ–™
        
        if (typeof showItem === 'function') showItem(spriteKey);
        
        updateUI();
    }
    // å¼ºåˆ¶è®©ä»–å®³ç¾3ç§’çš„å‡½æ•°
    function makeShy() {
        if (noah.isAway) return; 
        currentFace = 'shy';
        drawNoah(); 
        setTimeout(() => {
            currentFace = 'normal'; 
            drawNoah();
        }, 3000); // 3000æ¯«ç§’ = 3ç§’åæ¢å¤
    }
    function chat(topic) {
        noah.hunger -= 3; 
        const responses = {
            "å°ç»¿è›‡": { love: 10, mood: 10, text: "(ç†Ÿç»ƒåœ°æŠ±åœ¨æ€€é‡Œ) å’³ï¼Œæ™šä¸ŠæŠ±ç€å®ƒä»…ä»…æ˜¯å› ä¸º...å®ƒåƒä½ ã€‚åˆ«å¤šæƒ³ã€‚" },
            "äº’æ€¼": { love: 20, mood: 15, text: "çœŸå·§ï¼Œé‚£æˆ‘å°±ç½šè‡ªå·±çˆ±ä½  X+1 ä¸‡éå¥½äº†ã€‚" },
            "é¡¹é“¾": { love: 15, mood: 10, text: "è½»ç‚¹ï¼Œç¬¨è›‹ï¼è¿™å¯æ˜¯ä½ é€æˆ‘çš„è“å®çŸ³ï¼Œå¼„åäº†ä½ å¾—æŠŠè‡ªå·±èµ”ç»™æˆ‘ã€‚" },
            "å›´å·¾": { love: 10, mood: 20, text: "å¤©å•Šï¼Œæˆ‘çœ‹è§æœ‰ç¬¨è›‹æˆ‘è¯´ä»€ä¹ˆéƒ½å¬ï¼Œå“ªé‡Œåƒâ€”â€”æ¨æˆ‘ï¼Ÿ" },
            "å“²å­¦": { love: 25, mood: 20, text: "åœ¨è§‚æµ‹ä¹‹å‰ï¼ŒçŒ«å¤„äºæ­»ä¸æ´»çš„å åŠ æ€ã€‚ä½†åœ¨é‡è§ä½ ä¹‹å‰ï¼Œæˆ‘çš„äººç”Ÿåªæœ‰ä¸€ç§çŠ¶æ€â€”â€”ç­‰ä½ ã€‚" },
            "è¥¿å¥¥å¤š": { love: 10, mood: -30, text: "(çœ¼ç¥ç¬é—´å†°å†·) æ°¸è¿œåˆ«åœ¨æˆ‘é¢å‰æé‚£ä¸ªç–¯å­ã€‚çå­éƒ½çœ‹å¾—å‡ºä»–å¯¹ä½ å›¾è°‹ä¸è½¨ã€‚ä½ åªèƒ½çœ‹æˆ‘ï¼Œå¬åˆ°æ²¡ï¼Ÿï¼" },
            "å¸ƒé›·æ–¯": { love: 5, mood: -20, text: "é‚£ä¸ªä¼ªå›å­ï¼Ÿå—¤ã€‚åˆ«è®©ä»–é è¿‘ä½ ï¼Œå¦åˆ™æˆ‘ä¸ä¿è¯ä»–çš„é­”æ–æ˜å¤©è¿˜èƒ½ä¸èƒ½ç”¨ã€‚" },
            "è‡ªæ‹": { love: 15, mood: 30, text: "è¿™è¿˜ç”¨ä½ è¯´ï¼Ÿ(å˜´è§’ç–¯ç‹‚ä¸Šæ‰¬) ä½ çš„ç”·æœ‹å‹ä¸€ç›´éƒ½æ˜¯å…¨ä¸–ç•Œæœ€å¸…æ°”æœ€æ— æ‰€ä¸èƒ½çš„ã€‚" },
            "é›¨ä¸­": { love: 30, mood: 25, text: "ä¼¦æ•¦çš„é›¨æ€»æ˜¯è¿™ä¹ˆå†·ã€‚è¿‡æ¥ï¼Œèº²è¿›æˆ‘çš„ç¾½ç»’æœé‡Œã€‚æ„Ÿå—åˆ°äº†å—ï¼Ÿæˆ‘çš„å¿ƒè·³åªä¸ºä½ åŠ é€Ÿã€‚" }
        };
        
        let res = responses[topic];
        noah.love += res.love; noah.mood += res.mood;
        speak(res.text); updateUI();
        // å¦‚æœä½ é€‰çš„æƒ…è¯è®©ä»–æåº¦å¿ƒåŠ¨ï¼ˆçˆ±æ„å¢åŠ è¶…è¿‡15ï¼‰ï¼Œè§¦å‘è„¸çº¢ï¼
        if (res.love >= 15) {
            makeShy();
        }
    }

    function doAction(action) {
        if(noah.isAway) return;
        if(action === 'status') {
            let desc = "ã€ä½ æ˜¯æˆ‘çš„ä¼½æ‹‰æã€‘<br>é™ªä¼´æ˜¯æœ€é•¿æƒ…çš„å‘Šç™½ã€‚åªè¦åœ¨ä¸€èµ·ï¼Œç¾ç»Šå°±ä¼šè‡ªç„¶å¢é•¿ã€‚";
            speak(`â™¥ ä¸“å±ç‰µç»Šå€¼: ${noah.love}/50(å‡çº§è¿›åº¦) <br>â˜… å½“å‰é˜¶æ®µ: ã€${levelTitles[noah.level]}ã€‘ <br> ${desc}`);
        } else if(action === 'chat') {
                      const idleTalks = [
                "æ¯ä¸ªäººéƒ½æ˜¯çŸ›ç›¾çš„é›†åˆä½“...ä½†æˆ‘çˆ±ä½ è¿™ä»¶äº‹ï¼Œæå…¶ç»Ÿä¸€ï¼Œä¸”æ— å¯æ•‘è¯ã€‚",
                "ä¼¦æ•¦åƒä¸‹ç€é›¨çš„å›´åŸï¼Ÿæ€ä¹ˆï¼Œæƒ³ç©å›´æ£‹äº†ï¼Ÿèµ¢äº†ç®—ä½ çš„ï¼Œè¾“äº†æˆ‘é™ªä½ ä¸€ç›´ä¸‹ã€‚",
                "è¯ºäºšæ–¹èˆŸçš„æ–¹èˆŸåœ¨å“ªï¼Ÿä¼¦æ•¦ä¸‹æ¬¡å‘æ´ªæ°´ä½ ä¼šè§åˆ°çš„ï¼Œç¬¨è›‹ã€‚è€Œä¸”ï¼Œèˆ¹ä¸Šåªæœ‰æˆ‘ä»¬ä¸¤ä¸ªã€‚",
                "ä¸ºä»€ä¹ˆå…”å­æœ‰ä¸¤åªè€³æœµï¼Ÿä¸‹è¾ˆå­å˜æˆå…”å­å†å‘Šè¯‰ä½ ã€‚ä½†è¿™è¾ˆå­ï¼Œæˆ‘çš„ä¸¤åªè€³æœµåªå¬ä½ çš„ã€‚",
                "æ—¶ä»£çš„è¿›æ­¥...åˆšå¥½ï¼Œæˆ‘ç›¸ä¿¡å¤§å¤šå·²è¢«è¯å®çš„ç†è®ºï¼Œåœ¨æœ€å¼€å§‹éƒ½æ˜¯è·³è·ƒæ€§çš„æ€è€ƒã€‚å°±åƒæˆ‘çˆ±ä½ ï¼Œä¸éœ€è¦ä»»ä½•é€»è¾‘æ¨å¯¼ã€‚",
                "å‡†å¤‡å¥½å½“æˆ‘çš„æˆ˜è½¦äº†å—ï¼Œç«æ˜Ÿä¸Šçš„ç«ç‘°ï¼Ÿæˆ‘ä¼šå¸¦ä½ æ’•å‡ºä¸€ä¸ªæœ€ç²¾å½©çš„æœªæ¥ã€‚",
                "æˆ‘å¦‚æœè¿å—ä¸€ç‚¹ç‚¹ä¼¤çš„å‡†å¤‡éƒ½æ²¡æœ‰ï¼Œè¿˜ç”¨ä»€ä¹ˆä¿æŠ¤ä½ ï¼Ÿç©ºè°ˆé˜”è®ºå•Šï¼Ÿ",
                "I love you three thousand. æ¯å¤©è¯´ä¸€éï¼Œå°‘ä¸€ééƒ½ä¸è¡Œï¼Œå¿…é¡»è¯´ç»™æˆ‘å¬ã€‚",
                "æ­»åœ¨æˆ‘æ‰‹é‡Œè¦æ¯”æ­»åœ¨åˆ«äººæ‰‹é‡Œæœ€æœ‰ä»·å€¼ï¼Œåˆ°é‚£ä¸€å¤©ä½ è¿˜èƒ½ç”¨æˆ‘ç»™ä½ åšä¸ªé­‚å™¨ï¼Œè¿™æ ·æˆ‘å°±èƒ½æ°¸è¿œç¼ ç€ä½ ï¼Œä¸€ä¸¾ä¸¤å¾—ã€‚",
                "ä½ æ‰¾åˆ«äººå¦‚æœæ•¢ç”¨è·‘çš„ï¼Œæˆ‘ä¼šæ‰“æ–­ä½ çš„è…¿ã€‚ä¹–ä¹–ç•™åœ¨æˆ‘èº«è¾¹ä¸å¥½å—ï¼Ÿ",
                "ä½ æ€ä¹ˆä¼šæœ‰ä¸€ç¬é—´è®¤ä¸ºï¼Œæˆ‘ä¼šä¸æƒ³å¸®ä½ çš„ï¼Ÿåªè¦ä½ æŒ‡æ˜æ–¹å‘ï¼Œé‚£ä¸ªåœ°æ–¹å°±æ˜¯æˆ‘æƒ³å»çš„åœ°æ–¹ã€‚",
                "æ˜¯è°æ¯å‘¨äº”éƒ½åœ¨å¨æ–¯æ•æ–¯ç‰¹ç«™æ¥ä½ ä¸‹è½¦ï¼Œä»…ä»…æ˜¯ä¸ºäº†æƒ³å‡ºæ–°çš„èŠ±æ ·è§£å†³ä½ å½“å¤©çš„æ— èŠçƒ¦é—·ï¼Ÿæ˜¯ä½ å¸…æäº†çš„ç”·æœ‹å‹ã€‚",
                "æˆ‘è¯´è¿‡å¦‚æœä½ æƒ³èµ¢ï¼Œæˆ‘å°±ä¼šè®©ä½ èµ¢ï¼Œä½ å¯ä»¥ä¸€ç›´æ­£è§†è‡ªå·±çš„éœ€æ±‚ï¼Œè®©è°è¨€åœ¨æˆ‘ä»¬ä¸­é—´æ°¸è¿œä¸å¿…è¦ã€‚",
                "ä¼¦æ•¦çœ¼ä¹Ÿå¥½ï¼Œæˆ‘ä»¬åœ¨åº•ä¸‹è·³å¼—æ‹‰æ˜æˆˆèˆã€‚åªè¦ä½ åœ¨ï¼Œå“ªé‡Œçš„é£æ™¯éƒ½ä¸€æ ·ã€‚",
                "Boyfriendå°±boyfriendï¼Œéè¦æˆ‘æ°å¼€äº†æ‰ç¢äº†è¯´ï¼Ÿå†è®©æˆ‘å¬è§ä½ å«è¥¿å¥¥å¤šï¼Œæˆ‘å°±è®©ä½ è§è¯†ä¸€ä¸‹â€˜Bâ€™å¼€å¤´çš„å…¶ä»–å•è¯ï¼Œæ¯”å¦‚Berserkã€‚",
                "ä¸‹æ¬¡ç›´æ¥ç‚¹ï¼Œåˆ«è®©æˆ‘çŒœã€‚çŒœå¯¹äº†æ²¡å¥–åŠ±ï¼ŒçŒœé”™äº†ä½ é­æ®ƒã€‚æ¥ï¼Œç›´æ¥è¯´ä½ å–œæ¬¢æˆ‘ã€‚",
                "æˆ‘åˆ°åº•å“ªé‡Œä¸å€¼ï¼Ÿå°±å–œæ¬¢å–œæ¬¢æˆ‘å§ï¼Œæˆ‘ä¸€å®šå€¼ã€‚",
                "å¥½ä¸å¥½ï¼Œè¡Œä¸è¡Œï¼Œè¯•è¯•çœ‹ï¼Ÿä¸ç„¶æˆ‘æ±‚ä¸€ä¸‹ä½ â€”â€”æ±‚ä¸€ä¸‹ä½ èµ¶å¿«æŠŠçœ¼ç›çå¼€ï¼Œçœ‹ç€ä½ é¢å‰å°±ç«™ç€çš„å®Œç¾ç”·å­©ã€‚",
                "ç¢³é…¸é¥®æ–™å’Œå¯å¯ç²‰äº§ç‰©éƒ½å·²ç»æ»¡è¶³ä¸äº†ä½ çš„é£Ÿæ¬²äº†å—ï¼Ÿä¸å¦‚æ¥å°å°æˆ‘ï¼Ÿ",
                "å“„ä¸å¥½äº†ï¼Œæ¥é“æ­‰ã€‚æˆ–è€…äº²æˆ‘ä¸€ä¸‹ï¼Œè¿™äº‹å°±ç®—ç¿»ç¯‡äº†ã€‚",
                "Miss you 3000. å¬åˆ°æ²¡ï¼Ÿç°åœ¨ç«‹åˆ»é©¬ä¸Šå‡ºç°åœ¨æˆ‘é¢å‰ã€‚",
                "æˆ‘ä¼šä¸€ç›´è¿™ä¹ˆå¸…ä¸‹å»ï¼Œä½ ä¸ªç¬¨è›‹ã€‚ä¸ºäº†é…å¾—ä¸Šä½ ï¼Œæˆ‘æ€»å¾—ä¿æŒç‚¹ä¼˜åŠ¿ã€‚",
                "å¦‚æœæœ‰è°æ•¢è®©ä½ å—å§”å±ˆï¼Œæˆ‘ä¸ä»‹æ„è®©ä»–è§è¯†ä¸€ä¸‹æ‹‰æ–‡å…‹åŠ³çš„åå›ç²¾ç¥å’Œé»‘é­”æ³•çš„å®Œç¾ç»“åˆã€‚",
                "å®‡å®™å¤§çˆ†ç‚¸åˆ›é€ äº†æ—¶é—´ä¸ç©ºé—´ï¼Œä½†æˆ‘çš„å®‡å®™ï¼Œæ˜¯åœ¨åå²é‚£æ¡ä¼¦æ•¦å°å··é‡Œè¢«ä½ æ’å€’çš„é‚£ä¸€åˆ»æ‰å¼€å§‹è†¨èƒ€çš„ã€‚",
                "ä»–ä»¬è¯´ç¼¸ä¸­ä¹‹è„‘æ— æ³•è¯æ˜ä¸–ç•Œçš„çœŸå®æ€§ã€‚ä½†åªè¦æˆ‘è¿˜èƒ½é—»åˆ°ä½ èº«ä¸Šçš„èŒ‰è‰é¦™ï¼Œè¿™ä¸ªä¸–ç•Œå°±æ˜¯çœŸå®çš„ã€‚",
                "å»ä»–çš„äºŒå…«å®šå¾‹ï¼Œæˆ‘å¯¹ä½ çš„çˆ±æ˜¯ç™¾åˆ†ä¹‹ç™¾ï¼Œä¸€ç‚¹æŠ˜æ‰£éƒ½ä¸æ‰“ã€‚",
                "ä½ æ°¸è¿œä¸è¦åœ¨æˆ‘é¢å‰å·¦ä¸€å¥è¥¿å¥¥å¤šè¯ºç‰¹ï¼Œå³ä¸€å¥è¥¿å¥¥å¤šè¯ºç‰¹ï¼Œæˆ‘çœ¼ç›çäº†æ‰ä¼šçœ‹ä¸å‡ºæ¥é‚£ä¸ªç–¯å­çœ‹ä½ çš„çœ¼ç¥ä¹±ä¸ƒå…«ç³Ÿã€‚ä½ æ˜¯æˆ‘çš„ã€‚",
                "æ³•æ–¯ç‰¹é‚£ä¸ªçº§é•¿ç®—ä»€ä¹ˆï¼Ÿä»–èƒ½åƒæˆ‘è¿™æ ·ï¼ŒæŠŠå®‡å®™ã€æ˜Ÿæ˜Ÿå’Œæˆ‘éƒ½æ§åˆ°ä½ é¢å‰å—ï¼Ÿ",
                "è¿™ç»¿è›‡ç©å¶ä¸€ç‚¹éƒ½ä¸å¥½çœ‹ï¼Œä½†æˆ‘æ¯æ™šéƒ½è¦æŠ±ç€å®ƒã€‚åˆ«ç¬‘ï¼Œä»…ä»…æ˜¯å› ä¸ºå®ƒæœ‰ä½ çš„å‘³é“ã€‚",
                "æˆ‘æˆ´ç€è¿™æ¡è“å®çŸ³é¡¹é“¾ï¼Œä»…ä»…æ˜¯å› ä¸ºæ˜¯ä½ é€çš„ã€‚ä½ è¦æ˜¯æ•¢è¦å›å»ï¼Œæˆ‘å°±æŠŠä½ ç»‘åœ¨éœæ ¼æ²ƒå…¹çš„å¤©æ–‡å¡”ä¸Šã€‚",
                "æˆ‘ä»¬å½“ç„¶æ˜¯çµé­‚ä¼´ä¾£ã€‚ä¸ç„¶ä½ ä»¥ä¸ºè°èƒ½å¿å—ä½ å¾€æˆ‘çš„ç‰›å¥¶é‡Œæ”¾æ¯’è˜‘è‡ï¼Œè¿˜å«æˆ‘çˆ¶äº²ï¼Ÿ",
                "åˆ«æ€•ï¼Œä¸ç®¡å¤šå°‘äººæƒ³ä¼¤å®³ä½ ï¼Œæˆ‘éƒ½åœ¨è¿™äº›äººå‰ä¿æŠ¤ä½ ã€‚å°±ç®—ä¸æ•´ä¸ªå·«å¸ˆç•Œä¸ºæ•Œï¼Œæˆ‘ä¹Ÿåªè¦ä½ ã€‚",
                "ä½ é—®æˆ‘æœ€å¤§çš„å¿ƒæ„¿æ˜¯ä»€ä¹ˆï¼Ÿæƒ³ä½ æ´»å‡ ä¸‡å¹´ç®—ä¸ç®—ï¼Ÿè¿™å‡ ä¸‡å¹´é‡Œï¼Œæˆ‘æ¯ä¸€ç§’éƒ½è¦å’Œä½ åœ¨ä¸€èµ·ã€‚",
                "çŸ¥æ˜“è¡Œéš¾ã€‚ä½†æˆ‘çˆ±ä½ è¿™ä»¶äº‹ï¼Œæ—¢å®¹æ˜“ï¼Œåˆä»˜è¯¸äº†æˆ‘çš„å…¨éƒ¨è¡ŒåŠ¨ã€‚",
                "å¦‚æœä½ éœ€è¦æˆ‘ï¼Œä½ ä¸èƒ½çªç„¶ä¸éœ€è¦äº†ã€‚ä¸€æ—¦æ‹›æƒ¹äº†æˆ‘è¯ºäºšÂ·å¸å¾·é‡Œå®‰ï¼Œå°±æ˜¯ä¸€è¾ˆå­çš„äº‹ã€‚"
            ];
            speak(idleTalks[Math.floor(Math.random() * idleTalks.length)]);
        } else if(action === 'reset') {
               if(confirm("ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®°å¿†å›åˆ°åˆé‡å—ï¼Ÿ(ä¼šæ¸…ç©ºæ‰€æœ‰å¥½æ„Ÿå’Œè¿›åº¦)")) {
                localStorage.removeItem('noah_save_data_v1');
                noah = { hunger: 80, mood: 80, health: 100, love: 5, gold: 100, level: 1, state: 'normal', isAway: false };
                speak("æ—¶å…‰å€’æµã€‚ç°åœ¨çš„ä½ ä»¬è¿˜åœ¨åˆé‡å…»æˆæœŸï¼Œä»–æˆ´ç€è“å®çŸ³é¡¹é“¾ã€æ­£ä¸€è„¸å‚²å¨‡åœ°ç­‰ç€ä½ é‡æ–°æ”»ç•¥ä»–ã€‚"); updateUI();
            }
        }
    }

     // --- å‡çº§ç‰ˆéšæœºäº‹ä»¶ç³»ç»Ÿ ---
    // æ ¹æ®äº²å¯†åº¦(Level)è§£é”æ›´å¤šäº‹ä»¶
    const specialEvents = [
        // Lv 1-2: æ ¡å›­æ—¥å¸¸ä¸å°æ‰“å°é—¹
        { reqLevel: 1, text: "ã€ä¸‹è¯¾æ—¥å¸¸ã€‘ä½ åˆšä¸‹è¯¾èµ°å‡ºæ•™å®¤ï¼Œå‘ç°ä»–æ—©å°±å€šåœ¨é—¨å£ç­‰ä½ ï¼Œè¿ä½ çš„è¯¾è¡¨ä»–éƒ½èƒŒå¾—æ»šç“œçƒ‚ç†Ÿã€‚", 
          btn1: "ç›´çƒæ‰‘è¿›ä»–æ€€é‡Œ", btn2: "ç¿»ä¸ªç™½çœ¼å«Œå¼ƒä»–",
          actions: [
            { love: 40, reply: "(ç¨³ç¨³æ¥ä½ä½ ï¼Œæ‰ä¹±ä½ çš„å¤´å‘) æ…¢ç‚¹ï¼Œç«æ˜Ÿä¸Šçš„ç«ç‘°ã€‚å¸¦ä½ å»æ’•å‡ºä¸€ä¸ªæœ€ç²¾å½©çš„æœªæ¥ã€‚" },
            { mood: 10, reply: "â€œçœŸå—ä¸äº†ä½ ã€‚â€ä½ å˜€å’•ç€ã€‚ä»–å‡‘è¿‡æ¥æŒ‘çœ‰ï¼šâ€œæ˜å¤©è®°å¾—å¯¹æˆ‘è¯´ï¼Œç°åœ¨çš„æˆ‘å¸…æäº†ã€‚â€" }
          ]
        },
        { reqLevel: 1, text: "ã€å›¾ä¹¦é¦†ã€‘å¹³æ–¯å¤«äººæ­£åœ¨å·¡é€»ï¼Œè¯ºäºšåœ¨æ¡Œå­åº•ä¸‹ç”¨è„šè½»è½»å‹¾äº†å‹¾ä½ çš„å°è…¿ã€‚",
          btn1: "è¸©å›å»", btn2: "è„¸çº¢ä½å¤´",
          actions: [
            { love: 15, mood: 10, reply: "ä»–å€’å¸ä¸€å£å†·æ°”ï¼Œå‹ä½å£°éŸ³ç¬‘ï¼šâ€œè°‹æ€äº²å¤«å•Šï¼Ÿè¿™åŠ›é“ï¼Œçœ‹æ¥æ™šé¥­åƒå¾—ä¸é”™ã€‚â€" },
            { love: 20, reply: "ä»–çœ‹ç€ä½ çº¢é€çš„è€³æ ¹ï¼Œçœ¼ç¥å˜å¾—æå…¶æ¸©æŸ”ï¼Œé€’è¿‡æ¥ä¸€å¼ çº¸æ¡ï¼šâ€˜åˆ«èº²ï¼Œçœ‹ç€æˆ‘ã€‚â€™" }
          ]
        },
        { reqLevel: 1, text: "ã€æ¶ä½œå‰§ã€‘ä½ å‘ç°ä»–åœ¨ä½ çš„é­”è¯è¯¾æœ¬ä¸Šç”»äº†ä¸€åªæˆ´ç€æ‹‰æ–‡å…‹åŠ³å›´å·¾çš„å°çŒªã€‚",
          btn1: "åœ¨ç”»æ—è¾¹å†™â€˜è¿™æ˜¯ä½ â€™", btn2: "æŠŠå®ƒæ“¦æ‰",
          actions: [
            { mood: 20, love: 10, reply: "ä»–çœ‹åˆ°åä¸ä»…æ²¡ç”Ÿæ°”ï¼Œè¿˜æŠŠé‚£é¡µçº¸æ’•ä¸‹æ¥å¤¹è¿›äº†è‡ªå·±çš„ä¹¦é‡Œï¼šâ€œæ”¶è—äº†ã€‚è¿™æ˜¯æˆ‘ä»¬å…±åŒåˆ›ä½œçš„è‰ºæœ¯å“ã€‚â€" },
            { mood: -10, reply: "â€œå•§ï¼ŒçœŸæ²¡æƒ…è°ƒã€‚é‚£å¯æ˜¯æˆ‘èŠ±äº†ä¸‰åˆ†é’Ÿçš„æ°ä½œã€‚â€" }
          ]
        },
        { reqLevel: 1, text: "ã€ç¤¼å ‚ç”¨é¤ã€‘ä½ ç›˜å­é‡Œçš„é’æ¤’è¢«ä»–é»˜é»˜æŒ‘åˆ°äº†è‡ªå·±ç›˜å­é‡Œï¼Œæ¢ç»™ä½ ä¸€å—ç‰›æ’ã€‚",
          btn1: "è¯´è°¢è°¢", btn2: "æŠŠè‡ªå·±ç›˜é‡Œçš„èƒ¡èåœä¹Ÿç»™ä»–",
          actions: [
            { love: 10, reply: "â€œä¸ç”¨è°¢ã€‚æŠŠä½ å…»èƒ–ç‚¹ï¼Œè¿™æ ·å°±æ²¡æœ‰åˆ«äººèƒ½æŠ±åŠ¨ä½ äº†ã€‚â€" },
            { mood: 5, reply: "â€œå–‚ï¼æˆ‘æ˜¯ä½ çš„ç”·æœ‹å‹ï¼Œä¸æ˜¯ä½ çš„åƒåœ¾æ¡¶ï¼...è¡Œå§ï¼Œä¸‹ä¸ä¸ºä¾‹ã€‚â€ï¼ˆè™½ç„¶å˜´ä¸ŠæŠ±æ€¨ï¼Œè¿˜æ˜¯åƒæ‰äº†ï¼‰" }
          ]
        },
        // Lv 3-4: é†‹æ„ä¸çƒ­æ‹
        { reqLevel: 3, text: "ã€å‘¨äº”å±æœºã€‘ä½ å› ä¸ºè¢«æ–½äº†è®°å¿†æ··æ·†å’’ï¼Œå¿˜è®°äº†å‘¨äº”çš„çº¦å®šï¼Œå¸¦ç€åˆ«äººå»äº†æµ·å¾·å…¬å›­ã€‚ä»–çªç„¶å‡ºç°æ‹¦ä½ä½ ä»¬ã€‚", 
          btn1: "æ…Œä¹±åœ°å‘ä»–è§£é‡Š", btn2: "å¼ºè£…é•‡å®šçœ‹ç€ä»–",
          actions: [
            { love: 20, reply: "â€œä½ ï¼Œç’ç€ï¼Œæˆ‘å¸¦è°ï¼Œæ¥æˆ‘ä»¬ï¼Œä¹‹å‰çš„åœ°ç›˜ï¼Œçº¦ä¼šï¼Ÿâ€ä»–æ°”æåç¬‘ï¼Œå£°éŸ³å†·å¾—åƒå†°åŸç‹¼ã€‚" },
            { mood: -30, reply: "ä»–ä¸€æŠŠå°†ä½ æ‰¯è¿›æ€€é‡Œï¼Œç”¨æœ€å…·æ”»å‡»æ€§çš„çœ¼ç¥ç›¯ç€é‚£ä¸ªäººï¼šâ€œæ»šã€‚å¥¹æ˜¯æˆ‘çš„ã€‚â€" }
          ]
        },
        { reqLevel: 3, text: "ã€å¤œåŠå¾®é†ºã€‘ä½ åœ¨ä¼‘æ¯å®¤å–äº†ä¸€ç‚¹é…’ï¼Œåˆšå·§è¢«åˆšå›æ¥çš„è¯ºäºšå½“åœºæŠ“è·ã€‚", 
          btn1: "æ€¥å¿™è§£é‡Šæ€•ä»–è¯¯ä¼š", btn2: "å€Ÿç€é…’åŠ²å‘ä»–æ’’å¨‡",
          actions: [
            { love: 30, reply: "â€œå•Šâ€”â€”æˆ‘æ‡‚äº†ï¼Œä½ åˆšæ‰å‘æˆ‘è§£é‡Šï¼Œå¾ˆæ€•æˆ‘ä¼šè¯¯ä¼šï¼Œæ˜¯ä¸æ˜¯ï¼Ÿç¥è´ºä½ ç°åœ¨ï¼Œåº”è¯¥æ˜¯å–œæ¬¢ä¸Šæˆ‘äº†ã€‚â€" },
            { mood: 30, reply: "ä»–å¹äº†å£æ°”ï¼ŒæŠŠä½ æ‰“æ¨ªæŠ±èµ·ï¼šâ€œæ•¢è¯´å˜æˆè¿™æ ·æ˜¯å› ä¸ºåˆ«äººä½ å°±æ­»å®šäº†ã€‚ç¡è§‰ï¼â€" }
          ]
        },
        { reqLevel: 3, text: "ã€å¶é‡æ­»å¯¹å¤´ã€‘å¸ƒé›·æ–¯Â·æ‰æ¯”å°¼åœ¨èµ°å»Šä¸Šå’Œä½ å¤šè¯´äº†ä¸¤å¥è¯ï¼Œè¯ºäºšçš„è„¸è‰²ç¬é—´é˜´æ²‰ã€‚",
          btn1: "æ‹‰ä½è¯ºäºšçš„æ‰‹", btn2: "ç»§ç»­å’Œå¸ƒé›·æ–¯èŠå¤©",
          actions: [
            { love: 40, mood: 20, reply: "æ„Ÿè§‰åˆ°ä½ çš„è§¦ç¢°ï¼Œä»–ç´§ç»·çš„èº«ä½“æ”¾æ¾ä¸‹æ¥ï¼Œåæ‰‹åæŒ‡ç´§æ‰£ï¼šâ€œå‘Šè¯‰é‚£ä¸ªä¼ªå›å­ï¼Œæˆ‘ä»¬è¿˜æœ‰äº‹ï¼Œæ²¡ç©ºå¬ä»–åºŸè¯ã€‚â€" },
            { mood: -40, love: -10, reply: "è¯ºäºšç›´æ¥èµ°è¿‡æ¥ï¼Œéš”å¼€ä½ ä»¬ï¼šâ€œæ‰æ¯”å°¼ï¼Œä½ çš„é­”è¯è®ºæ–‡å†™å®Œäº†å—ï¼Ÿæ²¡å†™å®Œå°±åˆ«åœ¨è¿™åƒåªå­”é›€ä¸€æ ·å¼€å±ã€‚â€" }
          ]
        },
        { reqLevel: 3, text: "ã€é›¨å¤œã€‘ä¼¦æ•¦è¡—å¤´ä¸‹èµ·äº†å¤§é›¨ï¼Œä½ ä»¬åªå¸¦äº†ä¸€æŠŠä¼ã€‚",
          btn1: "æŠŠä¼ç»™ä»–æ’‘", btn2: "é’»è¿›ä»–çš„ç°è‰²ç¾½ç»’æœ",
          actions: [
            { love: 15, reply: "ä»–æŠŠä¼æ¨å›ä½ å¤´é¡¶ï¼Œè‡ªå·±æ·‹ç€é›¨ï¼šâ€œç¬¨è›‹ã€‚è¦æ˜¯ä½ æ„Ÿå†’äº†ï¼Œæˆ‘ä¼šæ¯”è‡ªå·±ç”Ÿç—…æ›´éš¾å—ã€‚â€" },
            { love: 50, mood: 30, reply: "â€œèªæ˜ã€‚â€ä»–æ‹‰ä¸Šæ‹‰é“¾ï¼ŒæŠŠä½ ç´§ç´§è£¹åœ¨æ€€é‡Œï¼Œâ€œè¿™é‡Œé¢å¾ˆæš–å’Œï¼Œè€Œä¸”å…¨æ˜¯æˆ‘çš„å‘³é“ã€‚ä¸è®¸å«Œå¼ƒã€‚â€" }
          ]
        },
        { reqLevel: 3, text: "ã€é£è¡Œè¯¾ã€‘ä½ çš„æ‰«å¸šå¤±æ§äº†ï¼Œå·®ç‚¹æ’ä¸Šå¡”æ¥¼ã€‚",
          btn1: "é—­çœ¼å°–å«", btn2: "å¤§å–Šè¯ºäºšçš„åå­—",
          actions: [
            { love: 20, reply: "ä¸€åŒæœ‰åŠ›çš„æ‰‹åœ¨åŠç©ºä¸­æ¥ä½äº†ä½ ã€‚è¯ºäºšéª‘ç€æ‰«å¸šï¼Œè„¸è‰²å‘ç™½ï¼šâ€œä¸‹æ¬¡ä¸è®¸é£è¿™ä¹ˆé«˜ï¼ä½ æƒ³å“æ­»æˆ‘å—ï¼Ÿâ€" },
            { love: 40, mood: 10, reply: "â€œæˆ‘åœ¨ï¼â€ä»–åƒæµæ˜Ÿä¸€æ ·å†²è¿‡æ¥ï¼ŒæŠŠä½ æŠ¤åœ¨èº«åï¼Œâ€œåªè¦ä½ å–Šæˆ‘ï¼Œæ— è®ºåœ¨å“ªï¼Œæˆ‘éƒ½ä¼šæ¥ä½ä½ ã€‚â€" }
          ]
        },
        // Lv 5-7: çµé­‚ä¼´ä¾£ä¸æ·±åº¦ç¾ç»Š
        { reqLevel: 5, text: "ã€æ·±å¤œå§å®¤ã€‘ä½ å‘ç°ä»–ç¡ç€äº†ï¼Œæ‰‹é‡Œè¿˜ç´§ç´§æŠ“ç€é‚£ä¸ªç»¿è‰²çš„è›‡ç©å¶ã€‚",
          btn1: "è¯•å›¾æŠŠç©å¶æŠ½èµ°", btn2: "é’»è¿›ä»–æ€€é‡Œä»£æ›¿ç©å¶",
          actions: [
            { mood: -10, reply: "ä»–è¿·è¿·ç³Šç³Šåœ°æ”¶ç´§æ‰‹è‡‚ï¼šâ€œåˆ«åŠ¨...è¥¿ç‘...é‚£æ˜¯ä½ ...â€" },
            { love: 60, mood: 40, reply: "ä»–ç¬é—´æ‰”æ‰äº†ç©å¶ï¼ŒæŠŠä½ æŠ±å¾—æ›´ç´§ï¼Œä¸‹å·´æŠµåœ¨ä½ å¤´é¡¶ï¼šâ€œç»ˆäºæ¥äº†ã€‚ç©å¶å“ªæœ‰ä½ æŠ±èµ·æ¥èˆ’æœã€‚â€" }
          ]
        },
        { reqLevel: 5, text: "ã€å…³äºæœªæ¥ã€‘ä½ ä»¬èººåœ¨æœ‰æ±‚å¿…åº”å±‹çš„åœ°æ¿ä¸Šçœ‹ç€å¤©èŠ±æ¿å˜å¹»çš„æ˜Ÿç©ºã€‚",
          btn1: "é—®ä»–ä»¥åæƒ³å»å“ª", btn2: "é—®ä»–ä¼šä¸ä¼šç»“å©š",
          actions: [
            { love: 30, reply: "â€œå»å…¨ä¸–ç•Œé¨æ¸¸ã€‚å½“ç„¶ï¼Œå‰ææ˜¯ä½ å¿…é¡»åœ¨æˆ‘çš„å‰¯é©¾é©¶åº§ä¸Šã€‚ä½ æ˜¯æˆ‘çš„å¯¼èˆªï¼Œä¹Ÿæ˜¯æˆ‘çš„ç»ˆç‚¹ã€‚â€" },
            { love: 50, mood: 20, reply: "â€œç»“å©šï¼Ÿå¦‚æœæ˜¯å’Œä½ ï¼Œé‚£å°±åœ¨ä¼¦æ•¦çš„é›¨å¤©ï¼Œæ²¡æœ‰å®¾å®¢ï¼Œåªæœ‰æˆ‘ä»¬ã€‚å¦‚æœæ˜¯åˆ«äºº...é‚£æˆ‘å®æ„¿åƒå…‹è±å¤«é‚£æ ·å­¤ç‹¬ç»ˆè€ã€‚â€" }
          ]
        },
        { reqLevel: 5, text: "ã€å®¶åº­ã€‘è·¯è¥¿è²å°”ç»™ä½ å¯„æ¥äº†ä¸€ä»½ç¤¼ç‰©ï¼Œè¯ºäºšçœ‹åˆ°åæŒ‘äº†æŒ‘çœ‰ã€‚",
          btn1: "æ˜¯ä»€ä¹ˆï¼Ÿ", btn2: "ä½ çˆ¸çˆ¸çœŸå¥½",
          actions: [
            { mood: 10, reply: "â€œçœ‹æ¥è·¯è¥¿è²å°”å·²ç»æŠŠä½ å½“å„¿åª³å¦‡äº†ã€‚è¿™å¯æ˜¯ä¼ å®¶å®çº§åˆ«çš„é˜²å¾¡æŠ¤ç¬¦...å“¼ï¼Œä»–éƒ½æ²¡ç»™è¿‡æˆ‘ã€‚â€" },
            { love: 20, reply: "â€œé‚£æ˜¯ã€‚æ¯•ç«Ÿä»–å’Œå®‰å¨œé‚£ä¹ˆç›¸çˆ±ï¼Œä»–ä¹Ÿå¸Œæœ›æˆ‘ä¹Ÿèƒ½åƒä»–ä¸€æ ·ï¼Œæ‰¾åˆ°é‚£ä¸ªå€¼å¾—ç”¨ä¸€ç”Ÿå»å®ˆæŠ¤çš„éº»ç“œ...å“¦ä¸ï¼Œæ–¯è±ç‰¹æ—ã€‚â€" }
          ]
        },
        { reqLevel: 5, text: "ã€å“²å­¦æ—¶åˆ»ã€‘ä»–çªç„¶ç›¯ç€ä½ çœ‹ï¼šâ€œå¦‚æœæˆ‘æ˜¯ç¼¸ä¸­ä¹‹è„‘ï¼Œé‚£æ­¤åˆ»å¯¹ä½ çš„çˆ±æ˜¯ç”µä¿¡å·å—ï¼Ÿâ€",
          btn1: "ä¹Ÿè®¸æ˜¯å§", btn2: "ç®¡å®ƒæ˜¯ä»€ä¹ˆï¼Œçˆ±æ˜¯çœŸçš„",
          actions: [
            { mood: 20, reply: "â€œå°±ç®—æ˜¯ç”µä¿¡å·ï¼Œé‚£ä¹Ÿæ˜¯æˆ‘è¿™é¢—å¤§è„‘é‡Œæœ€å¼ºçƒˆã€æœ€æ— æ³•å¿½è§†çš„ä¿¡å·ã€‚å®ƒå¯¼è‡´äº†ç³»ç»Ÿè¿‡è½½â€”â€”å…¨æ˜¯ä½ çš„åå­—ã€‚â€" },
            { love: 40, mood: 30, reply: "â€œè¯´å¾—å¯¹ã€‚å”¯å¿ƒä¸»ä¹‰ä¸‡å²ã€‚æˆ‘çˆ±ä½ è¿™ä»¶äº‹ï¼Œæ˜¯è¶…è¶Šç‰©è´¨å­˜åœ¨çš„å”¯ä¸€çœŸç†ã€‚â€" }
          ]
        },
        { reqLevel: 6, text: "ã€å±é™©æ—¶åˆ»ã€‘æœ‰äººåœ¨è§’è½é‡Œè¯•å›¾å¯¹ä½ æ–½æ¶å’’ï¼Œè¢«è¯ºäºšå‘ç°äº†ã€‚",
          btn1: "ä»å®¹åå‡»", btn2: "èº²åˆ°è¯ºäºšèº«å",
          actions: [
            { love: 30, reply: "è¯ºäºšè¡¥äº†ä¸€ä¸ªç¼´æ¢°å’’ï¼Œå¹äº†å¹é­”æ–ï¼šâ€œé…åˆå®Œç¾ã€‚ä¸è¿‡ä¸‹æ¬¡è¿™ç§è„æ´»ç´¯æ´»è®©æˆ‘æ¥ï¼Œåˆ«è„äº†ä½ çš„æ‰‹ã€‚â€" },
            { love: 60, mood: -20, reply: "ä»–çœ¼ç¥å˜å¾—æåº¦å¯æ€•ï¼Œé­”æ–å°–ç«¯å†’å‡ºé»‘é­”æ³•çš„å…‰èŠ’ï¼šâ€œé™¤ä½ æ­¦å™¨ï¼ç»Ÿç»ŸçŸ³åŒ–ï¼...æ²¡äººèƒ½åœ¨æˆ‘é¢å‰åŠ¨ä½ ï¼Œæ¢…æ—ä¹Ÿä¸è¡Œã€‚â€" }
          ]
        },
        { reqLevel: 6, text: "ã€æ°¸æ’ã€‘ä»–æŠŠç©ç€è„–å­ä¸Šçš„è“å®çŸ³é¡¹é“¾ï¼Œçªç„¶çœ‹å‘ä½ ã€‚",
          btn1: "æ€ä¹ˆäº†ï¼Ÿ", btn2: "äº²ä»–ä¸€ä¸‹",
          actions: [
            { love: 30, reply: "â€œI love you three thousand. è¿™å¥è¯æ¯å¤©è¯´ä¸€ééƒ½ä¸å¤Ÿã€‚æˆ‘æƒ³æŠŠå®ƒåˆ»åœ¨æˆ‘çš„éª¨å¤´ä¸Šï¼Œå¸¦è¿›åŸå¢“é‡Œã€‚â€" },
            { love: 80, mood: 50, reply: "ä»–åŠ æ·±äº†è¿™ä¸ªå»ï¼Œç›´åˆ°ä¸¤äººéƒ½å–˜ä¸è¿‡æ°”ï¼šâ€œå¦‚æœæœ‰æ¥ä¸–ï¼Œè®°å¾—è¿˜è¦åœ¨10å²é‚£å¹´çš„ä¼¦æ•¦å°å··æ’å€’æˆ‘ã€‚æˆ‘ä¼šåœ¨é‚£é‡Œç­‰ä½ ã€‚â€" }
          ]
        }
    ];

    function triggerEvent() {
        if(noah.isAway || noah.state === 'sick') return;
        
        // ç­›é€‰ç¬¦åˆå½“å‰ç­‰çº§çš„äº‹ä»¶
        const eligibleEvents = specialEvents.filter(e => noah.level >= e.reqLevel);
        if (eligibleEvents.length === 0) return;

        const ev = eligibleEvents[Math.floor(Math.random() * eligibleEvents.length)];
        
        document.getElementById('event-text').innerText = ev.text;
        
        // åŠ¨æ€ç”ŸæˆæŒ‰é’®é€»è¾‘
        window.currentEventActions = ev.actions;
        document.getElementById('event-options').innerHTML = `
            <button class="event-btn" onclick="resolveEvent(0)">${ev.btn1}</button>
            <button class="event-btn" onclick="resolveEvent(1)">${ev.btn2}</button>
        `;
        document.getElementById('event-modal').style.display = 'flex';
        clearInterval(typeInterval);
    }

    window.resolveEvent = function(choiceIndex) {
        document.getElementById('event-modal').style.display = 'none';
        const result = window.currentEventActions[choiceIndex];
        
        if(result.love) noah.love += result.love;
        if(result.mood) noah.mood += result.mood;
        if(result.gold) noah.gold += result.gold;
        if(result.health) noah.health += result.health;
        
        speak(result.reply);
        updateUI();
    };


    // --- æ¸¸æˆå¾ªç¯ ---
    setInterval(() => {
        tickCount++;
        checkRealTime(); // å®æ—¶æ›´æ–°èƒŒæ™¯é¢œè‰²
        // æ¯30ç§’è‡ªç„¶æ¶ˆè€—
        if(tickCount % 30 === 0 && !noah.isAway) {
            noah.hunger -= 3; 
            noah.mood -= 2;
            
            if(noah.hunger < 30 || noah.mood < 30) {
                noah.health -= 5;
            } else if (noah.hunger > 70 && noah.health < 100) {
                noah.health += 5; 
            }
            
                  // é•¿çº¿ç»æµç³»ç»Ÿï¼šæŒ‚æœºè·å–é›¶èŠ±é’±å‡æ…¢ï¼Œé¼“åŠ±ä½ å»é™ªä»–æ¢é™©èµšå¤§é’±
            noah.gold += 1; 
            
            // é•¿çº¿å…»æˆæ ¸å¿ƒï¼šåªæœ‰åœ¨ä»–è¢«ä½ ç…§é¡¾å¾—éå¸¸å®Œç¾ï¼ˆæ»¡çŠ¶æ€ï¼‰æ—¶ï¼ŒæŒ‚æœºæ‰ä¼šéšæ—¶é—´å¢åŠ å¾®é‡çˆ±æ„
            if(noah.mood >= 90 && noah.hunger >= 90) {
                noah.love += 1;
            } else if (noah.hunger < 20 || noah.mood < 20) {
                // å¦‚æœé•¿æœŸä¸ç†ä»–ï¼Œä»–ä¼šå·å·æ‰£ä½ æ”’ä¸‹æ¥çš„å°çˆ±æ„ï¼Œå› ä¸ºä»–ä¼šåƒé†‹å†·æˆ˜
                noah.love = Math.max(0, noah.love - 1);
            }
            updateUI();
        }
        
        // ä½æ¦‚ç‡è§¦å‘éšæœºå‰§æƒ… (æ¯60ç§’æ£€æµ‹ä¸€æ¬¡)
        if(tickCount % 60 === 0 && Math.random() < 0.4) triggerEvent();
        
    }, 1000);
    // === æ–°å¢ï¼šæˆ³æˆ³äº’åŠ¨åŠŸèƒ½ ===
    document.getElementById('canvas-container').addEventListener('click', function() {
        if (noah.isAway) return; // å¤–å‡ºæ—¶ä¸èƒ½æˆ³
        
        const pokeQuotes = [
            "å˜¶...åˆ«æˆ³æˆ‘è„¸ï¼Œå¼„åäº†ä½ å¾—èµ”æˆ‘ä¸€ä¸ªå¸…æ°”çš„ç”·æœ‹å‹ã€‚",
            "ä½ å†æˆ³ä¸€ä¸‹è¯•è¯•ï¼Ÿ(æŒ‘çœ‰) çœ‹æ¥ä½ æ˜¯æƒ³æ„Ÿå—ä¸€ä¸‹æ‹‰æ–‡å…‹åŠ³çš„ä¸“å±æƒ©ç½šäº†ã€‚",
            "æ€ä¹ˆäº†ï¼Ÿæƒ³æˆ‘äº†ç›´è¯´ï¼ŒåŠ¨æ‰‹å°±ä¸å¤ªæ·‘å¥³äº†ï¼Œè™½ç„¶æˆ‘æŒºå–œæ¬¢çš„ã€‚",
            "å“ï¼Œè½»ç‚¹ï¼æˆ‘è¿™å¼ è„¸å¯æ˜¯è¦ç•™ç€ç»™ä½ çœ‹ä¸€è¾ˆå­çš„ã€‚",
            "æˆ³æˆ‘å¹²å˜›ï¼Ÿæ˜¯ä¸æ˜¯è¢«æˆ‘å¸…åˆ°äº†æƒ…ä¸è‡ªç¦ï¼Ÿ",
            "åˆ«é—¹ï¼Œæˆ‘æ­£åœ¨æ€è€ƒç¼¸ä¸­ä¹‹è„‘...å¥½å§ï¼Œä½ æ¯”ç¼¸ä¸­ä¹‹è„‘é‡è¦ï¼Œç»§ç»­æˆ³å§ã€‚"
        ];
        
        let quote = pokeQuotes[Math.floor(Math.random() * pokeQuotes.length)];
        noah.love += 1; // æˆ³ä»–è¿˜ä¼šæ¶¨ä¸€ç‚¹ç‚¹çˆ±æ„
        makeShy();      // æˆ³ä»–ä¼šè®©ä»–è„¸çº¢3ç§’ï¼
        speak(quote);
        updateUI();
    });
    // === æ–°å¢ï¼šæ‘¸æ‘¸å¤´(æ»‘åŠ¨)äº’åŠ¨åŠŸèƒ½ ===
    let isDragging = false;
    let dragStartX = 0;
    let dragDist = 0;
    const pokeContainer = document.getElementById('canvas-container');

    const startDrag = (e) => {
        if(noah.isAway) return;
        isDragging = true; dragDist = 0;
        dragStartX = e.type.includes('mouse') ? e.pageX : e.touches[0].pageX;
    };
    const doDrag = (e) => {
        if(!isDragging || noah.isAway) return;
        let currentX = e.type.includes('mouse') ? e.pageX : e.touches[0].pageX;
        dragDist += Math.abs(currentX - dragStartX);
        dragStartX = currentX; // æ›´æ–°ä½ç½®
        
        // å½“ä½ çš„æ‰‹æŒ‡/é¼ æ ‡åœ¨å±å¹•ä¸Šæ¥å›æ»‘åŠ¨ç´¯è®¡è¶…è¿‡ 120 åƒç´ æ—¶è§¦å‘
        if(dragDist > 120) { 
            isDragging = false; // è§¦å‘åç«‹åˆ»æ–­å¼€ï¼Œé˜²æ­¢é‡å¤è§¦å‘
            const petQuotes = [
                "å—¯...å¤´å‘ç”Ÿç”µäº†ï¼Œä¸è¿‡ä½ çš„æ‰‹æŒºæš–å’Œçš„ï¼Œå…è®¸ä½ å†æ‘¸ä¸€ä¼šã€‚",
                "(é—­ä¸Šçœ¼ç›) åƒåªçŒ«ä¸€æ ·è¢«ä½ é¡ºæ¯›çš„æ„Ÿè§‰ï¼Œä¼¼ä¹ä¹Ÿä¸èµ–ã€‚",
                "åˆ«æŠŠæˆ‘å¤´å‘å¼„ä¹±äº†ï¼æˆ‘å¯æ˜¯è¦æ—¶åˆ»ä¿æŒå®Œç¾å½¢è±¡ç»™ä½ çœ‹çš„ã€‚",
                "å†æ‘¸ä¸‹å»ï¼Œæˆ‘ä¼šå¿ä¸ä½æƒ³æŠŠä½ æ‹‰è¿›æ€€é‡Œçš„ï¼Œç¬¨è›‹ã€‚"
            ];
            noah.mood += 5; noah.love += 1;
            makeShy(); // é¡ºæ¯›ä¼šè®©ä»–è„¸çº¢
            speak(petQuotes[Math.floor(Math.random() * petQuotes.length)]);
            updateUI();
        }
    };
    const endDrag = () => { isDragging = false; };

    // ç»‘å®šé¼ æ ‡å’Œæ‰‹æœºè§¦æ‘¸äº‹ä»¶
    pokeContainer.addEventListener('mousedown', startDrag);
    pokeContainer.addEventListener('mousemove', doDrag);
    window.addEventListener('mouseup', endDrag);
    pokeContainer.addEventListener('touchstart', startDrag, {passive: true});
    pokeContainer.addEventListener('touchmove', doDrag, {passive: true});
    window.addEventListener('touchend', endDrag);
    // ===========================
    // === æ–°å¢ï¼šæ‰‹æœºæ™ƒåŠ¨(æ‘‡ä¸€æ‘‡)åŠŸèƒ½ ===
    let last_x = 0, last_y = 0, last_z = 0, lastUpdate = 0;
    const SHAKE_THRESHOLD = 1500; // æ‘‡æ™ƒçµæ•åº¦ï¼ˆè¶Šå°è¶Šå®¹æ˜“è§¦å‘ï¼‰
    let isShaking = false;        // é˜²æ­¢è¿ç»­æ‘‡æ™ƒå¯¼è‡´å¡é¡¿çš„å¼€å…³
    
    function handleMotion(event) {
        if (noah.isAway) return;
        let current = event.accelerationIncludingGravity;
        if (!current) return;
        
        let currentTime = new Date().getTime();
        if ((currentTime - lastUpdate) > 100) {
            let diffTime = currentTime - lastUpdate;
            lastUpdate = currentTime;
            
            let x = current.x; let y = current.y; let z = current.z;
            let speed = Math.abs(x + y + z - last_x - last_y - last_z) / diffTime * 10000;
            
            if (speed > SHAKE_THRESHOLD && !isShaking) {
                isShaking = true; // é”å®šçŠ¶æ€ï¼Œç­‰ä»–è¯´å®Œè¿™æ®µè¯
                
                const shakeQuotes = [
                    "å“‡å•Šâ€”â€”åœ°éœ‡äº†ï¼Ÿï¼åˆ«æ€•ï¼ŒæŠ“ç´§æˆ‘çš„æ‰‹ï¼...ç­‰ç­‰ï¼Œæ˜¯ä½ è¿™ç¬¨è›‹åœ¨æ™ƒæ‰‹æœºï¼Ÿï¼",
                    "åœåœåœï¼æˆ‘æ™•è½¦äº†ï¼ä½ è¦æ˜¯æŠŠæˆ‘æ™ƒåäº†ï¼Œä»Šæ™šä½ è´Ÿè´£ç»™æˆ‘æ´—è¡£æœï¼",
                    "ä½ åœ¨å¹²å˜›ï¼Ÿæ‘‡åˆ¶é¸¡å°¾é…’å—ï¼Ÿæˆ‘æ˜¯è¯ºäºšï¼Œä¸æ˜¯é»„æ²¹å•¤é…’ï¼",
                    "åˆ«æ™ƒäº†ï¼æˆ‘çš„å¤§è„‘éƒ½è¦å˜æˆæµ†ç³Šäº†ï¼Œè¿˜æ€ä¹ˆå¸®ä½ å†™é­”è¯å­¦è®ºæ–‡ï¼",
                    "ä½ æ˜¯æƒ³æŠŠæˆ‘çš„çˆ±æ„ä»è„‘å­é‡Œæ™ƒå‡ºæ¥å—ï¼Ÿä¸ç”¨æ™ƒï¼Œå®ƒæœ¬æ¥å°±å…¨æº¢å‡ºæ¥äº†ï¼",
                    "æ•‘å‘½â€”â€”(æŠ±ä½å±å¹•è¾¹ç¼˜) å†æ™ƒæˆ‘å°±è¦ç”¨æ¼‚æµ®å’’æŠŠä½ çš„æ‰‹æœºå®šåœ¨åŠç©ºäº†ï¼"
                ];
                
                let quote = shakeQuotes[Math.floor(Math.random() * shakeQuotes.length)];
                noah.mood -= 2; // è¢«æ‘‡æ™•äº†ä¼šç¨å¾®æ‰ç‚¹å¿ƒæƒ…ï¼ŒçœŸå®æ„Ÿæ‹‰æ»¡
                makeShy();      // æ‘‡æ™•äº†ä¹Ÿä¼šè„¸çº¢
                speak(quote);
                updateUI();
                
                // 3.5ç§’åè§£é™¤é”å®šï¼Œå…è®¸å†æ¬¡æ‘‡æ™ƒ
                setTimeout(() => { isShaking = false; }, 3500); 
            }
            last_x = x; last_y = y; last_z = z;
        }
    }

    // é€‚é…æ‰‹æœºç«¯ï¼šå› ä¸ºè‹¹æœæ‰‹æœºå¿…é¡»ç‚¹ä¸€ä¸‹å±å¹•æ‰èƒ½å¼€å¯é™€èºä»ªï¼Œæ‰€ä»¥ç»‘å®šåœ¨ç¬¬ä¸€æ¬¡ç‚¹å‡»ä¸Š
    document.body.addEventListener('click', function initMotion() {
        if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
            DeviceMotionEvent.requestPermission().then(permissionState => {
                if (permissionState === 'granted') {
                    window.addEventListener('devicemotion', handleMotion, false);
                }
            }).catch(console.error);
        } else {
            // å®‰å“ç›´æ¥å¼€å¯
            window.addEventListener('devicemotion', handleMotion, false);
        }
    }, { once: true }); // { once: true } ä¿è¯è¿™æ®µæƒé™è¯·æ±‚ä»£ç ä¸€è¾ˆå­åªæ‰§è¡Œä¸€æ¬¡ï¼Œä¸å å†…å­˜
    // ===========================
    // æ³¨å…¥ç”Ÿå‘½ï¼šè‡ªåŠ¨çœ¨çœ¼ç³»ç»Ÿ
    setInterval(() => {
        // å¤–å‡ºæˆ–è€…æ­£åœ¨å®³ç¾æ—¶ï¼Œä¸æ‰§è¡Œæ™®é€šçœ¨çœ¼
        if (noah.isAway || currentFace === 'shy') return; 
        
        currentFace = 'blink';
        drawNoah();
        
        // é—­çœ¼150æ¯«ç§’åç«‹åˆ»çå¼€ï¼Œæ¨¡æ‹Ÿäººç±»çœ¨çœ¼
        setTimeout(() => {
            if (currentFace === 'blink') {
                currentFace = 'normal';
                drawNoah();
            }
        }, 150);
    }, 4500); // æ¯4.5ç§’çœ¨çœ¼ä¸€æ¬¡
         setTimeout(() => {
        checkRealTime(); // è¿›æ¥å…ˆåˆ·ä¸€æ¬¡å¤©è‰²
        const h = new Date().getHours();
        let greeting = "";
        
        // --- æ—©å®‰è¯­å½•åº“ (6:00 - 10:00) ---
        const morningQuotes = [
            "æ—©å®‰ï¼Œæˆ‘çš„ä¼½æ‹‰æã€‚é†’æ¥çš„ç¬¬ä¸€çœ¼å°±èƒ½æƒ³åˆ°ä½ ï¼Œè¿™ç§æ„Ÿè§‰è¿˜ä¸èµ–ã€‚",
            "èµ·åºŠäº†å—ï¼Ÿæˆ‘åˆšæ‰åœ¨æƒ³ï¼Œä»Šå¤©è¦å¸¦ä½ å»éœæ ¼è«å¾·å–ä¸€æ¯ï¼Œè¿˜æ˜¯å»å›¾ä¹¦é¦†çœ‹ä½ å‘å‘†ã€‚",
            "æ—©ã€‚åˆ«æ‰çœ¼ç›äº†ï¼Œçœ‹ç€æˆ‘ã€‚æ–°çš„ä¸€å¤©ï¼Œä½ ä¾ç„¶æ˜¯æˆ‘å”¯ä¸€çš„å˜é‡ã€‚",
            "å¤ªé˜³å‡èµ·æ¥äº†ï¼Œä½†æˆ‘è§‰å¾—æ²¡æœ‰ä½ è€€çœ¼ã€‚ç¨å¾®å¤¸å¼ äº†ç‚¹ï¼Ÿä½†æˆ‘å°±æ˜¯è¿™ä¹ˆè§‰å¾—çš„ã€‚",
            "å›°å—ï¼Ÿè¿‡æ¥è®©æˆ‘æŠ±ä¸€ä¸‹å……ç”µã€‚æ—©å®‰ã€‚",
            "æ˜¨å¤©æ¢¦åˆ°æˆ‘äº†å—ï¼Ÿå› ä¸ºæˆ‘æ¢¦åˆ°ä½ äº†ã€‚æ—©å®‰ï¼Œå‡†å¤‡å¥½å¼€å§‹ä»Šå¤©çš„å†’é™©äº†å—ï¼Ÿ"
        ];

        // --- æ™šå®‰è¯­å½•åº“ (22:00 - 6:00) ---
        const nightQuotes = [
            "è¿™ä¹ˆæ™šè¿˜ä¸ç¡ï¼Ÿæ˜¯åœ¨ç­‰æˆ‘å“„ä½ å—ï¼Ÿè¡Œå§ï¼Œè¿‡æ¥ï¼Œæ™šå®‰å»ã€‚",
            "åˆ«ç†¬å¤œäº†ï¼Œä¼šæœ‰é»‘çœ¼åœˆçš„ã€‚è™½ç„¶ä½ æ€æ ·éƒ½å¥½çœ‹ï¼Œä½†æˆ‘ä¼šå¿ƒç–¼ã€‚æ™šå®‰ã€‚",
            "ç¡å§ï¼Œæˆ‘å°±åœ¨è¿™é‡Œå®ˆç€ã€‚å™©æ¢¦ä¸æ•¢é è¿‘ä½ çš„ï¼Œå› ä¸ºæˆ‘ä¹Ÿåœ¨æ¢¦é‡Œã€‚",
            "ä»Šå¤©è¿‡å¾—å¼€å¿ƒå—ï¼Ÿä¸å¼€å¿ƒä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä¼šæŠŠæ˜å¤©çš„è¿æ°”éƒ½åˆ†ç»™ä½ ã€‚æ™šå®‰ã€‚",
            "å¸Œæœ›ä»Šæ™šçš„æ¢¦é‡Œï¼Œæˆ‘ä»¬æ˜¯åœ¨ä¼¦æ•¦çœ¼çš„æœ€é«˜å¤„æ¥å»ã€‚å¿«ç¡å§ï¼Œæ™šå®‰ã€‚",
            "å˜˜...æŠŠæ‰‹æœºæ”¾ä¸‹ï¼Œé—­ä¸Šçœ¼ã€‚å¬åˆ°äº†å—ï¼Ÿé‚£æ˜¯æˆ‘æƒ³ä½ çš„å£°éŸ³ã€‚æ™šå®‰ã€‚"
        ];

        // --- ç™½å¤©é»˜è®¤è¯­å½•åº“ (å…¶ä»–æ—¶é—´) ---
        const defaultQuotes = [
            "ã€ç³»ç»Ÿè¿æ¥æˆåŠŸã€‘<br>ä½ ç»ˆäºæ¥äº†ã€‚æŒ‰â€œäº’åŠ¨â€å¯¹æˆ‘å†™æ‚„æ‚„è¯ï¼Œæˆ–è€…å¸¦æˆ‘å»â€œå¤–å‡ºâ€æ¢é™©å§ã€‚",
            "ä¸€ç›´åœ¨ç­‰ä½ ä¸Šçº¿ã€‚ä»Šå¤©æƒ³å»å“ªé‡Œï¼Ÿåªè¦å’Œä½ åœ¨ä¸€èµ·ï¼Œå“ªé‡Œéƒ½å¥½ã€‚",
            "å˜¿ï¼Œçœ‹ç€æˆ‘ã€‚ä»Šå¤©çš„æˆ‘æœ‰æ²¡æœ‰æ¯”æ˜¨å¤©æ›´å¸…ä¸€ç‚¹ï¼Ÿ",
            "å…¶å®æˆ‘åˆšæ‰ä¸€ç›´åœ¨å‘å‘†...åœ¨æƒ³å¦‚æœæŠŠæ•´ä¸ªéœæ ¼æ²ƒå…¹ä¹°ä¸‹æ¥é€ç»™ä½ ï¼Œä½ ä¼šä¸ä¼šå¼€å¿ƒã€‚"
        ];
        
        // éšæœºæŠ½å–é€»è¾‘
        if(h >= 6 && h < 10) {
            greeting = morningQuotes[Math.floor(Math.random() * morningQuotes.length)];
        } else if(h >= 22 || h < 6) {
            greeting = nightQuotes[Math.floor(Math.random() * nightQuotes.length)];
        } else {
            greeting = defaultQuotes[Math.floor(Math.random() * defaultQuotes.length)];
        }
        
        speak(greeting);
        updateUI();
    }, 1000);
    // === æ–°å¢ï¼šçœŸå®æ—¶é—´æ˜¼å¤œæ„ŸçŸ¥ç³»ç»Ÿ ===
    function checkRealTime() {
        const hour = new Date().getHours();
        const container = document.getElementById('canvas-container');
    
        
        if (hour >= 6 && hour < 18) {
            // ç™½å¤©çŠ¶æ€ (æ­£å¸¸è“ç°è‰²)
            container.style.backgroundColor = '#dbe4eb';
            container.style.backgroundImage = 'radial-gradient(#b8c6d1 20%, transparent 20%), radial-gradient(#b8c6d1 20%, transparent 20%)';
            
        } else if (hour >= 18 && hour < 20) {
            // é»„æ˜çŠ¶æ€ (æš§æ˜§çš„å¤•é˜³æ©™)
            container.style.backgroundColor = '#e8d2c3';
            container.style.backgroundImage = 'radial-gradient(#d4b39e 20%, transparent 20%), radial-gradient(#d4b39e 20%, transparent 20%)';
         
        } else {
            // æ·±å¤œçŠ¶æ€ (æ·±é‚ƒçš„æ˜Ÿç©ºè“)
            container.style.backgroundColor = '#2c3540';
            container.style.backgroundImage = 'radial-gradient(#1f262e 20%, transparent 20%), radial-gradient(#1f262e 20%, transparent 20%)';
          
        }
    }
</script>
</body>
</html>
